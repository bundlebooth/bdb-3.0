<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <title>VenueVue | Event Vendor Marketplace</title>
    <!-- Add Stripe.js for payment processing -->
    <script src="https://js.stripe.com/v3/"></script>
    <!-- Add FullCalendar for booking dates -->
    <link href='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css' rel='stylesheet' />
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js'></script>
    <!-- Add Socket.IO for chat functionality -->
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <style>
        :root {
            --primary: #5e72e4;
            --secondary: #f7fafc;
            --accent: #ff6b6b;
            --text: #2d3748;
            --text-light: #718096;
            --border: #e2e8f0;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --radius: 12px;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }
        
        body {
            background-color: #f8fafc;
            color: var(--text);
        }
        
        .app-container {
            display: grid;
            grid-template-columns: 280px 1fr;
            min-height: 100vh;
        }
        
        /* Header */
        .header {
            grid-column: 1 / -1;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem 2rem;
            background-color: white;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .search-container {
            flex: 1;
            max-width: 600px;
            margin: 0 2rem;
        }
        
        .search-bar {
            position: relative;
        }
        
        .search-bar input {
            width: 100%;
            padding: 0.75rem 1rem 0.75rem 2.5rem;
            border-radius: var(--radius);
            border: 1px solid var(--border);
            font-size: 0.9rem;
            transition: all 0.2s;
        }
        
        .search-bar input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(94, 114, 228, 0.1);
        }
        
        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-light);
        }
        
        .user-nav {
            display: flex;
            gap: 1.5rem;
            align-items: center;
        }
        
        .nav-icon {
            position: relative;
            color: var(--text);
            cursor: pointer;
        }
        
        .nav-icon .badge {
            position: absolute;
            top: -0.5rem;
            right: -0.5rem;
            background-color: var(--accent);
            color: white;
            border-radius: 50%;
            width: 1.25rem;
            height: 1.25rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 600;
        }
        
        /* Categories Navigation */
        .categories-nav {
            grid-column: 1 / -1;
            background-color: white;
            border-bottom: 1px solid var(--border);
            padding: 0.5rem 2rem;
            overflow-x: auto;
            white-space: nowrap;
        }
        
        .categories-list {
            display: inline-flex;
            gap: 1rem;
        }
        
        .category-item {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .category-item:hover {
            background-color: var(--secondary);
        }
        
        .category-item.active {
            background-color: var(--primary);
            color: white;
        }
        
        /* Sidebar */
        .sidebar {
            background-color: white;
            padding: 1.5rem;
            border-right: 1px solid var(--border);
            height: calc(100vh - 120px);
            position: sticky;
            top: 120px;
            overflow-y: auto;
        }
        
        .filter-section {
            margin-bottom: 2rem;
        }
        
        .filter-title {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--text);
            display: flex;
            justify-content: space-between;
        }
        
        .filter-reset {
            color: var(--primary);
            font-weight: 500;
            cursor: pointer;
            font-size: 0.8rem;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        
        .filter-option {
            display: flex;
            align-items: center;
        }
        
        .filter-option input {
            margin-right: 0.75rem;
            accent-color: var(--primary);
        }
        
        .filter-option label {
            font-size: 0.9rem;
            color: var(--text);
        }
        
        .range-slider {
            width: 100%;
            height: 4px;
            margin: 1rem 0;
            -webkit-appearance: none;
            background: var(--border);
            border-radius: 2px;
        }
        
        .range-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background-color: var(--primary);
            cursor: pointer;
        }
        
        .price-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            color: var(--text-light);
        }
        
        /* New Advanced Filters Section */
        .advanced-filters {
            margin-top: 2rem;
            border-top: 1px solid var(--border);
            padding-top: 1.5rem;
        }
        
        .advanced-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            margin-bottom: 1rem;
        }
        
        .advanced-content {
            display: none;
        }
        
        .advanced-content.show {
            display: block;
        }
        
        .date-picker {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .date-picker input {
            flex: 1;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: var(--radius);
        }
        
        .region-select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            margin-bottom: 1rem;
        }
        
        .trending-section {
            margin-top: 2rem;
        }
        
        .trending-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        
        .trending-tag {
            padding: 0.5rem 0.75rem;
            background-color: var(--secondary);
            border-radius: 20px;
            font-size: 0.8rem;
            color: var(--text);
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .trending-tag:hover {
            background-color: #e6e9ff;
            color: var(--primary);
        }
        
        .trending-tag.active {
            background-color: var(--primary);
            color: white;
        }
        
        /* Main Content */
        .main-content {
            padding: 2rem;
        }
        
        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .results-title {
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        .results-count {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-top: 0.25rem;
        }
        
        .view-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .sort-select {
            padding: 0.5rem 1rem;
            border-radius: var(--radius);
            border: 1px solid var(--border);
            background-color: white;
            font-size: 0.9rem;
            color: var(--text);
        }
        
        .view-toggle {
            display: flex;
            background-color: var(--secondary);
            border-radius: var(--radius);
            overflow: hidden;
        }
        
        .view-btn {
            padding: 0.5rem 1rem;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 0.9rem;
            color: var(--text-light);
        }
        
        .view-btn.active {
            background-color: white;
            color: var(--primary);
            font-weight: 500;
            box-shadow: var(--shadow);
        }
        
        .map-view-container {
            display: none;
            flex-direction: column;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .map-container {
            height: 400px;
            background-color: white;
            border-radius: var(--radius);
            border: 1px solid var(--border);
            position: relative;
            overflow: hidden;
        }
        
        #map {
            width: 100%;
            height: 100%;
        }
        
        .map-controls {
            position: absolute;
            top: 1rem;
            right: 1rem;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            z-index: 100;
        }
        
        .map-btn {
            width: 32px;
            height: 32px;
            background-color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow);
            cursor: pointer;
            border: 1px solid var(--border);
        }
        
        .map-venue-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }
        
        .vendor-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }
        
        .vendor-card {
            background-color: white;
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
        }
        
        .vendor-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        
        .vendor-image {
            height: 180px;
            background-color: #f1f5f9;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-light);
        }
        
        .vendor-badge {
            position: absolute;
            top: 1rem;
            left: 1rem;
            background-color: var(--primary);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .vendor-favorite {
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 32px;
            height: 32px;
            background-color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--text-light);
            box-shadow: var(--shadow);
            transition: all 0.2s;
        }
        
        .vendor-favorite.active {
            color: var(--accent);
        }
        
        .vendor-details {
            padding: 1.25rem;
        }
        
        .vendor-name {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .vendor-location {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            color: var(--text-light);
            margin-bottom: 1rem;
        }
        
        .vendor-features {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .feature {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.8rem;
            color: var(--text);
        }
        
        .feature-icon {
            color: var(--primary);
        }
        
        .vendor-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 1rem;
            border-top: 1px solid var(--border);
        }
        
        .vendor-price {
            font-size: 1.1rem;
            font-weight: 700;
        }
        
        .vendor-price span {
            font-size: 0.8rem;
            font-weight: 400;
            color: var(--text-light);
        }
        
        .vendor-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .btn {
            padding: 0.5rem 1rem;
            border-radius: var(--radius);
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-outline {
            background-color: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
        }
        
        .btn-outline:hover {
            background-color: rgba(94, 114, 228, 0.1);
        }
        
        .btn-primary {
            background-color: var(--primary);
            border: 1px solid var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #4a5acf;
        }
        
        .pagination {
            display: flex;
            justify-content: center;
            margin-top: 3rem;
            gap: 0.5rem;
        }
        
        .page-btn {
            width: 40px;
            height: 40px;
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: white;
            border: 1px solid var(--border);
            cursor: pointer;
            font-size: 0.9rem;
            color: var(--text);
        }
        
        .page-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
        }
        
        .page-btn.active {
            background-color: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        /* Booking Modal Styles */
        .modal {
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background-color: white;
            border-radius: 12px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-body {
            padding: 20px;
            overflow-y: auto;
            max-height: calc(90vh - 70px);
        }
        
        .close-modal {
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close-modal:hover {
            color: var(--primary);
        }

        /* Vendor Details in Modal */
        .vendor-detail-header {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .vendor-detail-image {
            width: 200px;
            height: 150px;
            background-color: #f1f5f9;
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
        }
        
        .vendor-detail-info {
            flex: 1;
        }
        
        .vendor-detail-name {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        
        .vendor-detail-location {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-light);
            margin-bottom: 1rem;
        }
        
        .vendor-detail-features {
            display: flex;
            gap: 1.5rem;
            margin-bottom: 1rem;
        }
        
        .vendor-detail-price {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }
        
        .vendor-detail-description {
            margin-bottom: 2rem;
            line-height: 1.6;
            color: var(--text);
        }
        
        /* Services Section */
        .services-section {
            margin-top: 2rem;
        }
        
        .services-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border);
        }
        
        .service-category {
            margin-bottom: 2rem;
        }
        
        .category-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--primary);
        }
        
        .service-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1rem;
        }
        
        .service-card {
            background-color: white;
            border-radius: var(--radius);
            padding: 1rem;
            border: 1px solid var(--border);
            transition: all 0.2s;
        }
        
        .service-card:hover {
            border-color: var(--primary);
            box-shadow: var(--shadow);
        }
        
        .service-name {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .service-description {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-bottom: 0.5rem;
        }
        
        .service-price {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }
        
        .service-actions {
            display: flex;
            justify-content: flex-end;
        }
        
        .btn-sm {
            padding: 0.25rem 0.75rem;
            font-size: 0.8rem;
        }

        /* New Booking Calendar Section */
        .booking-calendar-section {
            margin: 2rem 0;
        }
        
        .calendar-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border);
        }
        
        #booking-calendar {
            background-color: white;
            border-radius: var(--radius);
            border: 1px solid var(--border);
            padding: 1rem;
            margin-bottom: 1rem;
        }
        
        .time-slots {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 0.75rem;
            margin-top: 1rem;
        }
        
        .time-slot {
            padding: 0.75rem;
            background-color: var(--secondary);
            border-radius: var(--radius);
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .time-slot:hover {
            background-color: #e6e9ff;
            color: var(--primary);
        }
        
        .time-slot.selected {
            background-color: var(--primary);
            color: white;
        }
        
        .time-slot.unavailable {
            background-color: #f1f5f9;
            color: var(--text-light);
            cursor: not-allowed;
            text-decoration: line-through;
        }
        
        /* New Reviews Section */
        .reviews-section {
            margin: 2rem 0;
        }
        
        .reviews-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border);
        }
        
        .review-card {
            background-color: white;
            border-radius: var(--radius);
            padding: 1.5rem;
            margin-bottom: 1rem;
            border: 1px solid var(--border);
        }
        
        .review-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }
        
        .reviewer {
            font-weight: 600;
        }
        
        .review-date {
            color: var(--text-light);
            font-size: 0.9rem;
        }
        
        .review-rating {
            color: #fbbf24;
            margin-bottom: 0.5rem;
        }
        
        .review-text {
            line-height: 1.6;
        }
        
        .add-review-btn {
            margin-top: 1rem;
        }
        
        /* New Review Form */
        .review-form {
            background-color: white;
            border-radius: var(--radius);
            padding: 1.5rem;
            margin-top: 1rem;
            border: 1px solid var(--border);
        }
        
        .rating-input {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .rating-star {
            font-size: 1.5rem;
            color: #e2e8f0;
            cursor: pointer;
        }
        
        .rating-star.selected {
            color: #fbbf24;
        }
        
        .review-textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            margin-bottom: 1rem;
            min-height: 100px;
        }
        
        /* New Chat Section */
        .chat-section {
            margin: 2rem 0;
        }
        
        .chat-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border);
        }
        
        .chat-container {
            background-color: white;
            border-radius: var(--radius);
            border: 1px solid var(--border);
            height: 300px;
            display: flex;
            flex-direction: column;
        }
        
        .chat-messages {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
        }
        
        .message {
            margin-bottom: 1rem;
            max-width: 80%;
        }
        
        .message.sent {
            margin-left: auto;
            text-align: right;
        }
        
        .message.received {
            margin-right: auto;
        }
        
        .message-content {
            padding: 0.75rem;
            border-radius: var(--radius);
            display: inline-block;
        }
        
        .sent .message-content {
            background-color: var(--primary);
            color: white;
        }
        
        .received .message-content {
            background-color: var(--secondary);
        }
        
        .message-time {
            font-size: 0.75rem;
            color: var(--text-light);
            margin-top: 0.25rem;
        }
        
        .chat-input {
            display: flex;
            padding: 1rem;
            border-top: 1px solid var(--border);
        }
        
        .chat-input input {
            flex: 1;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            margin-right: 0.5rem;
        }
        
        /* New Payment Section */
        .payment-section {
            margin: 2rem 0;
        }
        
        .payment-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border);
        }
        
        .payment-form {
            background-color: white;
            border-radius: var(--radius);
            padding: 1.5rem;
            border: 1px solid var(--border);
        }
        
        .form-group {
            margin-bottom: 1rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        
        .form-group input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: var(--radius);
        }
        
        .card-element {
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            margin-bottom: 1rem;
        }
        
        /* Booking confirmation */
        .booking-confirmation {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 1001;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .confirmation-content {
            background: white;
            padding: 2rem;
            border-radius: var(--radius);
            max-width: 500px;
            width: 90%;
            animation: fadeIn 0.3s;
        }

        /* Location permission modal */
        .location-permission {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 1002;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .location-content {
            background: white;
            padding: 2rem;
            border-radius: var(--radius);
            max-width: 500px;
            width: 90%;
            animation: fadeIn 0.3s;
            text-align: center;
        }

        .location-loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(94, 114, 228, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
            margin-left: 8px;
        }

        /* Profile Modal Styles */
        .profile-modal .modal-content {
            max-width: 400px;
        }

        .profile-modal .modal-body {
            padding: 20px;
        }

        .profile-modal input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            margin-bottom: 1rem;
        }

        .profile-avatar {
            width: 80px;
            height: 80px;
            background-color: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1.5rem;
            color: white;
            font-size: 2rem;
        }

        /* Dashboard Styles */
        .dashboard-container {
            display: grid;
            grid-template-columns: 250px 1fr;
            min-height: 100vh;
        }
        
        .dashboard-sidebar {
            background-color: white;
            border-right: 1px solid var(--border);
            padding: 1.5rem;
        }
        
        .dashboard-menu {
            list-style: none;
            margin-top: 2rem;
        }
        
        .dashboard-menu li {
            margin-bottom: 0.5rem;
        }
        
        .dashboard-menu a {
            display: block;
            padding: 0.75rem 1rem;
            border-radius: var(--radius);
            color: var(--text);
            text-decoration: none;
            transition: all 0.2s;
        }
        
        .dashboard-menu a:hover {
            background-color: var(--secondary);
        }
        
        .dashboard-menu a.active {
            background-color: var(--primary);
            color: white;
        }
        
        .dashboard-content {
            padding: 2rem;
            background-color: var(--secondary);
        }
        
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }
        
        .dashboard-title {
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        .dashboard-card {
            background-color: white;
            border-radius: var(--radius);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow);
        }
        
        .dashboard-card-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }
        
        .booking-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
            border-bottom: 1px solid var(--border);
        }
        
        .booking-item:last-child {
            border-bottom: none;
        }
        
        .booking-info {
            flex: 1;
        }
        
        .booking-vendor {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        
        .booking-date {
            color: var(--text-light);
            font-size: 0.9rem;
        }
        
        .booking-status {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .status-pending {
            background-color: #fef3c7;
            color: #92400e;
        }
        
        .status-confirmed {
            background-color: #d1fae5;
            color: #065f46;
        }
        
        .status-cancelled {
            background-color: #fee2e2;
            color: #991b1b;
        }
        
        /* Vendor Dashboard Styles */
        .vendor-dashboard-card {
            background-color: white;
            border-radius: var(--radius);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow);
        }
        
        .vendor-stats {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background-color: white;
            border-radius: var(--radius);
            padding: 1.5rem;
            text-align: center;
            box-shadow: var(--shadow);
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }
        
        .stat-label {
            color: var(--text-light);
            font-size: 0.9rem;
        }
        
        /* Vendor Registration Form */
        .vendor-registration-form {
            background-color: white;
            border-radius: var(--radius);
            padding: 2rem;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .form-section {
            margin-bottom: 2rem;
        }
        
        .form-section-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border);
        }
        
        .form-row {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .form-col {
            flex: 1;
        }
        
        /* Price indicator styles */
        .price-indicator {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.9rem;
        }
        
        .price-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: var(--text-light);
        }
        
        .price-dot.filled {
            background-color: var(--primary);
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .modal-content {
                width: 95%;
                height: 90vh;
            }
            
            .modal-body {
                max-height: calc(90vh - 60px);
            }
            
            .vendor-detail-header {
                flex-direction: column;
            }
            
            .vendor-detail-image {
                width: 100%;
                height: 200px;
            }
            
            .view-controls {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .categories-nav {
                padding: 0.5rem 1rem;
            }
            
            .category-item {
                padding: 0.5rem 0.75rem;
                font-size: 0.8rem;
            }
            
            .dashboard-container {
                grid-template-columns: 1fr;
            }
            
            .dashboard-sidebar {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- Main App View -->
    <div class="app-container" id="app-container">
        <header class="header">
            <div class="logo">
                <span>🎉</span>
                VenueVue
            </div>
            
            <div class="search-container">
                <div class="search-bar">
                    <span class="search-icon">🔍</span>
                    <input type="text" placeholder="Search for event vendors..." id="search-input">
                </div>
            </div>
            
            <div class="user-nav">
                <div class="nav-icon" id="wishlist-btn">
                    ❤
                    <span class="badge" id="favorites-badge">0</span>
                </div>
                <div class="nav-icon" id="notifications-btn">
                    🔔
                    <span class="badge" id="notifications-badge">0</span>
                </div>
                <div class="nav-icon" id="profile-btn">👤</div>
            </div>
        </header>
        
        <!-- Categories Navigation -->
        <nav class="categories-nav">
            <div class="categories-list" id="categories-list">
                <div class="category-item active" data-category="all">All Categories</div>
                <!-- Categories will be loaded dynamically -->
            </div>
        </nav>
        
        <aside class="sidebar">
            <div class="filter-section">
                <h3 class="filter-title">
                    Location
                    <span class="filter-reset" id="location-reset">Reset</span>
                </h3>
                <input type="text" placeholder="City or ZIP code" class="search-input" id="location-input" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border); border-radius: var(--radius); margin-bottom: 1rem;">
                <div class="filter-group">
                    <div class="filter-option">
                        <input type="checkbox" id="current-location">
                        <label for="current-location">Use my location</label>
                    </div>
                    <div class="filter-option">
                        <input type="checkbox" id="within50">
                        <label for="within50">Within 50 miles</label>
                    </div>
                </div>
            </div>
            
            <div class="filter-section">
                <h3 class="filter-title">
                    Price Range
                    <span class="filter-reset" id="price-reset">Reset</span>
                </h3>
                <input type="range" class="range-slider" min="0" max="100" value="40" id="price-slider">
                <div class="price-labels">
                    <span>$</span>
                    <span>$$</span>
                    <span>$$$</span>
                </div>
            </div>
            
            <div class="filter-section">
                <h3 class="filter-title">
                    Vendor Type
                    <span class="filter-reset" id="type-reset">Reset</span>
                </h3>
                <div class="filter-group">
                    <div class="filter-option">
                        <input type="checkbox" id="independent" checked>
                        <label for="independent">Independent</label>
                    </div>
                    <div class="filter-option">
                        <input type="checkbox" id="company" checked>
                        <label for="company">Company</label>
                    </div>
                </div>
            </div>
            
            <!-- New Advanced Filters Section -->
            <div class="advanced-filters">
                <div class="advanced-toggle" id="advanced-toggle">
                    <h3 class="filter-title">Advanced Filters</h3>
                    <span>+</span>
                </div>
                <div class="advanced-content" id="advanced-content">
                    <div class="filter-section">
                        <h3 class="filter-title">Availability</h3>
                        <div class="date-picker">
                            <input type="date" id="start-date" placeholder="Start date">
                            <input type="date" id="end-date" placeholder="End date">
                        </div>
                    </div>
                    
                    <div class="filter-section">
                        <h3 class="filter-title">Region</h3>
                        <select class="region-select" id="region-select">
                            <option value="">All Regions</option>
                            <option value="north">Northern Region</option>
                            <option value="south">Southern Region</option>
                            <option value="east">Eastern Region</option>
                            <option value="west">Western Region</option>
                            <option value="central">Central Region</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <div class="trending-section">
                <h3 class="filter-title">Popular Filters</h3>
                <div class="trending-tags">
                    <div class="trending-tag" data-filter="premium">Premium</div>
                    <div class="trending-tag" data-filter="eco-friendly">Eco-Friendly</div>
                    <div class="trending-tag" data-filter="award-winning">Award Winning</div>
                    <div class="trending-tag" data-filter="last-minute">Last Minute</div>
                </div>
            </div>
        </aside>
        
        <main class="main-content">
            <div class="content-header">
                <div>
                    <h1 class="results-title">Loading vendors...</h1>
                    <p class="results-count">Please wait</p>
                </div>
                
                <div class="view-controls">
                    <select class="sort-select" id="sort-select">
                        <option value="recommended">Sort: Recommended</option>
                        <option value="price-low">Price: Low to High</option>
                        <option value="price-high">Price: High to Low</option>
                        <option value="popular">Most Popular</option>
                        <option value="nearest">Nearest to Me</option>
                        <option value="rating">Highest Rated</option>
                    </select>
                </div>
            </div>
            
            <div class="map-view-container" id="map-view-container">
                <div class="map-container">
                    <div id="map"></div>
                    <div class="map-controls">
                        <button class="map-btn" id="zoom-in">+</button>
                        <button class="map-btn" id="zoom-out">-</button>
                        <button class="map-btn" id="locate-me">📍</button>
                    </div>
                </div>
                <div class="map-venue-list" id="map-venue-list"></div>
            </div>
            
            <div class="vendor-grid" id="vendor-grid">
                <!-- Vendors will be loaded dynamically here -->
                <div style="grid-column:1/-1;text-align:center;padding:2rem;">Loading vendors...</div>
            </div>
            
            <div class="pagination" id="pagination">
                <div class="page-btn" id="prev-page">«</div>
                <div class="page-btn active">1</div>
                <div class="page-btn">2</div>
                <div class="page-btn">3</div>
                <div class="page-btn" id="next-page">»</div>
            </div>
        </main>
    </div>

    <!-- Dashboard View (Hidden by default) -->
    <div class="dashboard-container" id="dashboard-container" style="display: none;">
        <aside class="dashboard-sidebar">
            <div class="logo" style="padding: 1rem 0; border-bottom: 1px solid var(--border);">
                <span>🎉</span>
                VenueVue
            </div>
            
            <ul class="dashboard-menu">
                <li><a href="#" class="active" data-section="dashboard">Dashboard</a></li>
                <li><a href="#" data-section="bookings">My Bookings</a></li>
                <li><a href="#" data-section="favorites">Favorites</a></li>
                <li><a href="#" data-section="messages">Messages</a></li>
                <li><a href="#" data-section="reviews">My Reviews</a></li>
                <li><a href="#" data-section="settings">Settings</a></li>
                <li><a href="#" id="switch-to-vendor">Switch to Vendor Mode</a></li>
                <li><a href="#" id="logout-dashboard">Log Out</a></li>
            </ul>
        </aside>
        
        <main class="dashboard-content">
            <div class="dashboard-header">
                <h1 class="dashboard-title" id="dashboard-title">Dashboard</h1>
                <div class="user-nav">
                    <div class="nav-icon" id="dashboard-notifications-btn">
                        🔔
                        <span class="badge" id="dashboard-notifications-badge">0</span>
                    </div>
                </div>
            </div>
            
            <!-- Dashboard Content -->
            <div id="dashboard-section">
                <div class="dashboard-card">
                    <h2 class="dashboard-card-title">Upcoming Bookings</h2>
                    <div id="upcoming-bookings">
                        <!-- Bookings will be loaded here -->
                    </div>
                </div>
                
                <div class="dashboard-card">
                    <h2 class="dashboard-card-title">Recent Favorites</h2>
                    <div class="vendor-grid" id="dashboard-favorites">
                        <!-- Favorites will be loaded here -->
                    </div>
                </div>
            </div>
            
            <!-- Bookings Section (Hidden by default) -->
            <div id="bookings-section" style="display: none;">
                <div class="dashboard-card">
                    <h2 class="dashboard-card-title">All Bookings</h2>
                    <div id="all-bookings">
                        <!-- Bookings will be loaded here -->
                    </div>
                </div>
            </div>
            
            <!-- Favorites Section (Hidden by default) -->
            <div id="favorites-section" style="display: none;">
                <div class="dashboard-card">
                    <h2 class="dashboard-card-title">Saved Favorites</h2>
                    <div class="vendor-grid" id="saved-favorites">
                        <!-- Favorites will be loaded here -->
                    </div>
                </div>
            </div>
            
            <!-- Messages Section (Hidden by default) -->
            <div id="messages-section" style="display: none;">
                <div class="dashboard-card">
                    <h2 class="dashboard-card-title">Messages</h2>
                    <div class="chat-container">
                        <div class="chat-messages" id="dashboard-chat-messages">
                            <!-- Messages will be loaded here -->
                        </div>
                        <div class="chat-input">
                            <input type="text" placeholder="Type your message..." id="dashboard-chat-input">
                            <button class="btn btn-primary" id="dashboard-send-btn">Send</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Reviews Section (Hidden by default) -->
            <div id="reviews-section" style="display: none;">
                <div class="dashboard-card">
                    <h2 class="dashboard-card-title">My Reviews</h2>
                    <div id="user-reviews">
                        <!-- Reviews will be loaded here -->
                    </div>
                </div>
            </div>
            
            <!-- Settings Section (Hidden by default) -->
            <div id="settings-section" style="display: none;">
                <div class="dashboard-card">
                    <h2 class="dashboard-card-title">Account Settings</h2>
                    <form id="profile-form">
                        <div class="form-group">
                            <label for="profile-name">Full Name</label>
                            <input type="text" id="profile-name">
                        </div>
                        <div class="form-group">
                            <label for="profile-email">Email</label>
                            <input type="email" id="profile-email" disabled>
                        </div>
                        <div class="form-group">
                            <label for="profile-phone">Phone Number</label>
                            <input type="tel" id="profile-phone">
                        </div>
                        <button type="submit" class="btn btn-primary">Save Changes</button>
                    </form>
                </div>
                
                <div class="dashboard-card">
                    <h2 class="dashboard-card-title">Change Password</h2>
                    <form id="password-form">
                        <div class="form-group">
                            <label for="current-password">Current Password</label>
                            <input type="password" id="current-password">
                        </div>
                        <div class="form-group">
                            <label for="new-password">New Password</label>
                            <input type="password" id="new-password">
                        </div>
                        <div class="form-group">
                            <label for="confirm-password">Confirm New Password</label>
                            <input type="password" id="confirm-password">
                        </div>
                        <button type="submit" class="btn btn-primary">Update Password</button>
                    </form>
                </div>
            </div>
        </main>
    </div>

    <!-- Vendor Dashboard View (Hidden by default) -->
    <div class="dashboard-container" id="vendor-dashboard-container" style="display: none;">
        <aside class="dashboard-sidebar">
            <div class="logo" style="padding: 1rem 0; border-bottom: 1px solid var(--border);">
                <span>🎉</span>
                VenueVue
            </div>
            
            <ul class="dashboard-menu">
                <li><a href="#" class="active" data-section="vendor-dashboard">Dashboard</a></li>
                <li><a href="#" data-section="vendor-bookings">Bookings</a></li>
                <li><a href="#" data-section="vendor-services">Services</a></li>
                <li><a href="#" data-section="vendor-messages">Messages</a></li>
                <li><a href="#" data-section="vendor-reviews">Reviews</a></li>
                <li><a href="#" data-section="vendor-analytics">Analytics</a></li>
                <li><a href="#" data-section="vendor-settings">Settings</a></li>
                <li><a href="#" id="switch-to-client">Switch to Client Mode</a></li>
                <li><a href="#" id="vendor-logout">Log Out</a></li>
            </ul>
        </aside>
        
        <main class="dashboard-content">
            <div class="dashboard-header">
                <h1 class="dashboard-title" id="vendor-dashboard-title">Vendor Dashboard</h1>
                <div class="user-nav">
                    <div class="nav-icon" id="vendor-notifications-btn">
                        🔔
                        <span class="badge" id="vendor-notifications-badge">0</span>
                    </div>
                </div>
            </div>
            
            <!-- Vendor Dashboard Content -->
            <div id="vendor-dashboard-section">
                <div class="vendor-stats" id="vendor-stats">
                    <!-- Stats will be loaded here -->
                </div>
                
                <div class="dashboard-card">
                    <h2 class="dashboard-card-title">Recent Bookings</h2>
                    <div id="vendor-recent-bookings">
                        <!-- Bookings will be loaded here -->
                    </div>
                </div>
                
                <div class="dashboard-card">
                    <h2 class="dashboard-card-title">Recent Messages</h2>
                    <div class="chat-container" style="height: 400px;">
                        <div class="chat-messages" id="vendor-chat-messages">
                            <!-- Messages will be loaded here -->
                        </div>
                        <div class="chat-input">
                            <input type="text" placeholder="Type your message..." id="vendor-chat-input">
                            <button class="btn btn-primary" id="vendor-send-btn">Send</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Vendor Bookings Section (Hidden by default) -->
            <div id="vendor-bookings-section" style="display: none;">
                <div class="dashboard-card">
                    <h2 class="dashboard-card-title">All Bookings</h2>
                    <div id="vendor-all-bookings">
                        <!-- Bookings will be loaded here -->
                    </div>
                </div>
            </div>
            
            <!-- Vendor Services Section (Hidden by default) -->
            <div id="vendor-services-section" style="display: none;">
                <div class="dashboard-card">
                    <h2 class="dashboard-card-title">Manage Services</h2>
                    <div class="services-section" id="vendor-services">
                        <!-- Services will be loaded here -->
                    </div>
                </div>
            </div>
            
            <!-- Vendor Messages Section (Hidden by default) -->
            <div id="vendor-messages-section" style="display: none;">
                <div class="dashboard-card">
                    <h2 class="dashboard-card-title">Messages</h2>
                    <div class="chat-container" style="height: 500px;">
                        <div class="chat-messages" id="vendor-all-chat-messages">
                            <!-- Messages will be loaded here -->
                        </div>
                        <div class="chat-input">
                            <input type="text" placeholder="Type your message..." id="vendor-all-chat-input">
                            <button class="btn btn-primary" id="vendor-all-send-btn">Send</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Vendor Reviews Section (Hidden by default) -->
            <div id="vendor-reviews-section" style="display: none;">
                <div class="dashboard-card">
                    <h2 class="dashboard-card-title">Customer Reviews</h2>
                    <div id="vendor-reviews">
                        <!-- Reviews will be loaded here -->
                    </div>
                </div>
            </div>
            
            <!-- Vendor Analytics Section (Hidden by default) -->
            <div id="vendor-analytics-section" style="display: none;">
                <div class="dashboard-card">
                    <h2 class="dashboard-card-title">Performance Analytics</h2>
                    <div id="analytics-charts">
                        <!-- Analytics will be loaded here -->
                    </div>
                </div>
            </div>
            
            <!-- Vendor Settings Section (Hidden by default) -->
            <div id="vendor-settings-section" style="display: none;">
                <div class="dashboard-card">
                    <h2 class="dashboard-card-title">Business Profile</h2>
                    <form id="vendor-profile-form">
                        <div class="form-group">
                            <label for="vendor-name">Business Name</label>
                            <input type="text" id="vendor-name">
                        </div>
                        <div class="form-group">
                            <label for="vendor-category">Category</label>
                            <select id="vendor-category">
                                <!-- Categories will be loaded dynamically -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="vendor-description">Description</label>
                            <textarea id="vendor-description" rows="4" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border); border-radius: var(--radius);"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="vendor-location">Location</label>
                            <input type="text" id="vendor-location">
                        </div>
                        <div class="form-group">
                            <label for="vendor-phone">Phone Number</label>
                            <input type="tel" id="vendor-phone">
                        </div>
                        <div class="form-group">
                            <label for="vendor-email">Business Email</label>
                            <input type="email" id="vendor-email">
                        </div>
                        <div class="form-group">
                            <label for="vendor-website">Website</label>
                            <input type="url" id="vendor-website">
                        </div>
                        <button type="submit" class="btn btn-primary">Save Changes</button>
                    </form>
                </div>
                
                <div class="dashboard-card">
                    <h2 class="dashboard-card-title">Business Photos</h2>
                    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;" id="vendor-photos">
                        <!-- Photos will be loaded here -->
                    </div>
                    <button class="btn btn-outline" id="upload-photos-btn">Upload Photos</button>
                </div>
                
                <div class="dashboard-card">
                    <h2 class="dashboard-card-title">Availability Settings</h2>
                    <div id="vendor-availability-calendar" style="margin-bottom: 1.5rem;"></div>
                    <button class="btn btn-outline" id="set-business-hours-btn">Set Business Hours</button>
                </div>
            </div>
        </main>
    </div>

    <!-- Vendor Registration Modal -->
    <div id="vendor-registration-modal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3>Register as a Vendor</h3>
                <span class="close-modal">&times;</span>
            </div>
            <div class="modal-body">
                <form class="vendor-registration-form" id="vendor-registration-form">
                    <div class="form-section">
                        <h4 class="form-section-title">Business Information</h4>
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="reg-business-name">Business Name</label>
                                    <input type="text" id="reg-business-name" required>
                                </div>
                            </div>
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="reg-business-type">Business Type</label>
                                    <select id="reg-business-type" required>
                                        <option value="">Select type</option>
                                        <option value="individual">Individual/Sole Proprietor</option>
                                        <option value="llc">LLC</option>
                                        <option value="corporation">Corporation</option>
                                        <option value="partnership">Partnership</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="reg-category">Primary Category</label>
                                    <select id="reg-category" required>
                                        <option value="">Select category</option>
                                        <!-- Categories will be loaded dynamically -->
                                    </select>
                                </div>
                            </div>
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="reg-years-in-business">Years in Business</label>
                                    <input type="number" id="reg-years-in-business" min="0" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="reg-business-description">Business Description</label>
                            <textarea id="reg-business-description" rows="4" required></textarea>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h4 class="form-section-title">Contact Information</h4>
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="reg-business-email">Business Email</label>
                                    <input type="email" id="reg-business-email" required>
                                </div>
                            </div>
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="reg-business-phone">Business Phone</label>
                                    <input type="tel" id="reg-business-phone" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="reg-business-address">Business Address</label>
                                    <input type="text" id="reg-business-address" required>
                                </div>
                            </div>
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="reg-business-website">Website (optional)</label>
                                    <input type="url" id="reg-business-website">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h4 class="form-section-title">Service Information</h4>
                        <div id="service-fields-container">
                            <div class="service-field-group">
                                <div class="form-row">
                                    <div class="form-col">
                                        <div class="form-group">
                                            <label>Service Name</label>
                                            <input type="text" name="service-name[]" required>
                                        </div>
                                    </div>
                                    <div class="form-col">
                                        <div class="form-group">
                                            <label>Price</label>
                                            <input type="number" name="service-price[]" min="0" step="0.01" required>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Description</label>
                                    <textarea name="service-description[]" rows="2" required></textarea>
                                </div>
                            </div>
                        </div>
                        <button type="button" class="btn btn-outline" id="add-service-field">Add Another Service</button>
                    </div>
                    
                    <div class="form-section">
                        <h4 class="form-section-title">Business Documents</h4>
                        <div class="form-group">
                            <label>Business License (Upload)</label>
                            <input type="file" id="business-license" accept=".pdf,.jpg,.png" required>
                        </div>
                        <div class="form-group">
                            <label>Tax ID Verification (Upload)</label>
                            <input type="file" id="tax-id" accept=".pdf,.jpg,.png" required>
                        </div>
                        <div class="form-group">
                            <label>Portfolio or Sample Work (Optional)</label>
                            <input type="file" id="portfolio" accept=".pdf,.jpg,.png,.mp4">
                        </div>
                    </div>
                    
                    <div class="form-group" style="margin-top: 2rem;">
                        <button type="submit" class="btn btn-primary" style="width: 100%;">Submit Application</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Booking Modal -->
    <div id="booking-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Vendor Details & Booking</h3>
                <span class="close-modal">&times;</span>
            </div>
            <div class="modal-body">
                <!-- This will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Booking Confirmation -->
    <div id="confirmation-modal" class="booking-confirmation" style="display: none;">
        <div class="confirmation-content">
            <h3>🎉 Booking Confirmed!</h3>
            <p><strong>Vendor:</strong> <span id="conf-venue-name"></span></p>
            <p><strong>Services:</strong> <span id="conf-services"></span></p>
            <p><strong>Date:</strong> <span id="conf-date"></span></p>
            <p><strong>Time:</strong> <span id="conf-time"></span></p>
            <p><strong>Confirmation #:</strong> <span id="conf-id"></span></p>
            <p>A confirmation email has been sent to your registered email address.</p>
            <button class="btn btn-primary" id="conf-done-btn">Done</button>
        </div>
    </div>

    <!-- Location Permission Modal -->
    <div id="location-permission" class="location-permission" style="display: none;">
        <div class="location-content">
            <h3>Find Vendors Near You</h3>
            <p>VenueVue would like to access your location to show vendors near you.</p>
            <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 1.5rem;">
                <button class="btn btn-outline" id="deny-location">Not Now</button>
                <button class="btn btn-primary" id="allow-location">
                    Allow
                    <span id="location-loading" class="location-loading" style="display: none;"></span>
                </button>
            </div>
        </div>
    </div>

    <!-- Profile Modal -->
    <div id="profile-modal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h3 id="profile-modal-title">Welcome to VenueVue</h3>
                <span class="close-modal" id="close-profile-modal">&times;</span>
            </div>
            <div class="modal-body">
                <!-- Login Form (shown by default) -->
                <div id="login-form">
                    <div style="margin-bottom: 1.5rem;">
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Email</label>
                        <input type="email" id="login-email" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border); border-radius: var(--radius); margin-bottom: 1rem;">
                    </div>
                    <div style="margin-bottom: 1.5rem;">
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Password</label>
                        <input type="password" id="login-password" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border); border-radius: var(--radius); margin-bottom: 1rem;">
                    </div>
                    <button class="btn btn-primary" id="login-btn" style="width: 100%; margin-bottom: 1rem;">Log In</button>
                    <div style="text-align: center; margin-bottom: 1.5rem;">
                        <a href="#" id="show-signup" style="color: var(--primary); text-decoration: none; font-size: 0.9rem;">Don't have an account? Sign up</a>
                    </div>
                    <div style="display: flex; align-items: center; margin-bottom: 1.5rem;">
                        <div style="flex: 1; height: 1px; background-color: var(--border);"></div>
                        <div style="padding: 0 1rem; color: var(--text-light); font-size: 0.9rem;">OR</div>
                        <div style="flex: 1; height: 1px; background-color: var(--border);"></div>
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                        <button class="btn btn-outline" id="google-login" style="width: 100%; display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/5/53/Google_%22G%22_Logo.svg" width="20" height="20">
                            <span>Continue with Google</span>
                        </button>
                        <button class="btn btn-outline" id="facebook-login" style="width: 100%; display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/5/51/Facebook_f_logo_%282019%29.svg" width="20" height="20">
                            <span>Continue with Facebook</span>
                        </button>
                    </div>
                </div>

                <!-- Signup Form (hidden by default) -->
                <div id="signup-form" style="display: none;">
                    <div style="margin-bottom: 1.5rem;">
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Full Name</label>
                        <input type="text" id="signup-name" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border); border-radius: var(--radius); margin-bottom: 1rem;">
                    </div>
                    <div style="margin-bottom: 1.5rem;">
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Email</label>
                        <input type="email" id="signup-email" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border); border-radius: var(--radius); margin-bottom: 1rem;">
                    </div>
                    <div style="margin-bottom: 1.5rem;">
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Password</label>
                        <input type="password" id="signup-password" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border); border-radius: var(--radius); margin-bottom: 1rem;">
                    </div>
                    <div class="form-group" style="margin-bottom: 1.5rem;">
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Account Type</label>
                        <select id="account-type" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border); border-radius: var(--radius);">
                            <option value="client">Client (I want to book vendors)</option>
                            <option value="vendor">Vendor (I provide services)</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" id="signup-btn" style="width: 100%; margin-bottom: 1rem;">Create Account</button>
                    <div style="text-align: center;">
                        <a href="#" id="show-login" style="color: var(--primary); text-decoration: none; font-size: 0.9rem;">Already have an account? Log in</a>
                    </div>
                </div>

                <!-- Logged In View (hidden by default) -->
                <div id="logged-in-view" style="display: none; text-align: center;">
                    <div class="profile-avatar" id="profile-avatar">
                        U
                    </div>
                    <h3 style="margin-bottom: 0.5rem;" id="profile-name">User Name</h3>
                    <p style="color: var(--text-light); margin-bottom: 1.5rem;" id="profile-email">user@example.com</p>
                    <button class="btn btn-primary" id="view-dashboard-btn" style="width: 100%; margin-bottom: 1rem;">View Dashboard</button>
                    <button class="btn btn-outline" id="logout-btn" style="width: 100%;">Log Out</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Google Maps API -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB41DRUbKWJHPxaFjMAwdrzWzbVKartNGg&libraries=places&v=weekly" defer></script>

    <!-- Facebook SDK -->
    <script>
      window.fbAsyncInit = function() {
        FB.init({
          appId: 'YOUR_FACEBOOK_APP_ID',  // Replace with your actual Facebook App ID
          cookie: true,
          xfbml: true,
          version: 'v18.0'
        });
      };
    </script>
    <script async defer crossorigin="anonymous" src="https://connect.facebook.net/en_US/sdk.js"></script>

    <!-- Main Application Script -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // API base URL
            const API_BASE_URL = 'https://bdb-3-0-venuevue-api.onrender.com/api';
            
            // Initialize variables
            const modal = document.getElementById('booking-modal');
            const modalBody = document.querySelector('.modal-body');
            const confirmationModal = document.getElementById('confirmation-modal');
            const locationPermissionModal = document.getElementById('location-permission');
            const vendorGrid = document.getElementById('vendor-grid');
            const mapVenueList = document.getElementById('map-venue-list');
            const resultsTitle = document.querySelector('.results-title');
            const resultsCount = document.querySelector('.results-count');
            const mapViewContainer = document.getElementById('map-view-container');
            const searchInput = document.getElementById('search-input');
            const sortSelect = document.getElementById('sort-select');
            const wishlistBtn = document.getElementById('wishlist-btn');
            const notificationsBtn = document.getElementById('notifications-btn');
            const profileBtn = document.getElementById('profile-btn');
            const filterResetBtns = document.querySelectorAll('.filter-reset');
            const trendingTags = document.querySelectorAll('.trending-tag');
            const pagination = document.getElementById('pagination');
            const prevPageBtn = document.getElementById('prev-page');
            const nextPageBtn = document.getElementById('next-page');
            const locateMeBtn = document.getElementById('locate-me');
            const allowLocationBtn = document.getElementById('allow-location');
            const denyLocationBtn = document.getElementById('deny-location');
            const currentLocationCheckbox = document.getElementById('current-location');
            const locationLoading = document.getElementById('location-loading');
            const locationInput = document.getElementById('location-input');
            const categoryItems = document.querySelectorAll('.category-item');
            const advancedToggle = document.getElementById('advanced-toggle');
            const advancedContent = document.getElementById('advanced-content');
            const categoriesList = document.getElementById('categories-list');
            
            // Profile modal elements
            const profileModal = document.getElementById('profile-modal');
            const closeProfileModal = document.getElementById('close-profile-modal');
            const loginForm = document.getElementById('login-form');
            const signupForm = document.getElementById('signup-form');
            const loggedInView = document.getElementById('logged-in-view');
            const showSignup = document.getElementById('show-signup');
            const showLogin = document.getElementById('show-login');
            const loginBtn = document.getElementById('login-btn');
            const signupBtn = document.getElementById('signup-btn');
            const logoutBtn = document.getElementById('logout-btn');
            const googleLoginBtn = document.getElementById('google-login');
            const facebookLoginBtn = document.getElementById('facebook-login');
            const viewDashboardBtn = document.getElementById('view-dashboard-btn');
            const accountTypeSelect = document.getElementById('account-type');
            
            // Dashboard elements
            const appContainer = document.getElementById('app-container');
            const dashboardContainer = document.getElementById('dashboard-container');
            const vendorDashboardContainer = document.getElementById('vendor-dashboard-container');
            const dashboardMenuItems = document.querySelectorAll('.dashboard-menu a');
            const switchToVendorBtn = document.getElementById('switch-to-vendor');
            const switchToClientBtn = document.getElementById('switch-to-client');
            const logoutDashboardBtn = document.getElementById('logout-dashboard');
            const vendorLogoutBtn = document.getElementById('vendor-logout');
            
            // Vendor registration elements
            const vendorRegistrationModal = document.getElementById('vendor-registration-modal');
            const vendorRegistrationForm = document.getElementById('vendor-registration-form');
            const addServiceFieldBtn = document.getElementById('add-service-field');
            const serviceFieldsContainer = document.getElementById('service-fields-container');
            
            // App state
            let state = {
                vendors: [],
                filteredVendors: [],
                favorites: [],
                currentPage: 1,
                itemsPerPage: 6,
                map: null,
                markers: [],
                currentView: 'list',
                userLocation: null,
                currentCategory: 'all',
                filters: {
                    location: '',
                    types: ['independent', 'company'],
                    price: 40,
                    popular: [],
                    startDate: null,
                    endDate: null,
                    region: ''
                },
                currentVendor: null,
                selectedServices: [],
                selectedDate: null,
                selectedTime: null,
                stripe: null,
                elements: null,
                paymentIntent: null,
                socket: null,
                chatMessages: [],
                currentChat: null,
                categories: []
            };
            
            // User state
            let currentUser = null;
            
            // Initialize the app
            init();
            
            async function init() {
                // Load categories first
                await loadCategories();
                
                // Check for existing user session
                await checkAuthStatus();
                
                // Show loading state
                vendorGrid.innerHTML = '<div style="grid-column:1/-1;text-align:center;padding:2rem;">Loading vendors...</div>';
                
                try {
                    // Load vendors data from API
                    await loadVendors();
                    
                    // Initialize Stripe
                    initializeStripe();
                    
                    // Connect to Socket.IO
                    connectToChat();
                    
                    // Request location after everything is loaded
                    requestLocationWithFeedback();
                    
                    // Setup event listeners
                    setupEventListeners();
                    
                } catch (error) {
                    console.error('Initialization error:', error);
                    showError("Failed to load vendors. Please try again later.");
                }
            }
            
            // Load categories from API
            async function loadCategories() {
                try {
                    // In a real app, you would fetch categories from your API
                    // For now, we'll use a predefined list that matches the backend
                    state.categories = [
                        { id: 'all', name: 'All Categories' },
                        { id: 'venue', name: 'Venues' },
                        { id: 'photo', name: 'Photo/Video' },
                        { id: 'music', name: 'Music/DJ' },
                        { id: 'catering', name: 'Catering' },
                        { id: 'entertainment', name: 'Entertainment' },
                        { id: 'experiences', name: 'Experiences' },
                        { id: 'decor', name: 'Decorations' },
                        { id: 'beauty', name: 'Beauty' },
                        { id: 'cake', name: 'Cake' },
                        { id: 'transport', name: 'Transportation' },
                        { id: 'planner', name: 'Planners' },
                        { id: 'fashion', name: 'Fashion' },
                        { id: 'stationery', name: 'Stationery' }
                    ];
                    
                    // Render categories
                    renderCategories();
                    
                } catch (error) {
                    console.error('Error loading categories:', error);
                }
            }
            
            // Render categories in the navigation
            function renderCategories() {
                categoriesList.innerHTML = '';
                
                state.categories.forEach(category => {
                    const categoryItem = document.createElement('div');
                    categoryItem.className = 'category-item';
                    if (category.id === 'all') categoryItem.classList.add('active');
                    categoryItem.dataset.category = category.id;
                    categoryItem.textContent = category.name;
                    
                    categoryItem.addEventListener('click', () => {
                        // Update active category
                        document.querySelectorAll('.category-item').forEach(item => item.classList.remove('active'));
                        categoryItem.classList.add('active');
                        
                        // Set current category
                        state.currentCategory = category.id;
                        
                        // Filter vendors
                        filterVendors();
                    });
                    
                    categoriesList.appendChild(categoryItem);
                });
            }
            
            // Load vendors from API
            async function loadVendors() {
                try {
                    const response = await fetch(`${API_BASE_URL}/vendors`);
                    if (!response.ok) throw new Error('Network response was not ok');
                    
                    const data = await response.json();
                    if (data && data.length > 0) {
                        // Process vendor data
                        state.vendors = data.map(vendor => {
                            // Parse services JSON string if needed
                            let services = [];
                            try {
                                services = vendor.services ? (typeof vendor.services === 'string' ? JSON.parse(vendor.services) : vendor.services) : [];
                            } catch (e) {
                                console.error('Error parsing services:', e);
                            }
                            
                            // Map type to category
                            const category = mapTypeToCategory(vendor.type);
                            
                            return {
                                ...vendor,
                                services: services,
                                category: category,
                                coordinates: {
                                    lat: vendor.latitude || getRandomLat(),
                                    lng: vendor.longitude || getRandomLng()
                                },
                                priceLevel: vendor.priceLevel || getRandomPriceLevel(),
                                isPremium: vendor.IsPremium || false,
                                isEcoFriendly: vendor.IsEcoFriendly || false,
                                isAwardWinning: vendor.IsAwardWinning || false,
                                reviews: vendor.reviews || generateSampleReviews()
                            };
                        });
                        
                        state.filteredVendors = [...state.vendors];
                        
                        // Update UI
                        updateMetadata({ total: state.filteredVendors.length });
                        renderVendors();
                        
                    } else {
                        showError("No vendor data found");
                    }
                } catch (error) {
                    console.error('Error loading vendors:', error);
                    throw error;
                }
            }
            
            // Helper function to generate sample reviews
            function generateSampleReviews() {
                const reviews = [];
                const reviewTexts = [
                    "Great service! Would definitely book again.",
                    "Very professional and easy to work with.",
                    "The venue was perfect for our event.",
                    "Everything went smoothly, highly recommend!",
                    "Good quality but communication could be better.",
                    "Delivered exactly what was promised."
                ];
                
                const names = ["John D.", "Sarah M.", "Michael T.", "Emily R.", "David K.", "Jessica L."];
                
                for (let i = 0; i < 5; i++) {
                    reviews.push({
                        id: `review-${i}`,
                        user: names[i],
                        rating: Math.floor(Math.random() * 2) + 4, // 4 or 5
                        comment: reviewTexts[i],
                        date: new Date(Date.now() - Math.floor(Math.random() * 30) * 24 * 60 * 60 * 1000).toISOString()
                    });
                }
                
                return reviews;
            }
            
            // Helper function to map vendor types to categories
            function mapTypeToCategory(type) {
                const typeMap = {
                    "Photography": "photo",
                    "Photo": "photo",
                    "Videography": "photo",
                    "Entertainment": "entertainment",
                    "Music": "music",
                    "DJ": "music",
                    "Decor": "decor",
                    "Florist": "decor",
                    "Catering": "catering",
                    "Food": "catering",
                    "Venue": "venue",
                    "Hotel": "venue",
                    "Transportation": "transport",
                };
                return typeMap[type] || type.toLowerCase();
            }

            // Check for existing user session
            async function checkAuthStatus() {
                const token = localStorage.getItem('token');
                if (!token) return;
                
                try {
                    const response = await fetch(`${API_BASE_URL}/users/me`, {
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });
                    
                    if (response.ok) {
                        const userData = await response.json();
                        simulateLogin({
                            name: userData.name || userData.email.split('@')[0],
                            email: userData.email,
                            avatar: userData.name ? userData.name[0].toUpperCase() : userData.email[0].toUpperCase(),
                            isVendor: userData.isVendor || false
                        });
                        
                        // Load user favorites
                        await loadUserFavorites();
                        
                        // Load notifications
                        await loadNotifications();
                    }
                } catch (error) {
                    console.error('Auth check failed:', error);
                    localStorage.removeItem('token');
                }
            }
            
            // Load user favorites
            async function loadUserFavorites() {
                if (!currentUser) return;
                
                try {
                    const response = await fetch(`${API_BASE_URL}/favorites/user/${currentUser.id}`, {
                        headers: {
                            'Authorization': `Bearer ${localStorage.getItem('token')}`
                        }
                    });
                    
                    if (response.ok) {
                        const favorites = await response.json();
                        state.favorites = favorites.map(fav => fav.vendorProfileId);
                        
                        // Update favorites badge
                        document.querySelectorAll('.badge').forEach(badge => {
                            if (badge.id === 'favorites-badge' || !badge.id) {
                                badge.textContent = state.favorites.length;
                            }
                        });
                    }
                } catch (error) {
                    console.error('Error loading favorites:', error);
                }
            }
            
            // Load notifications
            async function loadNotifications() {
                if (!currentUser) return;
                
                try {
                    const response = await fetch(`${API_BASE_URL}/notifications/user/${currentUser.id}?unreadOnly=true`, {
                        headers: {
                            'Authorization': `Bearer ${localStorage.getItem('token')}`
                        }
                    });
                    
                    if (response.ok) {
                        const notifications = await response.json();
                        const unreadCount = notifications.length;
                        
                        // Update notifications badge
                        document.querySelectorAll('.badge').forEach(badge => {
                            if (badge.id === 'notifications-badge' || badge.id === 'dashboard-notifications-badge' || badge.id === 'vendor-notifications-badge' || !badge.id) {
                                badge.textContent = unreadCount;
                            }
                        });
                    }
                } catch (error) {
                    console.error('Error loading notifications:', error);
                }
            }
            
            // Initialize Stripe
            function initializeStripe() {
                state.stripe = Stripe('pk_test_YOUR_STRIPE_PUBLIC_KEY'); // Replace with your Stripe public key
                state.elements = state.stripe.elements();
            }
            
            // Connect to Socket.IO for chat
            function connectToChat() {
                state.socket = io(API_BASE_URL, {
                    auth: {
                        token: localStorage.getItem('token')
                    }
                });
                
                state.socket.on('connect', () => {
                    console.log('Connected to chat server');
                });
                
                state.socket.on('disconnect', () => {
                    console.log('Disconnected from chat server');
                });
                
                state.socket.on('chat-message', (message) => {
                    addChatMessage(message);
                });
                
                state.socket.on('chat-history', (messages) => {
                    state.chatMessages = messages;
                    renderChatMessages();
                });
            }
            
            // Add a chat message to the UI
            function addChatMessage(message) {
                state.chatMessages.push(message);
                renderChatMessage(message);
            }
            
            // Render all chat messages
            function renderChatMessages() {
                const chatContainer = document.getElementById('chat-messages') || 
                                      document.getElementById('dashboard-chat-messages') || 
                                      document.getElementById('vendor-chat-messages');
                
                if (chatContainer) {
                    chatContainer.innerHTML = '';
                    state.chatMessages.forEach(message => {
                        renderChatMessage(message, chatContainer);
                    });
                }
            }
            
            // Render a single chat message
            function renderChatMessage(message, container) {
                const chatContainer = container || 
                                      document.getElementById('chat-messages') || 
                                      document.getElementById('dashboard-chat-messages') || 
                                      document.getElementById('vendor-chat-messages');
                
                if (!chatContainer) return;
                
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${message.sender === currentUser.email ? 'sent' : 'received'}`;
                
                const messageDate = new Date(message.timestamp);
                const timeString = messageDate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                
                messageDiv.innerHTML = `
                    <div class="message-content">${message.content}</div>
                    <div class="message-time">${timeString}</div>
                `;
                
                chatContainer.appendChild(messageDiv);
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }
            
            // New improved location request function
            function requestLocationWithFeedback() {
                console.log("Attempting to get location...");
                if (!navigator.geolocation) {
                    console.log("Geolocation not supported by this browser");
                    return;
                }

                // Visual feedback
                locationInput.placeholder = "Detecting your location...";
                
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        console.log("Location obtained:", position);
                        handleLocationSuccess(position);
                    },
                    (error) => {
                        console.log("Location error:", error);
                        locationInput.placeholder = "City or ZIP code";
                        
                        if (error.code === error.PERMISSION_DENIED) {
                            // Only show modal if this is a fresh page load
                            if (!sessionStorage.getItem('locationRequested')) {
                                locationPermissionModal.style.display = 'flex';
                                sessionStorage.setItem('locationRequested', 'true');
                            }
                        }
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 0
                    }
                );
            }
            
            // Modified location success handler
            function handleLocationSuccess(position) {
                state.userLocation = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                };
                
                // Update UI
                currentLocationCheckbox.checked = true;
                document.getElementById('within50').checked = true;
                locationInput.value = "Near You";
                locationInput.placeholder = "Near You";
                
                filterVendors();
                
                if (state.map) {
                    centerMapOnUser();
                }
            }
            
            // Google Maps initialization
            function initMap() {
                if (state.filteredVendors.length === 0) return;
                
                // Default to first vendor's location or user location if available
                const center = state.userLocation || 
                               { lat: state.filteredVendors[0].coordinates.lat, 
                                 lng: state.filteredVendors[0].coordinates.lng };
                
                // Create map
                state.map = new google.maps.Map(document.getElementById("map"), {
                    zoom: 12,
                    center: center,
                    styles: [
                        {
                            "featureType": "poi",
                            "stylers": [
                                { "visibility": "off" }
                            ]
                        }
                    ]
                });
                
                // Add markers
                updateMapMarkers();
                
                // Center map on user location if available
                if (state.userLocation) {
                    centerMapOnUser();
                }
            }
            
            // Helper function to generate random coordinates (for demo)
            function getRandomLat() { return 34.0522 + (Math.random() * 0.2 - 0.1); }
            function getRandomLng() { return -118.2437 + (Math.random() * 0.2 - 0.1); }
            
            // Helper function to generate random price level (for demo)
            function getRandomPriceLevel() {
                const levels = ['$', '$$', '$$$'];
                return levels[Math.floor(Math.random() * levels.length)];
            }
            
            // Setup all event listeners
            function setupEventListeners() {
                // Search
                searchInput.addEventListener('input', filterVendors);
                
                // Sorting
                sortSelect.addEventListener('change', sortVendors);
                
                // Filter resets
                filterResetBtns.forEach(btn => {
                    btn.addEventListener('click', () => {
                        const filterType = btn.id.replace('-reset', '');
                        resetFilter(filterType);
                    });
                });
                
                // Filter inputs
                document.querySelectorAll('.filter-section input').forEach(input => {
                    input.addEventListener('change', filterVendors);
                });
                
                // Current location checkbox
                currentLocationCheckbox.addEventListener('change', function() {
                    if (this.checked) {
                        requestLocationWithFeedback();
                    } else {
                        state.userLocation = null;
                        locationInput.value = '';
                        locationInput.placeholder = 'City or ZIP code';
                        filterVendors();
                    }
                });
                
                // Popular filters
                trendingTags.forEach(tag => {
                    tag.addEventListener('click', () => {
                        tag.classList.toggle('active');
                        const filter = tag.dataset.filter;
                        
                        if (tag.classList.contains('active')) {
                            if (!state.filters.popular.includes(filter)) {
                                state.filters.popular.push(filter);
                            }
                        } else {
                            state.filters.popular = state.filters.popular.filter(f => f !== filter);
                        }
                        
                        filterVendors();
                    });
                });
                
                // Advanced filters toggle
                advancedToggle.addEventListener('click', () => {
                    advancedContent.classList.toggle('show');
                    advancedToggle.querySelector('span').textContent = 
                        advancedContent.classList.contains('show') ? '−' : '+';
                });
                
                // Date filters
                document.getElementById('start-date').addEventListener('change', function() {
                    state.filters.startDate = this.value;
                    filterVendors();
                });
                
                document.getElementById('end-date').addEventListener('change', function() {
                    state.filters.endDate = this.value;
                    filterVendors();
                });
                
                // Region filter
                document.getElementById('region-select').addEventListener('change', function() {
                    state.filters.region = this.value;
                    filterVendors();
                });
                
                // Pagination
                prevPageBtn.addEventListener('click', () => {
                    if (state.currentPage > 1) {
                        state.currentPage--;
                        renderVendors();
                    }
                });
                
                nextPageBtn.addEventListener('click', () => {
                    const totalPages = Math.ceil(state.filteredVendors.length / state.itemsPerPage);
                    if (state.currentPage < totalPages) {
                        state.currentPage++;
                        renderVendors();
                    }
                });
                
                // User nav buttons
                wishlistBtn.addEventListener('click', () => {
                    if (currentUser) {
                        showDashboard('favorites');
                    } else {
                        profileModal.style.display = 'flex';
                    }
                });
                
                notificationsBtn.addEventListener('click', () => {
                    if (currentUser) {
                        showDashboard('notifications');
                    } else {
                        profileModal.style.display = 'flex';
                    }
                });
                
                // Profile button click handler
                profileBtn.addEventListener('click', () => {
                    // Check if user is logged in
                    if (currentUser) {
                        showLoggedInView();
                    } else {
                        showLoginView();
                    }
                    profileModal.style.display = 'flex';
                });
                
                // Close profile modal
                closeProfileModal.addEventListener('click', () => {
                    profileModal.style.display = 'none';
                });
                profileModal.addEventListener('click', (e) => e.target === profileModal && (profileModal.style.display = 'none'));
                
                // Toggle between login and signup forms
                showSignup.addEventListener('click', (e) => {
                    e.preventDefault();
                    showSignupView();
                });
                
                showLogin.addEventListener('click', (e) => {
                    e.preventDefault();
                    showLoginView();
                });
                
                // Login with email/password
                loginBtn.addEventListener('click', async () => {
                    const email = document.getElementById('login-email').value;
                    const password = document.getElementById('login-password').value;
                    
                    if (!email || !password) {
                        alert('Please enter both email and password');
                        return;
                    }
                    
                    try {
                        const response = await fetch(`${API_BASE_URL}/users/login`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({ email, password }),
                        });
                        
                        if (!response.ok) {
                            throw new Error('Login failed');
                        }
                        
                        const userData = await response.json();
                        
                        // Store the token in localStorage
                        localStorage.setItem('token', userData.token);
                        
                        // Update UI with user data
                        simulateLogin({
                            id: userData.userId,
                            name: userData.name || userData.email.split('@')[0],
                            email: userData.email,
                            avatar: userData.name ? userData.name[0].toUpperCase() : userData.email[0].toUpperCase(),
                            isVendor: userData.isVendor || false
                        });
                    } catch (error) {
                        console.error('Login error:', error);
                        alert('Login failed. Please check your credentials and try again.');
                    }
                });
                
                // Sign up with email/password
                signupBtn.addEventListener('click', async () => {
                    const name = document.getElementById('signup-name').value;
                    const email = document.getElementById('signup-email').value;
                    const password = document.getElementById('signup-password').value;
                    const accountType = document.getElementById('account-type').value;
                    
                    if (!name || !email || !password) {
                        alert('Please fill in all fields');
                        return;
                    }
                    
                    if (password.length < 6) {
                        alert('Password should be at least 6 characters');
                        return;
                    }
                    
                    try {
                        const response = await fetch(`${API_BASE_URL}/users/register`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({ 
                                name, 
                                email, 
                                password,
                                isVendor: accountType === 'vendor'
                            }),
                        });
                        
                        if (!response.ok) {
                            throw new Error('Signup failed');
                        }
                        
                        const userData = await response.json();
                        
                        // Store the token
                        localStorage.setItem('token', userData.token);
                        
                        // Update UI with user data
                        simulateLogin({
                            id: userData.userId,
                            name: userData.name,
                            email: userData.email,
                            avatar: userData.name[0].toUpperCase(),
                            isVendor: userData.isVendor || false
                        });
                        
                        // If signing up as vendor, show registration form
                        if (accountType === 'vendor') {
                            profileModal.style.display = 'none';
                            vendorRegistrationModal.style.display = 'flex';
                        }
                    } catch (error) {
                        console.error('Signup error:', error);
                        alert('Signup failed. The email might already be in use.');
                    }
                });
                
                // Google Login Handler
                googleLoginBtn.addEventListener('click', () => {
                    google.accounts.id.initialize({
                        client_id: '900405597637-50g402qo0kbh2msi9bqii8e9od6oq0fk.apps.googleusercontent.com', // Replace with your actual Google Client ID
                        callback: handleGoogleSignIn
                    });
                    google.accounts.id.prompt();
                });

                // Handle Google Sign-In
                function handleGoogleSignIn(response) {
                    const responsePayload = decodeJWT(response.credential);
                    
                    // Send the Google token to your backend for verification
                    fetch(`${API_BASE_URL}/users/google-auth`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ token: response.credential }),
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.token) {
                            localStorage.setItem('token', data.token);
                            simulateLogin({
                                id: data.userId,
                                name: data.name,
                                email: data.email,
                                avatar: data.name ? data.name[0].toUpperCase() : data.email[0].toUpperCase(),
                                isVendor: data.isVendor || false
                            });
                        }
                    })
                    .catch(error => {
                        console.error('Google login error:', error);
                        alert('Google login failed. Please try again.');
                    });
                }

                // Decode JWT token
                function decodeJWT(token) {
                    const base64Url = token.split('.')[1];
                    const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
                    const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
                    }).join(''));
                    return JSON.parse(jsonPayload);
                }

                // Facebook Login Handler
                facebookLoginBtn.addEventListener('click', () => {
                    FB.login(function(response) {
                        if (response.authResponse) {
                            // Send the Facebook token to your backend for verification
                            fetch(`${API_BASE_URL}/users/facebook-auth`, {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                                body: JSON.stringify({ token: response.authResponse.accessToken }),
                            })
                            .then(response => response.json())
                            .then(data => {
                                if (data.token) {
                                    localStorage.setItem('token', data.token);
                                    simulateLogin({
                                        id: data.userId,
                                        name: data.name,
                                        email: data.email,
                                        avatar: data.name ? data.name[0].toUpperCase() : data.email[0].toUpperCase(),
                                        isVendor: data.isVendor || false
                                    });
                                }
                            })
                            .catch(error => {
                                console.error('Facebook login error:', error);
                                alert('Facebook login failed. Please try again.');
                            });
                        }
                    }, {scope: 'public_profile,email'});
                });
                
                // Logout handler
                logoutBtn.addEventListener('click', () => {
                    // Clear the token from storage
                    localStorage.removeItem('token');
                    
                    currentUser = null;
                    showLoginView();
                    alert('You have been logged out');
                    // Reset profile button
                    profileBtn.textContent = '👤';
                    profileBtn.style.backgroundColor = '';
                    profileBtn.style.color = '';
                    profileBtn.style.borderRadius = '';
                    profileBtn.style.width = '';
                    profileBtn.style.height = '';
                    profileBtn.style.display = '';
                    profileBtn.style.alignItems = '';
                    profileBtn.style.justifyContent = '';
                    
                    // Hide dashboard if shown
                    appContainer.style.display = 'grid';
                    dashboardContainer.style.display = 'none';
                    vendorDashboardContainer.style.display = 'none';
                });
                
                // View dashboard button
                viewDashboardBtn.addEventListener('click', () => {
                    profileModal.style.display = 'none';
                    showDashboard();
                });
                
                // Dashboard menu items
                dashboardMenuItems.forEach(item => {
                    item.addEventListener('click', (e) => {
                        e.preventDefault();
                        const section = item.dataset.section;
                        showDashboard(section);
                    });
                });
                
                // Switch to vendor mode
                switchToVendorBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    if (currentUser.isVendor) {
                        showVendorDashboard();
                    } else {
                        vendorRegistrationModal.style.display = 'flex';
                    }
                });
                
                // Switch to client mode
                switchToClientBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    showDashboard();
                });
                
                // Logout from dashboard
                logoutDashboardBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    logoutBtn.click();
                });
                
                // Logout from vendor dashboard
                vendorLogoutBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    logoutBtn.click();
                });
                
                // Add service field in vendor registration
                addServiceFieldBtn.addEventListener('click', () => {
                    const serviceFieldGroup = document.createElement('div');
                    serviceFieldGroup.className = 'service-field-group';
                    serviceFieldGroup.style.marginBottom = '1rem';
                    serviceFieldGroup.style.paddingBottom = '1rem';
                    serviceFieldGroup.style.borderBottom = '1px dashed var(--border)';
                    
                    serviceFieldGroup.innerHTML = `
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label>Service Name</label>
                                    <input type="text" name="service-name[]" required>
                                </div>
                            </div>
                            <div class="form-col">
                                <div class="form-group">
                                    <label>Price</label>
                                    <input type="number" name="service-price[]" min="0" step="0.01" required>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Description</label>
                            <textarea name="service-description[]" rows="2" required></textarea>
                        </div>
                        <button type="button" class="btn btn-outline btn-sm remove-service-btn">Remove Service</button>
                    `;
                    
                    serviceFieldsContainer.appendChild(serviceFieldGroup);
                    
                    // Add event listener to remove button
                    serviceFieldGroup.querySelector('.remove-service-btn').addEventListener('click', () => {
                        serviceFieldGroup.remove();
                    });
                });
                
                // Vendor registration form submission
                vendorRegistrationForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    try {
                        // Collect form data
                        const formData = new FormData();
                        formData.append('businessName', document.getElementById('reg-business-name').value);
                        formData.append('businessType', document.getElementById('reg-business-type').value);
                        formData.append('category', document.getElementById('reg-category').value);
                        formData.append('yearsInBusiness', document.getElementById('reg-years-in-business').value);
                        formData.append('description', document.getElementById('reg-business-description').value);
                        formData.append('email', document.getElementById('reg-business-email').value);
                        formData.append('phone', document.getElementById('reg-business-phone').value);
                        formData.append('address', document.getElementById('reg-business-address').value);
                        formData.append('website', document.getElementById('reg-business-website').value);
                        
                        // Collect services
                        const services = [];
                        document.querySelectorAll('.service-field-group').forEach(group => {
                            services.push({
                                name: group.querySelector('input[name="service-name[]"]').value,
                                price: group.querySelector('input[name="service-price[]"]').value,
                                description: group.querySelector('textarea[name="service-description[]"]').value
                            });
                        });
                        formData.append('services', JSON.stringify(services));
                        
                        // Add files
                        const businessLicense = document.getElementById('business-license').files[0];
                        const taxId = document.getElementById('tax-id').files[0];
                        const portfolio = document.getElementById('portfolio').files[0];
                        
                        if (businessLicense) formData.append('businessLicense', businessLicense);
                        if (taxId) formData.append('taxId', taxId);
                        if (portfolio) formData.append('portfolio', portfolio);
                        
                        const response = await fetch(`${API_BASE_URL}/vendors/register`, {
                            method: 'POST',
                            headers: {
                                'Authorization': `Bearer ${localStorage.getItem('token')}`
                            },
                            body: formData
                        });
                        
                        if (!response.ok) {
                            throw new Error('Registration failed');
                        }
                        
                        const result = await response.json();
                        
                        alert('Vendor registration submitted successfully!');
                        vendorRegistrationModal.style.display = 'none';
                        
                        // Update user to vendor status
                        currentUser.isVendor = true;
                        showVendorDashboard();
                        
                    } catch (error) {
                        console.error('Registration error:', error);
                        alert('Registration failed. Please try again.');
                    }
                });
                
                // Map controls
                document.getElementById('zoom-in')?.addEventListener('click', () => {
                    if (state.map) {
                        state.map.setZoom(state.map.getZoom() + 1);
                    }
                });
                
                document.getElementById('zoom-out')?.addEventListener('click', () => {
                    if (state.map) {
                        state.map.setZoom(state.map.getZoom() - 1);
                    }
                });
                
                locateMeBtn?.addEventListener('click', () => {
                    if (state.userLocation) {
                        centerMapOnUser();
                    } else {
                        requestLocationWithFeedback();
                    }
                });
                
                // Location permission
                allowLocationBtn.addEventListener('click', () => {
                    locationLoading.style.display = 'inline-block';
                    allowLocationBtn.disabled = true;
                    
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            locationPermissionModal.style.display = 'none';
                            handleLocationSuccess(position);
                            locationLoading.style.display = 'none';
                            allowLocationBtn.disabled = false;
                        },
                        (error) => {
                            console.log("Location error:", error);
                            locationPermissionModal.style.display = 'none';
                            locationLoading.style.display = 'none';
                            allowLocationBtn.disabled = false;
                            currentLocationCheckbox.checked = false;
                            alert("Could not get your location. Please try again or enter a location manually.");
                        },
                        {
                            enableHighAccuracy: true,
                            timeout: 10000
                        }
                    );
                });
                
                denyLocationBtn.addEventListener('click', () => {
                    locationPermissionModal.style.display = 'none';
                    currentLocationCheckbox.checked = false;
                });
                
                // Modal close
                document.querySelector('.close-modal').addEventListener('click', closeBookingModal);
                modal.addEventListener('click', (e) => e.target === modal && closeBookingModal());
                
                // Confirmation modal
                document.getElementById('conf-done-btn').addEventListener('click', () => {
                    confirmationModal.style.display = 'none';
                });
            }
            
            // Filter vendors based on current filters
            function filterVendors() {
                // Get search term
                const searchTerm = searchInput.value.toLowerCase();
                
                // Get filter values
                const selectedTypes = [];
                document.querySelectorAll('.filter-section input[type="checkbox"]:checked').forEach(checkbox => {
                    if (checkbox.id !== 'current-location' && checkbox.id !== 'within50') {
                        selectedTypes.push(checkbox.id);
                    }
                });
                
                const priceRange = document.getElementById('price-slider').value;
                const useCurrentLocation = document.getElementById('current-location').checked;
                const within50Miles = document.getElementById('within50').checked;
                const startDate = document.getElementById('start-date').value;
                const endDate = document.getElementById('end-date').value;
                const region = document.getElementById('region-select').value;
                
                // First apply all filters EXCEPT location
                let filtered = state.vendors.filter(vendor => {
                    // Category filter
                    if (state.currentCategory !== 'all' && vendor.category !== state.currentCategory) {
                        return false;
                    }
                    
                    // Search term (vendor name, location, or services)
                    if (searchTerm) {
                        const nameMatch = vendor.name.toLowerCase().includes(searchTerm);
                        const locationMatch = vendor.location.toLowerCase().includes(searchTerm);
                        let serviceMatch = false;
                        
                        if (vendor.services) {
                            serviceMatch = vendor.services.some(category => 
                                category.services.some(service => 
                                    service.name.toLowerCase().includes(searchTerm) || 
                                    service.description.toLowerCase().includes(searchTerm))
                            );
                        }
                        
                        if (!nameMatch && !locationMatch && !serviceMatch) {
                            return false;
                        }
                    }
                    
                 
                    // Vendor type
                    const vendorType = vendor.type?.toLowerCase() || 'independent';
                    if (selectedTypes.length > 0 && !selectedTypes.includes(vendorType)) {
                        return false;
                    }
                    
                    // Price range
                    if (priceRange < 33 && vendor.priceLevel === '$$$') return false;
                    if (priceRange > 66 && vendor.priceLevel === '$') return false;
                    
                    // Popular filters
                    if (state.filters.popular.length > 0) {
                        if (state.filters.popular.includes('premium') && !vendor.IsPremium) return false;
                        if (state.filters.popular.includes('eco-friendly') && !vendor.IsEcoFriendly) return false;
                        if (state.filters.popular.includes('award-winning') && !vendor.IsAwardWinning) return false;
                    }
                    
                    // Date availability filter
                    if (startDate) {
                        // In a real app, you would check vendor availability against the date
                        // For demo, we'll just filter randomly
                        if (Math.random() < 0.7) return false; // 30% chance of being available
                    }
                    
                    // Region filter
                    if (region && vendor.region !== region) {
                        return false;
                    }
                    
                    return true;
                });
                
                // Handle location filter
                let locationMessage = '';
                if (useCurrentLocation && state.userLocation && within50Miles) {
                    // For demo purposes, we'll simulate nearby vendors by filtering the first few
                    const nearbyVendors = filtered.slice(0, 3); // Show first 3 as "nearby"
                    
                    if (nearbyVendors.length > 0) {
                        filtered = nearbyVendors;
                        locationMessage = `${filtered.length} vendors available near you`;
                    } else {
                        // If no nearby vendors, show ALL vendors that match other filters
                        locationMessage = "No vendors near you. Showing all available vendors.";
                    }
                } else {
                    locationMessage = `${filtered.length} vendors available`;
                }
                
                state.filteredVendors = filtered;
                resultsCount.textContent = locationMessage;
                
                // Apply sorting
                sortVendors(false);
                
                // Reset to first page
                state.currentPage = 1;
                
                // Update UI
                updateMetadata({ total: state.filteredVendors.length });
                renderVendors();
                
                // Update map if in map view
                if (state.map) {
                    updateMapMarkers();
                }
            }
            
            // Sort vendors
            function sortVendors(shouldRender = true) {
                const sortValue = sortSelect.value;
                
                switch(sortValue) {
                    case 'price-low':
                        state.filteredVendors.sort((a, b) => {
                            const priceA = a.priceLevel === '$' ? 1 : a.priceLevel === '$$' ? 2 : 3;
                            const priceB = b.priceLevel === '$' ? 1 : b.priceLevel === '$$' ? 2 : 3;
                            return priceA - priceB;
                        });
                        break;
                    case 'price-high':
                        state.filteredVendors.sort((a, b) => {
                            const priceA = a.priceLevel === '$' ? 1 : a.priceLevel === '$$' ? 2 : 3;
                            const priceB = b.priceLevel === '$' ? 1 : b.priceLevel === '$$' ? 2 : 3;
                            return priceB - priceA;
                        });
                        break;
                    case 'popular':
                        state.filteredVendors.sort((a, b) => {
                            const ratingA = parseFloat(a.rating?.split(' ')[0] || 0);
                            const ratingB = parseFloat(b.rating?.split(' ')[0] || 0);
                            return ratingB - ratingA;
                        });
                        break;
                    case 'nearest':
                        if (state.userLocation) {
                            // In a real app, we would calculate distance properly
                            // For demo, we'll just shuffle the array
                            state.filteredVendors.sort(() => Math.random() - 0.5);
                        }
                        break;
                    case 'rating':
                        state.filteredVendors.sort((a, b) => {
                            const ratingA = a.rating || 0;
                            const ratingB = b.rating || 0;
                            return ratingB - ratingA;
                        });
                        break;
                    default: // recommended
                        // Default sorting (could be by relevance, etc.)
                        break;
                }
                
                if (shouldRender) {
                    renderVendors();
                    if (state.map) {
                        updateMapMarkers();
                    }
                }
            }
                     
            // Reset specific filter
            function resetFilter(filterType) {
                switch(filterType) {
                    case 'location':
                        document.getElementById('location-input').value = '';
                        document.getElementById('current-location').checked = false;
                        document.getElementById('within50').checked = false;
                        state.userLocation = null;
                        break;
                    case 'type':
                        document.querySelectorAll('.filter-section input[type="checkbox"]').forEach(checkbox => {
                            checkbox.checked = ['independent', 'company'].includes(checkbox.id);
                        });
                        break;
                    case 'price':
                        document.getElementById('price-slider').value = 40;
                        break;
                    case 'advanced':
                        document.getElementById('start-date').value = '';
                        document.getElementById('end-date').value = '';
                        document.getElementById('region-select').value = '';
                        state.filters.startDate = null;
                        state.filters.endDate = null;
                        state.filters.region = '';
                        break;
                }
                
                filterVendors();
            }
            
            // Render vendor cards
            function renderVendors() {
                if (!state.filteredVendors || state.filteredVendors.length === 0) {
                    vendorGrid.innerHTML = '<div style="grid-column:1/-1;text-align:center;padding:2rem;">No vendors match your filters</div>';
                    updatePagination();
                    return;
                }
                
                // Pagination
                const startIndex = (state.currentPage - 1) * state.itemsPerPage;
                const endIndex = startIndex + state.itemsPerPage;
                const paginatedVendors = state.filteredVendors.slice(startIndex, endIndex);
                
                vendorGrid.innerHTML = '';
                
                paginatedVendors.forEach(vendor => {
                    const isFavorite = state.favorites.includes(vendor.id);
                    
                    const vendorCard = document.createElement('div');
                    vendorCard.className = 'vendor-card';
                    vendorCard.innerHTML = `
                        <div class="vendor-image">
                            ${vendor.image ? `<img src="${vendor.image}" alt="${vendor.name}" style="width:100%;height:100%;object-fit:cover;">` : getCategoryIcon(vendor.category)}
                            ${vendor.isPremium ? '<div class="vendor-badge">Premium</div>' : ''}
                            <div class="vendor-favorite ${isFavorite ? 'active' : ''}" data-id="${vendor.id}">❤</div>
                        </div>
                        <div class="vendor-details">
                            <h3 class="vendor-name">${vendor.name}</h3>
                            <div class="vendor-location">
                                📍 ${vendor.location}
                            </div>
                            <div class="vendor-features">
                                <div class="feature">
                                    <span class="feature-icon">${getCategoryIcon(vendor.category)}</span>
                                    <span>${getCategoryName(vendor.category)}</span>
                                </div>
                                <div class="feature">
                                    <span class="feature-icon">⭐</span>
                                    <span>${vendor.rating || '4.5'} (${vendor.reviews?.length || 25})</span>
                                </div>
                                <div class="feature">
                                    <div class="price-indicator">
                                        ${renderPriceIndicator(vendor.priceLevel)}
                                    </div>
                                </div>
                            </div>
                            <div class="vendor-footer">
                                <div class="vendor-price">${vendor.price || '$500'}<span>starting</span></div>
                                <div class="vendor-actions">
                                    <button class="btn btn-outline save-btn" data-id="${vendor.id}">Save</button>
                                    <button class="btn btn-primary view-btn" data-id="${vendor.id}">View</button>
                                </div>
                            </div>
                        </div>
                    `;
                    vendorGrid.appendChild(vendorCard);
                    
                    // Add event listeners to buttons
                    vendorCard.querySelector('.view-btn').addEventListener('click', () => {
                        openBookingModal(vendor);
                    });
                    
                    vendorCard.querySelector('.save-btn').addEventListener('click', (e) => {
                        e.stopPropagation();
                        toggleFavorite(vendor.id);
                    });
                    
                    vendorCard.querySelector('.vendor-favorite').addEventListener('click', (e) => {
                        e.stopPropagation();
                        toggleFavorite(vendor.id);
                    });
                });
                
                updatePagination();
            }
            
            // Helper function to get category icon
            function getCategoryIcon(category) {
                const icons = {
                    "venue": "🏨",
                    "photo": "📷",
                    "music": "🎵",
                    "catering": "🍽️",
                    "entertainment": "🎭",
                    "experiences": "🌟",
                    "decor": "🎀",
                    "beauty": "💄",
                    "cake": "🎂",
                    "transport": "🚗",
                    "planner": "📋",
                    "fashion": "👗",
                    "stationery": "✉️"
                };
                return icons[category] || "🎉";
            }
            
            // Helper function to get category name
            function getCategoryName(category) {
                const names = {
                    "venue": "Venue",
                    "photo": "Photo/Video",
                    "music": "Music/DJ",
                    "catering": "Catering",
                    "entertainment": "Entertainment",
                    "experiences": "Experiences",
                    "decor": "Decorations",
                    "beauty": "Beauty",
                    "cake": "Cake",
                    "transport": "Transportation",
                    "planner": "Planner",
                    "fashion": "Fashion",
                    "stationery": "Stationery"
                };
                return names[category] || "Vendor";
            }
            
            // Render price indicator
            function renderPriceIndicator(priceLevel) {
                const levels = priceLevel || '$';
                let html = '';
                
                for (let i = 0; i < 3; i++) {
                    const isFilled = i < levels.length;
                    html += `<span class="price-dot ${isFilled ? 'filled' : ''}"></span>`;
                }
                
                return html;
            }
            
            // Update pagination controls
            function updatePagination() {
                const totalPages = Math.ceil(state.filteredVendors.length / state.itemsPerPage);
                
                if (totalPages <= 1) {
                    pagination.style.display = 'none';
                    return;
                }
                
                pagination.style.display = 'flex';
                
                // Clear existing page buttons (except prev/next)
                const pageBtns = pagination.querySelectorAll('.page-btn:not(#prev-page):not(#next-page)');
                pageBtns.forEach(btn => btn.remove());
                
                // Add page buttons
                for (let i = 1; i <= totalPages; i++) {
                    const pageBtn = document.createElement('div');
                    pageBtn.className = `page-btn ${i === state.currentPage ? 'active' : ''}`;
                    pageBtn.textContent = i;
                    pageBtn.addEventListener('click', () => {
                        state.currentPage = i;
                        renderVendors();
                    });
                    
                    pagination.insertBefore(pageBtn, nextPageBtn);
                }
                
                // Update prev/next button states
                prevPageBtn.classList.toggle('disabled', state.currentPage === 1);
                nextPageBtn.classList.toggle('disabled', state.currentPage === totalPages);
            }
            
            // Update metadata in header
            function updateMetadata(metadata) {
                const usingLocation = state.userLocation && document.getElementById('current-location').checked;
                const locationText = usingLocation ? "Near You" : (metadata?.location || 'Los Angeles');
                const categoryText = state.currentCategory === 'all' ? '' : getCategoryName(state.currentCategory) + ' ';
                
                resultsTitle.textContent = `${categoryText}Vendors in ${locationText}`;
                resultsCount.textContent = `${state.filteredVendors.length} vendors available${usingLocation ? ' near you' : ''}`;
            }
            
            // Show error message
            function showError(message) {
                vendorGrid.innerHTML = `<div style="grid-column:1/-1;text-align:center;padding:2rem;color:var(--accent)">${message}</div>`;
                resultsTitle.textContent = "Error";
                resultsCount.textContent = message;
            }
            
            // Open modal with vendor details and services
            function openBookingModal(vendor) {
                state.currentVendor = vendor;
                state.selectedServices = [];
                state.selectedDate = null;
                state.selectedTime = null;
                
                // Create modal content
                modalBody.innerHTML = `
                    <div class="vendor-detail-header">
                        <div class="vendor-detail-image">
                            ${vendor.image ? `<img src="${vendor.image}" alt="${vendor.name}" style="width:100%;height:100%;object-fit:cover;border-radius:var(--radius);">` : getCategoryIcon(vendor.category)}
                        </div>
                        <div class="vendor-detail-info">
                            <h2 class="vendor-detail-name">${vendor.name}</h2>
                            <div class="vendor-detail-location">📍 ${vendor.location}</div>
                            <div class="vendor-detail-features">
                                <div class="feature">
                                    <span class="feature-icon">${getCategoryIcon(vendor.category)}</span>
                                    <span>${getCategoryName(vendor.category)}</span>
                                </div>
                                <div class="feature">
                                    <span class="feature-icon">⭐</span>
                                    <span>${vendor.rating || '4.5'} (${vendor.reviews?.length || 25})</span>
                                </div>
                                <div class="feature">
                                    <div class="price-indicator">
                                        ${renderPriceIndicator(vendor.priceLevel)}
                                    </div>
                                </div>
                            </div>
                            <div class="vendor-detail-price">${vendor.price || '$500'}</div>
                        </div>
                    </div>
                    
                    <div class="vendor-detail-description">
                        <p>${vendor.description || "A professional vendor for your special event. Contact us for more details about our services."}</p>
                    </div>
                    
                    <div class="services-section">
                        <h3 class="services-title">Available Services</h3>
                        ${vendor.services && vendor.services.length > 0 ? 
                            renderServices(vendor.services) : 
                            '<p>No services available for this vendor.</p>'}
                    </div>
                    
                    <div class="booking-calendar-section">
                        <h3 class="calendar-title">Select Date & Time</h3>
                        <div id="booking-calendar"></div>
                        <div class="time-slots" id="time-slots"></div>
                    </div>
                    
                    <div class="reviews-section">
                        <h3 class="reviews-title">Customer Reviews</h3>
                        ${vendor.reviews && vendor.reviews.length > 0 ? 
                            renderReviews(vendor.reviews) : 
                            '<p>No reviews yet.</p>'}
                        
                        ${currentUser ? `
                            <button class="btn btn-outline add-review-btn" id="show-review-form">Add Review</button>
                            <div class="review-form" id="review-form" style="display: none;">
                                <div class="rating-input">
                                    <span class="rating-star" data-rating="1">☆</span>
                                    <span class="rating-star" data-rating="2">☆</span>
                                    <span class="rating-star" data-rating="3">☆</span>
                                    <span class="rating-star" data-rating="4">☆</span>
                                    <span class="rating-star" data-rating="5">☆</span>
                                </div>
                                <textarea class="review-textarea" id="review-text" placeholder="Share your experience..."></textarea>
                                <button class="btn btn-primary" id="submit-review">Submit Review</button>
                            </div>
                        ` : '<p><a href="#" id="login-to-review" style="color: var(--primary);">Log in</a> to leave a review</p>'}
                    </div>
                    
                    <div class="chat-section">
                        <h3 class="chat-title">Message Vendor</h3>
                        <div class="chat-container">
                            <div class="chat-messages" id="chat-messages">
                                <div class="message received">
                                    <div class="message-content">Hello! How can I help you with your booking?</div>
                                    <div class="message-time">Today, 10:30 AM</div>
                                </div>
                            </div>
                            <div class="chat-input">
                                <input type="text" placeholder="Type your message..." id="chat-input">
                                <button class="btn btn-primary" id="send-btn">Send</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="payment-section" id="payment-section" style="display: none;">
                        <h3 class="payment-title">Payment Information</h3>
                        <div class="payment-form">
                            <div class="form-group">
                                <label>Cardholder Name</label>
                                <input type="text" id="cardholder-name">
                            </div>
                            <div class="card-element" id="card-element"></div>
                            <button class="btn btn-primary" id="pay-now-btn">Pay Now</button>
                        </div>
                    </div>
                    
                    <div class="vendor-actions" style="margin-top: 2rem; justify-content: center;">
                        <button class="btn btn-primary" id="book-now-btn">Book Now</button>
                    </div>
                `;
                
                // Initialize booking calendar
                initBookingCalendar();
                
                // Add event listeners to service buttons
                document.querySelectorAll('.add-service-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const serviceName = this.dataset.service;
                        const serviceIndex = state.selectedServices.indexOf(serviceName);
                        
                        if (serviceIndex === -1) {
                            state.selectedServices.push(serviceName);
                            this.classList.add('active');
                            this.textContent = 'Added';
                        } else {
                            state.selectedServices.splice(serviceIndex, 1);
                            this.classList.remove('active');
                            this.textContent = 'Add';
                        }
                    });
                });
                
                // Show review form
                document.getElementById('show-review-form')?.addEventListener('click', () => {
                    document.getElementById('review-form').style.display = 'block';
                });
                
                // Rating stars
                document.querySelectorAll('.rating-star').forEach(star => {
                    star.addEventListener('click', function() {
                        const rating = parseInt(this.dataset.rating);
                        const stars = document.querySelectorAll('.rating-star');
                        
                        stars.forEach((s, index) => {
                            if (index < rating) {
                                s.textContent = '★';
                                s.classList.add('selected');
                            } else {
                                s.textContent = '☆';
                                s.classList.remove('selected');
                            }
                        });
                    });
                });
                
                // Submit review
                document.getElementById('submit-review')?.addEventListener('click', async () => {
                    const rating = document.querySelectorAll('.rating-star.selected').length;
                    const reviewText = document.getElementById('review-text').value;
                    
                    if (!rating) {
                        alert('Please select a rating');
                        return;
                    }
                    
                    if (!reviewText) {
                        alert('Please write your review');
                        return;
                    }
                    
                    try {
                        const response = await fetch('https://bdb-3-0-venuevue-api.onrender.com/api/reviews', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${localStorage.getItem('token')}`
                            },
                            body: JSON.stringify({
                                vendorId: vendor.id,
                                rating: rating,
                                comment: reviewText
                            })
                        });
                        
                        if (!response.ok) {
                            throw new Error('Failed to submit review');
                        }
                        
                        alert('Thank you for your review!');
                        document.getElementById('review-form').style.display = 'none';
                        
                        // Refresh reviews
                        const newReview = {
                            id: `review-${Date.now()}`,
                            user: currentUser.name,
                            rating: rating,
                            comment: reviewText,
                            date: new Date().toISOString()
                        };
                        
                        if (!vendor.reviews) vendor.reviews = [];
                        vendor.reviews.unshift(newReview);
                        
                        // Update UI
                        document.querySelector('.reviews-section').innerHTML = `
                            <h3 class="reviews-title">Customer Reviews</h3>
                            ${renderReviews(vendor.reviews)}
                            <button class="btn btn-outline add-review-btn" id="show-review-form">Add Review</button>
                        `;
                        
                        // Reattach event listener
                        document.getElementById('show-review-form').addEventListener('click', () => {
                            document.getElementById('review-form').style.display = 'block';
                        });
                        
                    } catch (error) {
                        console.error('Review submission error:', error);
                        alert('Failed to submit review. Please try again.');
                    }
                });
                
                // Login to review
                document.getElementById('login-to-review')?.addEventListener('click', (e) => {
                    e.preventDefault();
                    closeBookingModal();
                    profileModal.style.display = 'flex';
                });
                
                // Chat input
                document.getElementById('send-btn')?.addEventListener('click', sendChatMessage);
                document.getElementById('chat-input')?.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        sendChatMessage();
                    }
                });
                
                // Book now button
                document.getElementById('book-now-btn').addEventListener('click', function() {
                    if (!currentUser) {
                        closeBookingModal();
                        profileModal.style.display = 'flex';
                        return;
                    }
                    
                    if (state.selectedServices.length === 0) {
                        alert('Please select at least one service');
                        return;
                    }
                    
                    if (!state.selectedDate || !state.selectedTime) {
                        alert('Please select a date and time');
                        return;
                    }
                    
                    // Show payment section
                    document.getElementById('payment-section').style.display = 'block';
                    this.style.display = 'none';
                    
                    // Initialize Stripe Elements
                    const card = state.elements.create('card');
                    card.mount('#card-element');
                    
                    // Handle payment
                    document.getElementById('pay-now-btn').addEventListener('click', async () => {
                        const cardholderName = document.getElementById('cardholder-name').value;
                        
                        if (!cardholderName) {
                            alert('Please enter cardholder name');
                            return;
                        }
                        
                        try {
                            // Create payment intent
                            const response = await fetch('https://bdb-3-0-venuevue-api.onrender.com/api/payments/create-payment-intent', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'Authorization': `Bearer ${localStorage.getItem('token')}`
                                },
                                body: JSON.stringify({
                                    amount: calculateTotalAmount(),
                                    currency: 'usd'
                                })
                            });
                            
                            if (!response.ok) {
                                throw new Error('Failed to create payment intent');
                            }
                            
                            const { clientSecret } = await response.json();
                            
                            // Confirm payment
                            const { error, paymentIntent } = await state.stripe.confirmCardPayment(clientSecret, {
                                payment_method: {
                                    card: card,
                                    billing_details: {
                                        name: cardholderName
                                    }
                                }
                            });
                            
                            if (error) {
                                throw error;
                            }
                            
                            // Payment successful - create booking
                            await bookVendor(vendor);
                            
                        } catch (error) {
                            console.error('Payment error:', error);
                            alert('Payment failed. Please try again.');
                        }
                    });
                });
                
                modal.style.display = 'flex';
                document.body.style.overflow = 'hidden';
            }
            
            // Initialize booking calendar
            function initBookingCalendar() {
                const calendarEl = document.getElementById('booking-calendar');
                const calendar = new FullCalendar.Calendar(calendarEl, {
                    initialView: 'dayGridMonth',
                    selectable: true,
                    select: function(info) {
                        state.selectedDate = info.startStr;
                        state.selectedTime = null;
                        
                        // Generate time slots
                        generateTimeSlots();
                    }
                });
                calendar.render();
            }
            
            // Generate time slots for selected date
            function generateTimeSlots() {
                const timeSlotsContainer = document.getElementById('time-slots');
                timeSlotsContainer.innerHTML = '';
                
                // Generate sample time slots (in a real app, these would come from vendor availability)
                const slots = [
                    '9:00 AM', '10:00 AM', '11:00 AM', '12:00 PM', 
                    '1:00 PM', '2:00 PM', '3:00 PM', '4:00 PM'
                ];
                
                slots.forEach(slot => {
                    const slotEl = document.createElement('div');
                    slotEl.className = 'time-slot';
                    slotEl.textContent = slot;
                    
                    // Mark some slots as unavailable randomly
                    if (Math.random() < 0.3) {
                        slotEl.classList.add('unavailable');
                    } else {
                        slotEl.addEventListener('click', function() {
                            document.querySelectorAll('.time-slot').forEach(s => s.classList.remove('selected'));
                            this.classList.add('selected');
                            state.selectedTime = slot;
                        });
                    }
                    
                    timeSlotsContainer.appendChild(slotEl);
                });
            }
            
            // Calculate total amount for selected services
            function calculateTotalAmount() {
                // In a real app, you would calculate based on actual service prices
                return state.selectedServices.length * 100 * 100; // $100 per service (in cents)
            }
            
            // Send chat message
            function sendChatMessage() {
                const input = document.getElementById('chat-input') || 
                              document.getElementById('dashboard-chat-input') || 
                              document.getElementById('vendor-chat-input');
                const message = input.value.trim();
                
                if (!message) return;
                
                if (!currentUser) {
                    alert('Please login to send messages');
                    return;
                }
                
                const chatMessage = {
                    sender: currentUser.email,
                    recipient: state.currentVendor?.email || 'vendor@example.com',
                    content: message,
                    timestamp: new Date().toISOString()
                };
                
                // In a real app, you would send this to your backend via Socket.IO
                state.socket.emit('chat-message', chatMessage);
                
                // Add to UI
                addChatMessage({
                    ...chatMessage,
                    sender: currentUser.email,
                    isCurrentUser: true
                });
                
                // Clear input
                input.value = '';
            }
            
            // Book vendor function
            async function bookVendor(vendor) {
                const token = localStorage.getItem('token');
                if (!token) {
                    alert('Please login to book a vendor');
                    profileModal.style.display = 'flex';
                    showLoginView();
                    return;
                }

                try {
                    const response = await fetch('https://bdb-3-0-venuevue-api.onrender.com/api/bookings', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${token}`
                        },
                        body: JSON.stringify({
                            vendorId: vendor.id,
                            services: state.selectedServices,
                            date: state.selectedDate,
                            time: state.selectedTime,
                            amount: calculateTotalAmount() / 100 // Convert back to dollars
                        })
                    });

                    if (!response.ok) {
                        throw new Error('Booking failed');
                    }

                    const bookingData = await response.json();
                    
                    // Update confirmation modal
                    document.getElementById('conf-venue-name').textContent = vendor.name;
                    document.getElementById('conf-services').textContent = state.selectedServices.join(', ');
                    document.getElementById('conf-date').textContent = new Date(state.selectedDate).toLocaleDateString('en-US', { 
                        year: 'numeric', 
                        month: 'long', 
                        day: 'numeric' 
                    });
                    document.getElementById('conf-time').textContent = state.selectedTime;
                    document.getElementById('conf-id').textContent = bookingData._id;
                    
                    // Show confirmation
                    closeBookingModal();
                    confirmationModal.style.display = 'flex';
                    
                    // In a real app, you would send a confirmation email
                    
                } catch (error) {
                    console.error('Booking error:', error);
                    alert('Booking failed. Please try again.');
                }
            }
            
            // Render services for a vendor
            function renderServices(services) {
                return services.map(category => `
                    <div class="service-category">
                        <h4 class="category-title">${category.category}</h4>
                        <div class="service-grid">
                            ${category.services.map(service => `
                                <div class="service-card">
                                    <div class="service-name">${service.name}</div>
                                    <div class="service-description">${service.description}</div>
                                    <div class="service-price">${service.price}</div>
                                    <div class="service-actions">
                                        <button class="btn btn-outline btn-sm add-service-btn" data-service="${service.name}">Add</button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `).join('');
            }
            
            // Render reviews for a vendor
            function renderReviews(reviews) {
                return reviews.map(review => `
                    <div class="review-card">
                        <div class="review-header">
                            <div class="reviewer">${review.user}</div>
                            <div class="review-date">${new Date(review.date).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</div>
                        </div>
                        <div class="review-rating">${'★'.repeat(review.rating)}${'☆'.repeat(5 - review.rating)}</div>
                        <div class="review-text">${review.comment}</div>
                    </div>
                `).join('');
            }
            
            // Close modal
            function closeBookingModal() {
                modal.style.display = 'none';
                document.body.style.overflow = 'auto';
            }
            
            // Show login view in profile modal
            function showLoginView() {
                loginForm.style.display = 'block';
                signupForm.style.display = 'none';
                loggedInView.style.display = 'none';
                document.getElementById('profile-modal-title').textContent = 'Welcome to VenueVue';
                // Clear form fields
                document.getElementById('login-email').value = '';
                document.getElementById('login-password').value = '';
            }
            
            // Show signup view in profile modal
            function showSignupView() {
                loginForm.style.display = 'none';
                signupForm.style.display = 'block';
                loggedInView.style.display = 'none';
                document.getElementById('profile-modal-title').textContent = 'Create an Account';
                // Clear form fields
                document.getElementById('signup-name').value = '';
                document.getElementById('signup-email').value = '';
                document.getElementById('signup-password').value = '';
            }
            
            // Show logged in view in profile modal
            function showLoggedInView() {
                loginForm.style.display = 'none';
                signupForm.style.display = 'none';
                loggedInView.style.display = 'block';
                document.getElementById('profile-modal-title').textContent = 'My Account';
                
                // Update user info
                document.getElementById('profile-name').textContent = currentUser.name;
                document.getElementById('profile-email').textContent = currentUser.email;
                document.getElementById('profile-avatar').textContent = currentUser.avatar;
            }
            
            // Show dashboard
            function showDashboard(section = 'dashboard') {
                appContainer.style.display = 'none';
                vendorDashboardContainer.style.display = 'none';
                dashboardContainer.style.display = 'grid';
                
                // Update active menu item
                dashboardMenuItems.forEach(item => {
                    item.classList.remove('active');
                    if (item.dataset.section === section) {
                        item.classList.add('active');
                    }
                });
                
                // Show the selected section
                document.getElementById('dashboard-section').style.display = 'none';
                document.getElementById('bookings-section').style.display = 'none';
                document.getElementById('favorites-section').style.display = 'none';
                document.getElementById('messages-section').style.display = 'none';
                document.getElementById('reviews-section').style.display = 'none';
                document.getElementById('settings-section').style.display = 'none';
                
                document.getElementById(`${section}-section`).style.display = 'block';
                document.getElementById('dashboard-title').textContent = 
                    section.charAt(0).toUpperCase() + section.slice(1).replace('-', ' ');
                
                // Load data for the section
                if (section === 'favorites') {
                    loadFavorites();
                }
            }
            
            // Show vendor dashboard
            function showVendorDashboard() {
                appContainer.style.display = 'none';
                dashboardContainer.style.display = 'none';
                vendorDashboardContainer.style.display = 'grid';
                
                // Load vendor data
                loadVendorData();
            }
            
            // Load favorites for dashboard
            function loadFavorites() {
                const favoritesContainer = document.getElementById('saved-favorites');
                favoritesContainer.innerHTML = '';
                
                // In a real app, you would fetch these from the backend
                const favoriteVendors = state.vendors.slice(0, 3); // Demo - first 3 vendors as favorites
                
                if (favoriteVendors.length === 0) {
                    favoritesContainer.innerHTML = '<p>No favorites saved yet.</p>';
                    return;
                }
                
                favoriteVendors.forEach(vendor => {
                    const vendorCard = document.createElement('div');
                    vendorCard.className = 'vendor-card';
                    vendorCard.innerHTML = `
                        <div class="vendor-image">
                            ${vendor.image ? `<img src="${vendor.image}" alt="${vendor.name}" style="width:100%;height:100%;object-fit:cover;">` : getCategoryIcon(vendor.category)}
                            <div class="vendor-favorite active" data-id="${vendor.id}">❤</div>
                        </div>
                        <div class="vendor-details">
                            <h3 class="vendor-name">${vendor.name}</h3>
                            <div class="vendor-location">
                                📍 ${vendor.location}
                            </div>
                            <div class="vendor-footer">
                                <button class="btn btn-primary" style="width: 100%;" data-id="${vendor.id}">View</button>
                            </div>
                        </div>
                    `;
                    
                    favoritesContainer.appendChild(vendorCard);
                    
                    // Add event listener to view button
                    vendorCard.querySelector('button').addEventListener('click', () => {
                        openBookingModal(vendor);
                    });
                    
                    // Add event listener to favorite button
                    vendorCard.querySelector('.vendor-favorite').addEventListener('click', (e) => {
                        e.stopPropagation();
                        toggleFavorite(vendor.id);
                    });
                });
            }
            
            // Load vendor data for dashboard
            function loadVendorData() {
                // In a real app, you would fetch vendor-specific data from the backend
                // This is just a demo with mock data
                
                // Initialize vendor calendar
                const calendarEl = document.getElementById('vendor-availability-calendar');
                if (calendarEl && !calendarEl._fullCalendar) {
                    const calendar = new FullCalendar.Calendar(calendarEl, {
                        initialView: 'dayGridMonth',
                        selectable: true,
                        eventClick: function(info) {
                            alert('Event: ' + info.event.title);
                        }
                    });
                    calendar.render();
                    calendarEl._fullCalendar = calendar;
                }
            }
            
            // Simulate user login (for demo purposes)
            function simulateLogin(user) {
                currentUser = {
                    ...user,
                    isVendor: user.isVendor || false
                };
                
                showLoggedInView();
                profileModal.style.display = 'none';
                alert(`Welcome, ${user.name}! You are now logged in.`);
                
                // Update profile button to show user is logged in
                profileBtn.textContent = user.avatar; // Show first initial
                profileBtn.style.backgroundColor = 'var(--primary)';
                profileBtn.style.color = 'white';
                profileBtn.style.borderRadius = '50%';
                profileBtn.style.width = '36px';
                profileBtn.style.height = '36px';
                profileBtn.style.display = 'flex';
                profileBtn.style.alignItems = 'center';
                profileBtn.style.justifyContent = 'center';
                
                // Update favorites badge
                document.querySelector('.badge').textContent = state.favorites.length;
            }
            
            // Toggle vendor favorite status
            function toggleFavorite(vendorId) {
                if (!currentUser) {
                    profileModal.style.display = 'flex';
                    showLoginView();
                    return;
                }
                
                const index = state.favorites.indexOf(vendorId);
                if (index === -1) {
                    state.favorites.push(vendorId);
                } else {
                    state.favorites.splice(index, 1);
                }
                
                // Update UI
                document.querySelectorAll(`.vendor-favorite[data-id="${vendorId}"]`).forEach(icon => {
                    icon.classList.toggle('active');
                });
                
                // Update badge
                document.querySelector('.badge').textContent = state.favorites.length;
                
                // In a real app, you would save favorites to the backend
            }
            
            // Center map on user location
            function centerMapOnUser() {
                if (state.map && state.userLocation) {
                    state.map.setCenter(new google.maps.LatLng(state.userLocation.lat, state.userLocation.lng));
                    state.map.setZoom(12);
                }
            }
            
            // Update map markers
            function updateMapMarkers() {
                // Clear existing markers
                state.markers.forEach(marker => marker.setMap(null));
                state.markers = [];
                
                // Add new markers
                state.filteredVendors.forEach(vendor => {
                    const marker = new google.maps.Marker({
                        position: { lat: vendor.coordinates.lat, lng: vendor.coordinates.lng },
                        map: state.map,
                        title: vendor.name
                    });
                    
                    state.markers.push(marker);
                    
                    // Add click event to show vendor info
                    marker.addListener('click', () => {
                        openBookingModal(vendor);
                    });
                });
            }
        });
    </script>
</body>
</html>
