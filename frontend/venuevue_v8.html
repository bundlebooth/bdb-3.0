<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <title>VenueVue | Event Vendor Marketplace</title>
    <!-- Add Stripe.js for payment processing -->
    <script src="https://js.stripe.com/v3/"></script>
    <!-- Add FullCalendar for booking dates -->
    <link href='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css' rel='stylesheet' />
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js'></script>
    <!-- Add Socket.IO for chat functionality -->
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <!-- Add Chart.js for analytics graphs -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #5e72e4;
            --secondary: #f7fafc;
            --accent: #ff6b6b;
            --text: #2d3748;
            --text-light: #718096;
            --border: #e2e8f0;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --radius: 12px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        body {
            background-color: #f8fafc;
            color: var(--text);
        }

        .app-container {
            display: grid;
            grid-template-columns: 280px 1fr;
            min-height: 100vh;
        }

        /* Header */
        .header {
            grid-column: 1 / -1;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem 2rem;
            background-color: white;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .search-container {
            flex: 1;
            max-width: 600px;
            margin: 0 2rem;
        }

        .search-bar {
            position: relative;
        }

        .search-bar input {
            width: 100%;
            padding: 0.75rem 1rem 0.75rem 2.5rem;
            border-radius: var(--radius);
            border: 1px solid var(--border);
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .search-bar input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(94, 114, 228, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary);
            cursor: pointer;
        }

        .user-nav {
            display: flex;
            gap: 1.5rem;
            align-items: center;
        }

        .nav-icon {
            position: relative;
            color: var(--text);
            cursor: pointer;
        }

        .nav-icon .badge {
            position: absolute;
            top: -0.5rem;
            right: -0.5rem;
            background-color: var(--accent);
            color: white;
            border-radius: 50%;
            width: 1.25rem;
            height: 1.25rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 600;
        }

        /* Categories Navigation */
        .categories-nav {
            grid-column: 1 / -1;
            background-color: white;
            border-bottom: 1px solid var(--border);
            padding: 0.5rem 1rem;
            display: flex;
            align-items: center;
            position: sticky;
            top: 60px; /* Adjust based on header height */
            z-index: 15;
        }

        .categories-list-wrapper {
            flex-grow: 1;
            overflow-x: auto;
            white-space: nowrap;
            padding: 0.5rem 0;

            -webkit-overflow-scrolling: touch;
        }

        .categories-list-wrapper::-webkit-scrollbar {
            display: none;
        }

        .categories-list-wrapper {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .categories-list {
            display: inline-flex;
            gap: 2rem;
            align-items: center;
        }

        .category-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: color 0.3s ease, transform 0.3s ease;
            position: relative;
            color: var(--text-light);
            min-width: 60px;
        }

        .category-item i {
            font-size: 1.5rem;
            margin-bottom: 0.25rem;
            display: block;
            color: var(--text-light);
            transition: color 0.3s ease;
        }

        .category-item:hover,
        .category-item.active {
            color: var(--primary);
        }

        .category-item.active {
            transform: scale(1.1);
        }

        .category-item.active i {
            color: var(--primary);
        }

        .category-item::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 10%;
            width: 80%;
            height: 2px;
            background-color: var(--primary);
            border-radius: 1px;
            transition: width 0.3s ease, left 0.3s ease;
        }

        .category-item::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 2px;
            background-color: var(--accent);
            border-radius: 1px;
            transition: width 0.3s ease, left 0.3s ease;
        }

        /* New styles for scroll buttons */
        .nav-scroll-btn {
            background-color: var(--secondary);
            border: 1px solid var(--border);
            border-radius: 50%;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            flex-shrink: 0;
            margin: 0 0.5rem;
            box-shadow: var(--shadow);
        }

        .nav-scroll-btn:hover {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Sidebar */
        .sidebar {
            background-color: white;
            padding: 1.5rem;
            border-right: 1px solid var(--border);
            height: calc(100vh - 120px);
            position: sticky;
            top: 120px;
            overflow-y: auto;
        }

        .filter-section {
            margin-bottom: 2rem;
        }

        .filter-title {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--text);
            display: flex;
            justify-content: space-between;
        }

        .filter-reset {
            color: var(--primary);
            font-weight: 500;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .filter-option {
            display: flex;
            align-items: center;
        }

        .filter-option input {
            margin-right: 0.75rem;
            accent-color: var(--primary);
        }

        .filter-option label {
            font-size: 0.9rem;
            color: var(--text);
        }

        .range-slider {
            width: 100%;
            height: 4px;
            margin: 1rem 0;
            -webkit-appearance: none;
            background: var(--border);
            border-radius: 2px;
        }

        .range-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background-color: var(--primary);
            cursor: pointer;
        }

        .price-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            color: var(--text-light);
        }

        /* New Advanced Filters Section */
        .advanced-filters {
            margin-top: 2rem;
            border-top: 1px solid var(--border);
            padding-top: 1.5rem;
        }

        .advanced-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            margin-bottom: 1rem;
        }

        .advanced-content {
            display: none;
        }

        .advanced-content.show {
            display: block;
        }

        .date-picker {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .date-picker input {
            flex: 1;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: var(--radius);
        }

        .region-select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            margin-bottom: 1rem;
        }

        .trending-section {
            margin-top: 2rem;
        }

        .trending-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .trending-tag {
            padding: 0.5rem 0.75rem;
            background-color: var(--secondary);
            border-radius: 20px;
            font-size: 0.8rem;
            color: var(--text);
            cursor: pointer;
            transition: all 0.2s;
        }

        .trending-tag:hover {
            background-color: #e6e9ff;
            color: var(--primary);
        }

        .trending-tag.active {
            background-color: var(--primary);
            color: white;
        }

        /* Main Content */
        .main-content {
            padding: 2rem;
        }
        
        .profile-content {
            padding: 2rem;
            background-color: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            max-width: 900px;
            margin: 0 auto;
        }


        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .results-title {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .results-count {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-top: 0.25rem;
        }

        .view-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .sort-select {
            padding: 0.5rem 1rem;
            border-radius: var(--radius);
            border: 1px solid var(--border);
            background-color: white;
            font-size: 0.9rem;
            color: var(--text);
        }

        .view-toggle {
            display: flex;
            background-color: var(--secondary);
            border-radius: var(--radius);
            overflow: hidden;
        }

        .view-btn {
            padding: 0.5rem 1rem;
            border: none;
            background-color: transparent;
            cursor: pointer;
            transition: all 0.2s;
        }

        .view-btn.active {
            background-color: white;
            color: var(--primary);
            font-weight: 500;
            box-shadow: var(--shadow);
        }

        .map-view-container {
            display: none;
            flex-direction: column;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .map-container {
            height: 400px;
            background-color: white;
            border-radius: var(--radius);
            border: 1px solid var(--border);
            position: relative;
            overflow: hidden;
        }

        #map {
            width: 100%;
            height: 100%;
        }

        .map-controls {
            position: absolute;
            top: 1rem;
            right: 1rem;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            z-index: 100;
        }

        .map-btn {
            width: 32px;
            height: 32px;
            background-color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow);
            cursor: pointer;
            border: 1px solid var(--border);
        }

        .map-venue-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .vendor-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .vendor-card {
            background-color: white;
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
        }

        .vendor-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        .vendor-image {
            height: 180px;
            background-color: #f1f5f9;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-light);
        }

        .vendor-badge {
            position: absolute;
            top: 1rem;
            left: 1rem;
            background-color: var(--primary);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .vendor-favorite {
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 32px;
            height: 32px;
            background-color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--text-light);
            box-shadow: var(--shadow);
            transition: all 0.2s;
        }

        .vendor-favorite.active {
            color: var(--accent);
        }

        .vendor-details {
            padding: 1.25rem;
        }

        .vendor-name {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .vendor-location {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            color: var(--text-light);
            margin-bottom: 1rem;
        }

        .vendor-features {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .feature {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.8rem;
            color: var(--text);
        }

        .feature-icon {
            color: var(--primary);
        }

        .price-indicator {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.9rem;
        }

        .price-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: var(--text-light);
        }

        .price-dot.filled {
            background-color: var(--primary);
        }

        .vendor-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 1rem;
            border-top: 1px solid var(--border);
        }

        .vendor-price {
            font-size: 1.1rem;
            font-weight: 700;
        }

        .vendor-price span {
            font-size: 0.8rem;
            font-weight: 400;
            color: var(--text-light);
        }

        .vendor-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn {
            padding: 0.5rem 1rem;
            border-radius: var(--radius);
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-outline {
            background-color: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
        }

        .btn-outline:hover {
            background-color: rgba(94, 114, 228, 0.1);
        }

        .btn-primary {
            background-color: var(--primary);
            border: 1px solid var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: #4a5acf;
        }

        .pagination {
            display: flex;
            justify-content: center;
            margin-top: 3rem;
            gap: 0.5rem;
        }

        .page-btn {
            width: 40px;
            height: 40px;
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: white;
            border: 1px solid var(--border);
            cursor: pointer;
            font-size: 0.9rem;
            color: var(--text);
        }

        .page-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .page-btn.active {
            background-color: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        /* Booking Modal Styles */
        .modal {
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: white;
            border-radius: 12px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-body {
            padding: 20px;
            overflow-y: auto;
            max-height: calc(90vh - 70px);
        }

        .close-modal {
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close-modal:hover {
            color: var(--primary);
        }
        
        .vendor-profile-header {
            display: flex;
            align-items: center;
            gap: 2rem;
            padding-bottom: 2rem;
        }

        .vendor-profile-info {
            flex-grow: 1;
        }
        
        /* Vendor Profile Image Gallery Layout */
        .image-gallery {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: repeat(2, 1fr);
            gap: 8px;
            width: 100%;
            max-width: 900px;
            height: 400px;
            border-radius: var(--radius);
            overflow: hidden;
            margin-bottom: 2rem;
            background-color: #f1f5f9;
        }

        /* Left side: large image */
        .image-gallery > .gallery-item.large-image {
            grid-column: 1 / 2;
            grid-row: 1 / 3;
            width: 100%;
            height: 100%;
            min-width: 0;
            min-height: 0;
        }

        /* Right side: 2x2 grid for thumbnails */
        .image-gallery > .thumbnails-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr;
            gap: 8px;
            grid-column: 2 / 3;
            grid-row: 1 / 3;
            width: 100%;
            height: 100%;
        }

        .thumbnails-container > .gallery-item {
            width: 100%;
            height: 100%;
            min-width: 0;
            min-height: 0;
        }

        .gallery-item {
            position: relative;
            overflow: hidden;
            cursor: pointer;
            background-color: #d1d5db; /* Gray placeholder background */
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-light);
            border-radius: var(--radius);
        }

        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
            border-radius: var(--radius);
        }

        .gallery-item:hover img {
            transform: scale(1.05);
        }

        .see-all-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.1rem;
            font-weight: 600;
            transition: background-color 0.3s ease;
            border-radius: var(--radius);
        }

        .gallery-item:hover .see-all-overlay {
            background-color: rgba(0, 0, 0, 0.7);
        }
        
        
        
        /* Lightbox Modal Styles */
        .lightbox-modal {
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            display: none; /* Hidden by default */
            align-items: center;
            justify-content: center;
        }

        .lightbox-content {
            position: relative;
            max-width: 90vw;
            max-height: 90vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .lightbox-content img {
            max-width: 100%;
            max-height: 100%;
            border-radius: var(--radius);
        }

        .lightbox-close {
            position: absolute;
            top: -40px;
            right: 0;
            color: white;
            font-size: 3rem;
            font-weight: bold;
            cursor: pointer;
        }

        .lightbox-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            font-size: 2rem;
            padding: 0.5rem 1rem;
            cursor: pointer;
            border-radius: var(--radius);
            transition: background-color 0.2s;
        }

        .lightbox-nav:hover {
            background-color: rgba(0, 0, 0, 0.8);
        }

        .lightbox-prev {
            left: -60px;
        }

        .lightbox-next {
            right: -60px;
        }

        /* Services Section */
        .services-section {
            margin-top: 2rem;
        }

        .services-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border);
        }

        .service-category {
            margin-bottom: 2rem;
        }

        .category-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--primary);
        }

        .service-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1rem;
        }

        .service-card {
            background-color: white;
            border-radius: var(--radius);
            padding: 1rem;
            border: 1px solid var(--border);
            transition: all 0.2s;
        }

        .service-card:hover {
            border-color: var(--primary);
            box-shadow: var(--shadow);
        }

        .service-name {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .service-description {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-bottom: 0.5rem;
        }

        .service-price {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .service-actions {
            display: flex;
            justify-content: flex-end;
        }

        .btn-sm {
            padding: 0.25rem 0.75rem;
            font-size: 0.8rem;
        }

        /* New Booking Calendar Section */
        .booking-calendar-section {
            margin: 2rem 0;
        }

        .calendar-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border);
        }

        #booking-calendar {
            background-color: white;
            border-radius: var(--radius);
            border: 1px solid var(--border);
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .time-slots {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 0.75rem;
            margin-top: 1rem;
        }

        .time-slot {
            padding: 0.75rem;
            background-color: var(--secondary);
            border-radius: var(--radius);
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .time-slot:hover {
            background-color: #e6e9ff;
            color: var(--primary);
        }

        .time-slot.selected {
            background-color: var(--primary);
            color: white;
        }

        .time-slot.unavailable {
            background-color: #f1f5f9;
            color: var(--text-light);
            cursor: not-allowed;
            text-decoration: line-through;
        }

        /* New Reviews Section */
        .reviews-section {
            margin: 2rem 0;
        }

        .reviews-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border);
        }

        .review-card {
            background-color: white;
            border-radius: var(--radius);
            padding: 1.5rem;
            margin-bottom: 1rem;
            border: 1px solid var(--border);
        }

        .review-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .reviewer {
            font-weight: 600;
        }

        .review-date {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .review-rating {
            color: #fbbf24;
            margin-bottom: 0.5rem;
        }

        .review-text {
            line-height: 1.6;
        }

        .add-review-btn {
            margin-top: 1rem;
        }

        /* New Review Form */
        .review-form {
            background-color: white;
            border-radius: var(--radius);
            padding: 1.5rem;
            margin-top: 1rem;
            border: 1px solid var(--border);
        }

        .rating-input {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .rating-star {
            font-size: 1.5rem;
            color: #e2e8f0;
            cursor: pointer;
        }

        .rating-star.selected {
            color: #fbbf24;
        }

        .review-textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            margin-bottom: 1rem;
            min-height: 100px;
        }
        
        .chat-modal .modal-content {
            max-width: 600px;
        }
        
        .chat-modal .modal-body {
            padding: 0;
        }
        
        .chat-container {
            display: flex;
            flex-direction: column;
            height: 500px;
            background-color: white;
        }
        
        .chat-messages {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
        }

        .message {
            margin-bottom: 1rem;
            max-width: 80%;
        }

        .message.sent {
            margin-left: auto;
            text-align: right;
        }

        .message-sender {
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
            color: var(--text-light);
        }

        .message.received {
            margin-right: auto;
        }

        .message-content {
            padding: 0.75rem;
            border-radius: var(--radius);
            display: inline-block;
        }

        .sent .message-content {
            background-color: var(--primary);
            color: white;
        }

        .received .message-content {
            background-color: var(--secondary);
        }

        .message-time {
            font-size: 0.75rem;
            color: var(--text-light);
            margin-top: 0.25rem;
        }

        .chat-input {
            display: flex;
            padding: 1rem;
            border-top: 1px solid var(--border);
        }

        .chat-input input {
            flex: 1;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            margin-right: 0.5rem;
        }

        /* New Payment Section */
        .payment-section {
            margin: 2rem 0;
        }

        .payment-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border);
        }

        .payment-form {
            background-color: white;
            border-radius: var(--radius);
            padding: 1.5rem;
            border: 1px solid var(--border);
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .form-group input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: var(--radius);
        }

        .card-element {
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            margin-bottom: 1rem;
        }

        /* Booking confirmation */
        .booking-confirmation {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 1001;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .confirmation-content {
            background: white;
            padding: 2rem;
            border-radius: var(--radius);
            max-width: 500px;
            width: 90%;
            animation: fadeIn 0.3s;
        }

        /* Location permission modal */
        .location-permission {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 1002;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .location-content {
            background: white;
            padding: 2rem;
            border-radius: var(--radius);
            max-width: 500px;
            width: 90%;
            animation: fadeIn 0.3s;
            text-align: center;
        }

        .location-loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(94, 114, 228, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
            margin-left: 8px;
        }

        /* Profile Modal Styles */
        .profile-modal .modal-content {
            max-width: 400px;
        }

        .profile-modal .modal-body {
            padding: 20px;
        }

        .profile-modal input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            margin-bottom: 1rem;
        }

        .profile-avatar {
            width: 80px;
            height: 80px;
            background-color: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1.5rem;
            color: white;
            font-size: 2rem;
        }

        /* Dashboard Styles */
        .dashboard-container {
            display: grid;
            grid-template-columns: 250px 1fr;
            min-height: 100vh;
        }

        .dashboard-sidebar {
            background-color: white;
            border-right: 1px solid var(--border);
            padding: 1.5rem;
        }

        .dashboard-menu {
            list-style: none;
            margin-top: 2rem;
        }

        .dashboard-menu li {
            margin-bottom: 0.5rem;
        }

        .dashboard-menu a {
            display: block;
            padding: 0.75rem 1rem;
            border-radius: var(--radius);
            color: var(--text);
            text-decoration: none;
            transition: all 0.2s;
        }

        .dashboard-menu a:hover {
            background-color: var(--secondary);
        }

        .dashboard-menu a.active {
            background-color: var(--primary);
            color: white;
        }

        .dashboard-content {
            padding: 2rem;
            background-color: var(--secondary);
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .dashboard-title {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .dashboard-card {
            background-color: white;
            border-radius: var(--radius);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow);
        }

        .dashboard-card-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .booking-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
            border-bottom: 1px solid var(--border);
        }

        .booking-item:last-child {
            border-bottom: none;
        }

        .booking-info {
            flex: 1;
        }

        .booking-vendor {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .booking-date {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .booking-status {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .status-pending {
            background-color: #fef3c7;
            color: #92400e;
        }

        .status-confirmed {
            background-color: #d1fae5;
            color: #065f46;
        }

        .status-cancelled {
            background-color: #fee2e2;
            color: #991b1b;
        }

        /* Vendor Dashboard Styles */
        .vendor-dashboard-card {
            background-color: white;
            border-radius: var(--radius);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow);
        }

        .vendor-stats {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background-color: white;
            border-radius: var(--radius);
            padding: 1.5rem;
            text-align: center;
            box-shadow: var(--shadow);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        /* Vendor Registration Form */
        .vendor-registration-form {
            background-color: white;
            border-radius: var(--radius);
            padding: 2rem;
            max-width: 800px;
            margin: 0 auto;
        }

        .form-section {
            margin-bottom: 2rem;
        }

        .form-section-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border);
        }

        .form-row {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .form-col {
            flex: 1;
        }

        /* Price indicator styles */
        .price-indicator {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.9rem;
        }

        /* Analytics Chart Styles */
        .analytics-charts {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .chart-container {
            background-color: white;
            border-radius: var(--radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
        }

        .chart-container canvas {
            max-width: 100%;
            height: auto;
        }

        /* Vendor Setup Wizard Styles */
        .step-indicator {
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--text-light);
            padding: 0.5rem 1rem;
            border-radius: var(--radius);
            background-color: var(--secondary);
            transition: all 0.3s ease;
        }

        .step-indicator.active {
            color: var(--primary);
            background-color: rgba(94, 114, 228, 0.1);
            font-weight: 600;
        }

        .step-indicator.completed {
            color: white;
            background-color: var(--primary);
        }

        .setup-step {
            animation: fadeIn 0.3s ease;
        }

        .gallery-item {
            position: relative;
            border-radius: var(--radius);
            overflow: hidden;
            background-color: var(--secondary);
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .gallery-item .remove-btn {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background-color: var(--accent);
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .package-item, .service-item {
            background-color: var(--secondary);
            padding: 1rem;
            border-radius: var(--radius);
            margin-bottom: 0.5rem;
            border: 1px solid var(--border);
        }

        .package-item h6, .service-item h6 {
            margin: 0 0 0.5rem 0;
            font-weight: 600;
        }

        .package-item p, .service-item p {
            margin: 0;
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .package-item .price, .service-item .price {
            font-weight: 600;
            color: var(--primary);
            margin-top: 0.5rem;
        }

        .availability-day {
            padding: 1rem;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            background-color: var(--secondary);
        }

        .availability-day input[type="checkbox"]:checked + strong {
            color: var(--primary);
        }

        .availability-day input[type="time"] {
            padding: 0.5rem;
            border: 1px solid var(--border);
            border-radius: 4px;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .modal-content {
                width: 95%;
                height: 90vh;
            }

            .modal-body {
                max-height: calc(90vh - 60px);
            }

            .vendor-detail-header {
                flex-direction: column;
            }

            .vendor-detail-image {
                width: 100%;
                height: 200px;
            }

            .view-controls {
                flex-direction: column;
                align-items: flex-start;
            }

            .categories-nav {
                padding: 0.5rem 1rem;
            }

            .category-item {
                padding: 0.5rem 0.75rem;
                font-size: 0.8rem;
            }

            .dashboard-container {
                grid-template-columns: 1fr;
            }

            .dashboard-sidebar {
                display: none;
            }
            
            .profile-content {
                padding: 1rem;
            }
            
            .vendor-profile-header {
                flex-direction: column;
                gap: 1rem;
            }
        }
    </style>
<style id="googleidentityservice_button_styles">.qJTHM{-moz-user-select:none;color:#202124;direction:ltr;font-family:"Roboto-Regular",arial,sans-serif;font-weight:400;margin:0;overflow:hidden}.ynRLnc{left:-9999px;position:absolute;top:-9999px}.L6cTce{display:none}.bltWBb{word-break:break-all}.hSRGPd{color:#1a73e8;cursor:pointer;font-weight:500;text-decoration:none}.Bz112c-W3lGp{height:16px;width:16px}.Bz112c-E3DyYd{height:20px;width:20px}.Bz112c-r9oPif{height:24px;width:24px}.Bz112c-u2z5K{height:36px;width:36px}.Bz112c-uaxL4e{-moz-border-radius:10px;border-radius:10px}.LgbsSe-Bz112c{display:block}.S9gUrf-YoZ4jf,.S9gUrf-YoZ4jf *{border:none;margin:0;padding:0}.fFW7wc-ibnC6b>.aZ2wEe>div{border-color:#4285f4}.P1ekSe-ZMv3u>div:nth-child(1){background-color:#1a73e8!important}.P1ekSe-ZMv3u>div:nth-child(2),.P1ekSe-ZMv3u>div:nth-child(3){background-image:linear-gradient(to right,rgba(255,255,255,.7),rgba(255,255,255,.7)),linear-gradient(to right,#1a73e8,#1a73e8)!important}.haAclf{display:inline-block}.nsm7Bb-HzV7m-LgbsSe{border-radius:4px;box-sizing:border-box;transition:background-color .218s,border-color .218s;-moz-user-select:none;background-color:#fff;background-image:none;border:1px solid #dadce0;color:#3c4043;cursor:pointer;font-family:"Google Sans",arial,sans-serif;font-size:14px;height:40px;letter-spacing:0.25px;outline:none;overflow:hidden;padding:0 12px;position:relative;text-align:center;vertical-align:middle;white-space:nowrap;width:auto}@media screen and (-ms-high-contrast:active){.nsm7Bb-HzV7m-LgbsSe{border:2px solid windowText;color:windowText}}@media screen and (preferes-contrast:more){.nsm7Bb-HzV7m-LgbsSe{color:#000}}.nsm7Bb-HzV7m-LgbsSe.pSzOP-SxQuSe{font-size:14px;height:32px;letter-spacing:0.25px;padding:0 10px}.nsm7Bb-HzV7m-LgbsSe.purZT-SxQuSe{font-size:11px;height:20px;letter-spacing:0.3px;padding:0 8px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe{padding:0;width:40px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe.pSzOP-SxQuSe{width:32px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe.purZT-SxQuSe{width:20px}.nsm7Bb-HzV7m-LgbsSe.JGcpL-RbRzK{border-radius:20px}.nsm7Bb-HzV7m-LgbsSe.JGcpL-RbRzK.pSzOP-SxQuSe{border-radius:16px}.nsm7Bb-HzV7m-LgbsSe.JGcpL-RbRzK.purZT-SxQuSe{border-radius:10px}.nsm7Bb-HzV7m-LgbsSe.MFS4be-Ia7Qfc{border:none;color:#fff}.nsm7Bb-HzV7m-LgbsSe.MFS4be-v3pZbf-Ia7Qfc{background-color:#1a73e8}.nsm7Bb-HzV7m-LgbsSe.MFS4be-JaPV2b-Ia7Qfc{background-color:#202124;color:#e8eaed}@media screen and (prefers-contrast:more){.nsm7Bb-HzV7m-LgbsSe.MFS4be-JaPV2b-Ia7Qfc{color:#fff}}.nsm7Bb-HzV7m-LgbsSe .nsm7Bb-HzV7m-LgbsSe-Bz112c{height:18px;margin-right:8px;min-width:18px;width:18px}.nsm7Bb-HzV7m-LgbsSe.pSzOP-SxQuSe .nsm7Bb-HzV7m-LgbsSe-Bz112c{height:14px;min-width:14px;width:14px}.nsm7Bb-HzV7m-LgbsSe.purZT-SxQuSe .nsm7Bb-HzV7m-LgbsSe-Bz112c{height:10px;min-width:10px;width:10px}.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-Bz112c{margin-left:8px;margin-right:-4px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe .nsm7Bb-HzV7m-LgbsSe-Bz112c{margin:0;padding:10px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe.pSzOP-SxQuSe .nsm7Bb-HzV7m-LgbsSe-Bz112c{padding:8px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe.purZT-SxQuSe .nsm7Bb-HzV7m-LgbsSe-Bz112c{padding:4px}.nsm7Bb-HzV7m-LgbsSe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{border-top-left-radius:3px;border-bottom-left-radius:3px;display:-webkit-box;display:-moz-box;display:-ms-flexbox;display:-webkit-flex;display:flex;justify-content:center;align-items:center;background-color:#fff;height:36px;margin-left:-10px;margin-right:12px;min-width:36px;width:36px}.nsm7Bb-HzV7m-LgbsSe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf .nsm7Bb-HzV7m-LgbsSe-Bz112c,.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf .nsm7Bb-HzV7m-LgbsSe-Bz112c{margin:0;padding:0}.nsm7Bb-HzV7m-LgbsSe.pSzOP-SxQuSe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{height:28px;margin-left:-8px;margin-right:10px;min-width:28px;width:28px}.nsm7Bb-HzV7m-LgbsSe.purZT-SxQuSe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{height:16px;margin-left:-6px;margin-right:8px;min-width:16px;width:16px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{border-radius:3px;margin-left:2px;margin-right:0;padding:0}.nsm7Bb-HzV7m-LgbsSe.JGcpL-RbRzK .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{border-radius:18px}.nsm7Bb-HzV7m-LgbsSe.pSzOP-SxQuSe.JGcpL-RbRzK .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{border-radius:14px}.nsm7Bb-HzV7m-LgbsSe.purZT-SxQuSe.JGcpL-RbRzK .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{border-radius:8px}.nsm7Bb-HzV7m-LgbsSe .nsm7Bb-HzV7m-LgbsSe-bN97Pc-sM5MNb{display:-webkit-box;display:-moz-box;display:-ms-flexbox;display:-webkit-flex;display:flex;align-items:center;flex-direction:row;justify-content:space-between;flex-wrap:nowrap;height:100%;position:relative;width:100%}.nsm7Bb-HzV7m-LgbsSe .oXtfBe-l4eHX{justify-content:center}.nsm7Bb-HzV7m-LgbsSe .nsm7Bb-HzV7m-LgbsSe-BPrWId{flex-grow:1;font-family:"Google Sans",arial,sans-serif;font-weight:500;overflow:hidden;text-overflow:ellipsis;vertical-align:top}.nsm7Bb-HzV7m-LgbsSe.purZT-SxQuSe .nsm7Bb-HzV7m-LgbsSe-BPrWId{font-weight:300}.nsm7Bb-HzV7m-LgbsSe .oXtfBe-l4eHX .nsm7Bb-HzV7m-LgbsSe-BPrWId{flex-grow:0}.nsm7Bb-HzV7m-LgbsSe .nsm7Bb-HzV7m-LgbsSe-MJoBVe{transition:background-color .218s;bottom:0;left:0;position:absolute;right:0;top:0}.nsm7Bb-HzV7m-LgbsSe:hover,.nsm7Bb-HzV7m-LgbsSe:focus{box-shadow:none;border-color:rgb(210,227,252);outline:none}.nsm7Bb-HzV7m-LgbsSe:focus-within{outline:2px solid #00639b;border-color:transparent}.nsm7Bb-HzV7m-LgbsSe:hover .nsm7Bb-HzV7m-LgbsSe-MJoBVe{background:rgba(66,133,244,.08)}.nsm7Bb-HzV7m-LgbsSe:active .nsm7Bb-HzV7m-LgbsSe-MJoBVe,.nsm7Bb-HzV7m-LgbsSe:focus .nsm7Bb-HzV7m-LgbsSe-MJoBVe{background:rgba(66,133,244,.1)}.nsm7Bb-HzV7m-LgbsSe.MFS4be-Ia7Qfc:hover .nsm7Bb-HzV7m-LgbsSe-MJoBVe{background:rgba(255,255,255,.24)}.nsm7Bb-HzV7m-LgbsSe.MFS4be-Ia7Qfc:active .nsm7Bb-HzV7m-LgbsSe-MJoBVe,.nsm7Bb-HzV7m-LgbsSe.MFS4be-Ia7Qfc:focus .nsm7Bb-HzV7m-LgbsSe-MJoBVe{background:rgba(255,255,255,.32)}.nsm7Bb-HzV7m-LgbsSe .n1UuX-DkfjY{border-radius:50%;display:-webkit-box;display:-moz-box;display:-ms-flexbox;display:-webkit-flex;display:flex;height:20px;margin-left:-4px;margin-right:8px;min-width:20px;width:20px}.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-BPrWId{font-family:"Roboto";font-size:12px;text-align:left}.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-BPrWId .ssJRIf,.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-BPrWId .K4efff .fmcmS{overflow:hidden;text-overflow:ellipsis}.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-BPrWId .K4efff{display:-webkit-box;display:-moz-box;display:-ms-flexbox;display:-webkit-flex;display:flex;align-items:center;color:#5f6368;fill:#5f6368;font-size:11px;font-weight:400}.nsm7Bb-HzV7m-LgbsSe.jVeSEe.MFS4be-Ia7Qfc .nsm7Bb-HzV7m-LgbsSe-BPrWId .K4efff{color:#e8eaed;fill:#e8eaed}@media screen and (prefers-contrast:more){.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-BPrWId .K4efff,.nsm7Bb-HzV7m-LgbsSe.jVeSEe.MFS4be-Ia7Qfc .nsm7Bb-HzV7m-LgbsSe-BPrWId .K4efff{color:#000;fill:#000}}.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-BPrWId .K4efff .Bz112c{height:18px;margin:-3px -3px -3px 2px;min-width:18px;width:18px}.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{border-top-left-radius:0;border-bottom-left-radius:0;border-top-right-radius:3px;border-bottom-right-radius:3px;margin-left:12px;margin-right:-10px}.nsm7Bb-HzV7m-LgbsSe.jVeSEe.JGcpL-RbRzK .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{border-radius:18px}.L5Fo6c-sM5MNb{border:0;display:block;left:0;position:relative;top:0}.L5Fo6c-bF1uUb{-moz-border-radius:4px;border-radius:4px;bottom:0;cursor:pointer;left:0;position:absolute;right:0;top:0}.L5Fo6c-bF1uUb:focus{border:none;outline:none}sentinel{}</style><script type="text/javascript" charset="UTF-8" src="https://maps.googleapis.com/maps-api-v3/api/js/61/14/common.js"></script><script type="text/javascript" charset="UTF-8" src="https://maps.googleapis.com/maps-api-v3/api/js/61/14/util.js"></script></head>
<body data-new-gr-c-s-check-loaded="8.932.0" data-gr-ext-installed="" style="overflow: auto;">
    <!-- Main App View -->
    <header class="header">
        <div class="logo" style="cursor: pointer;">
            <span></span>
            VenueVue
        </div>

        <div class="search-container">
        <div class="search-bar" style="position: relative; display: flex; align-items: center;">
            <input type="text" placeholder="Search for event vendors..." id="search-input" style="flex-grow: 1; padding-left: 1rem; padding-right: 2.5rem;">
            <button id="search-button" style="position: absolute; right: 0.5rem; background: none; border: none; cursor: pointer; color: var(--primary); font-size: 1.25rem;">
                <i class="fas fa-magnifying-glass"></i>
            </button>
        </div>
        </div>

        <div class="user-nav">
            <div class="nav-icon" id="wishlist-btn">
                
                <span class="badge" id="favorites-badge">0</span>
            </div>
            <div class="nav-icon" id="notifications-btn">
                
                <span class="badge" id="notifications-badge">0</span>
            </div>
            <div class="nav-icon" id="profile-btn" style="background-color: var(--primary); color: white; border-radius: 50%; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center;">S</div>
        </div>
    </header>

    <div class="app-container" id="app-container" style="display: grid;">
        <!-- Categories Navigation -->
        <nav class="categories-nav">
            <button class="nav-scroll-btn left" id="scroll-left"></button>
            <div class="categories-list-wrapper">
                <div class="categories-list" id="categories-list"><div class="category-item active" data-category="all"><i class="fas fa-th-large"></i><span>All Categories</span></div><div class="category-item" data-category="venue"><i class="fas fa-building"></i><span>Venues</span></div><div class="category-item" data-category="photo"><i class="fas fa-camera"></i><span>Photo/Video</span></div><div class="category-item" data-category="music"><i class="fas fa-music"></i><span>Music/DJ</span></div><div class="category-item" data-category="catering"><i class="fas fa-utensils"></i><span>Catering</span></div><div class="category-item" data-category="entertainment"><i class="fas fa-theater-masks"></i><span>Entertainment</span></div><div class="category-item" data-category="experiences"><i class="fas fa-star"></i><span>Experiences</span></div><div class="category-item" data-category="decor"><i class="fas fa-ribbon"></i><span>Decorations</span></div><div class="category-item" data-category="beauty"><i class="fas fa-spa"></i><span>Beauty</span></div><div class="category-item" data-category="cake"><i class="fas fa-birthday-cake"></i><span>Cake</span></div><div class="category-item" data-category="transport"><i class="fas fa-shuttle-van"></i><span>Transportation</span></div><div class="category-item" data-category="planner"><i class="fas fa-clipboard-list"></i><span>Planners</span></div><div class="category-item" data-category="fashion"><i class="fas fa-tshirt"></i><span>Fashion</span></div><div class="category-item" data-category="stationery"><i class="fas fa-envelope"></i><span>Stationery</span></div></div>
            </div>
            <button class="nav-scroll-btn right" id="scroll-right"></button>
        </nav>

        <aside class="sidebar">
            <div class="filter-section">
                <h3 class="filter-title">
                    Location
                    <span class="filter-reset" id="location-reset">Reset</span>
                </h3>
                <input type="text" placeholder="City or ZIP code" class="search-input" id="location-input" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border); border-radius: var(--radius); margin-bottom: 1rem;">
                <div class="filter-group">
                    <div class="filter-option">
                        <input type="checkbox" id="current-location">
                        <label for="current-location">Use my location</label>
                    </div>
                    <div class="filter-option">
                        <input type="checkbox" id="within50">
                        <label for="within50">Within 50 miles</label>
                    </div>
                </div>
            </div>

            <div class="filter-section">
                <h3 class="filter-title">
                    Price Range
                    <span class="filter-reset" id="price-reset">Reset</span>
                </h3>
                <input type="range" class="range-slider" min="0" max="100" value="40" id="price-slider">
                <div class="price-labels">
                    <span>$</span>
                    <span>$$</span>
                    <span>$$$</span>
                </div>
            </div>

            <div class="filter-section">
                <h3 class="filter-title">
                    Vendor Type
                    <span class="filter-reset" id="type-reset">Reset</span>
                </h3>
                <div class="filter-group">
                    <div class="filter-option">
                        <input type="checkbox" id="independent" checked="">
                        <label for="independent">Independent</label>
                    </div>
                    <div class="filter-option">
                        <input type="checkbox" id="company" checked="">
                        <label for="company">Company</label>
                    </div>
                </div>
            </div>

            <!-- New Advanced Filters Section -->
            <div class="advanced-filters">
                <div class="advanced-toggle" id="advanced-toggle">
                    <h3 class="filter-title">Advanced Filters</h3>
                    <span>+</span>
                </div>
                <div class="advanced-content" id="advanced-content">
                    <div class="filter-section">
                        <h3 class="filter-title">Availability</h3>
                        <div class="date-picker">
                            <input type="date" id="start-date" placeholder="Start date">
                            <input type="date" id="end-date" placeholder="End date">
                        </div>
                    </div>

                    <div class="filter-section">
                        <h3 class="filter-title">Region</h3>
                        <select class="region-select" id="region-select">
                            <option value="">All Regions</option>
                            <option value="north">Northern Region</option>
                            <option value="south">Southern Region</option>
                            <option value="east">Eastern Region</option>
                            <option value="west">Western Region</option>
                            <option value="central">Central Region</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="trending-section">
                <h3 class="filter-title">Popular Filters</h3>
                <div class="trending-tags">
                    <div class="trending-tag" data-filter="premium">Premium</div>
                    <div class="trending-tag" data-filter="eco-friendly">Eco-Friendly</div>
                    <div class="trending-tag" data-filter="award-winning">Award Winning</div>
                    <div class="trending-tag" data-filter="last-minute">Last Minute</div>
                </div>
            </div>
        </aside>

        <main class="main-content">
            <div class="content-header">
                <div>
                    <h1 class="results-title">Vendors in Los Angeles</h1>
                    <p class="results-count">2 vendors available</p>
                </div>

                <div class="view-controls">
                    <select class="sort-select" id="sort-select">
                        <option value="recommended">Sort: Recommended</option>
                        <option value="price-low">Price: Low to High</option>
                        <option value="price-high">Price: High to Low</option>
                        <option value="popular">Most Popular</option>
                        <option value="nearest">Nearest to Me</option>
                        <option value="rating">Highest Rated</option>
                    </select>
                    <div class="view-toggle">
                        <button class="view-btn active" id="list-view-btn"> List</button>
                        <button class="view-btn" id="map-view-btn"> Map</button>
                    </div>
                </div>
            </div>

            <div class="map-view-container" id="map-view-container">
                <div class="map-container">
                    <div id="map"></div>
                    <div class="map-controls">
                        <button class="map-btn" id="zoom-in">+</button>
                        <button class="map-btn" id="zoom-out">-</button>
                        <button class="map-btn" id="locate-me"></button>
                    </div>
                </div>
                <div class="map-venue-list" id="map-venue-list"></div>
            </div>

            <div class="vendor-grid" id="vendor-grid"><div class="vendor-card">
                    <div class="vendor-image">
                        <img src="https://placehold.co/800x600/5e72e4/ffffff?text=Primary" alt="Epic Events Photography" style="width:100%;height:100%;object-fit:cover;">
                        <div class="vendor-favorite " data-id="1"></div>
                        <div class="vendor-badges" style="position: absolute; bottom: 8px; left: 8px; display: flex; gap: 6px;">
                            
                            
                            
                        </div>
                    </div>
                    <div class="vendor-details">
                        <h3 class="vendor-name">Epic Events Photography</h3>
                        <div class="vendor-location">
                             Los Angeles, CA
                        </div>
                        <div class="vendor-features">
                            <div class="feature">
                                <span class="feature-icon"></span>
                                <span>Photo/Video</span>
                            </div>
                            <div class="feature">
                                <span class="feature-icon"></span>
                                <span>5.000000 (1)</span>
                            </div>
                            <div class="feature">
                                <div class="price-indicator">
                                    <span class="price-dot filled"></span><span class="price-dot filled"></span><span class="price-dot "></span>
                                </div>
                            </div>
                        </div>
                        <div class="vendor-footer">
                            <button class="btn btn-outline save-btn" data-id="1">Save</button>
                            <button class="btn btn-primary view-btn" data-id="1">View</button>
                        </div>
                    </div>
                </div><div class="vendor-card">
                    <div class="vendor-image">
                        
                        <div class="vendor-favorite " data-id="2"></div>
                        <div class="vendor-badges" style="position: absolute; bottom: 8px; left: 8px; display: flex; gap: 6px;">
                            
                            
                            
                        </div>
                    </div>
                    <div class="vendor-details">
                        <h3 class="vendor-name">Sami Test</h3>
                        <div class="vendor-location">
                             , 
                        </div>
                        <div class="vendor-features">
                            <div class="feature">
                                <span class="feature-icon"></span>
                                <span>Vendor</span>
                            </div>
                            <div class="feature">
                                <span class="feature-icon"></span>
                                <span>4.5 (0)</span>
                            </div>
                            <div class="feature">
                                <div class="price-indicator">
                                    <span class="price-dot filled"></span><span class="price-dot filled"></span><span class="price-dot "></span>
                                </div>
                            </div>
                        </div>
                        <div class="vendor-footer">
                            <button class="btn btn-outline save-btn" data-id="2">Save</button>
                            <button class="btn btn-primary view-btn" data-id="2">View</button>
                        </div>
                    </div>
                </div></div>

            <div class="pagination" id="pagination" style="display: none;">
                <div class="page-btn" id="prev-page"></div>
                <div class="page-btn active">1</div>
                <div class="page-btn">2</div>
                <div class="page-btn">3</div>
                <div class="page-btn" id="next-page"></div>
            </div>
        </main>
    </div>

    <!-- Vendor Public Profile Page -->
    <div id="vendor-profile-page" class="profile-content" style="display: none;">
                    <!-- Back Button -->
                    <div style="margin-bottom: 2rem;">
                        <button onclick="window.location.hash = ''" class="btn btn-outline" style="display: flex; align-items: center; gap: 0.5rem;">
                            <span> Back to search results</span>
                        </button>
                    </div>
                    
                    <!-- Image Gallery -->
                    <div id="modal-image-gallery" class="image-gallery"><div class="gallery-item large-image"><img src="https://placehold.co/800x600/5e72e4/ffffff?text=Primary" alt="Main Venue Image"></div><div class="thumbnails-container"><div class="gallery-item"><img src="https://placehold.co/800x600/f7fafc/2d3748?text=Gallery+Image+1" alt="Thumbnail 1"></div><div class="gallery-item"><img src="https://placehold.co/400x400/e2e8f0/718096?text=No+Image" alt="Thumbnail 2"></div><div class="gallery-item"><img src="https://placehold.co/400x400/e2e8f0/718096?text=No+Image" alt="Thumbnail 3"></div><div class="gallery-item" style="cursor: pointer;"><img src="https://placehold.co/400x400/e2e8f0/718096?text=No+Image" alt="Thumbnail 4"><div class="see-all-overlay">+0 See All</div></div></div></div>

                    <!-- Vendor Header -->
                    <div class="vendor-profile-header">
                        <div class="vendor-profile-info">
                            <h1 style="font-size: 2.5rem; font-weight: 700; margin-bottom: 0.5rem;">Epic Events Photography</h1>
                            <p style="font-size: 1.1rem; color: var(--primary); margin-bottom: 1rem;">Capturing your most epic moments.</p>
                            <div style="display: flex; align-items: center; gap: 1rem; color: var(--text-light); margin-bottom: 1rem;">
                                <span> Los Angeles, CA</span>
                                <span class="review-rating" style="color: #fbbf24;"></span>
                                <span>(5.0) | 1 Reviews</span>
                            </div>
                        </div>
                         <!-- Favorite Button -->
                        <div class="vendor-favorite " data-id="1" style="flex-shrink: 0; align-self: flex-start; margin-top: 1rem;"></div>
                    </div>

                    <!-- Vendor Content Sections -->
                    <div style="display: grid; grid-template-columns: 1fr 320px; gap: 2rem; margin-top: 2rem;">
                        <!-- Main Content Area -->
                        <div>
                            <h2 class="services-title">About Us</h2>
                            <p style="line-height: 1.6;">We are a team of passionate photographers and videographers dedicated to telling the unique story of your event. From weddings to corporate gatherings, we ensure every detail is captured with artistry and precision.</p>
                            
                            <!-- Social Media Section -->
                            <div class="services-section">
                                <h2 class="services-title">Social Media</h2>
                                <div style="display: flex; gap: 1rem;">
                                    <a href="#" target="_blank" style="text-decoration: none; color: var(--text); opacity: 0.5; pointer-events: none;">
                                        <img src="https://upload.wikimedia.org/wikipedia/commons/a/a5/Instagram_icon.png" width="36" height="36" alt="Instagram">
                                    </a>
                                    <a href="#" target="_blank" style="text-decoration: none; color: var(--text); opacity: 0.5; pointer-events: none;">
                                        <img src="https://upload.wikimedia.org/wikipedia/commons/5/51/Facebook_f_logo_%282019%29.svg" width="36" height="36" alt="Facebook">
                                    </a>
                                    <a href="https://www.epiceventsphoto.com" target="_blank" style="text-decoration: none; color: var(--text); opacity: 1; pointer-events: auto;">
                                        <img src="https://upload.wikimedia.org/wikipedia/commons/c/c4/Globe_icon.svg" width="36" height="36" alt="Website">
                                    </a>
                                </div>
                            </div>
                            
                            <!-- Services -->
                            <div id="profile-services-section" class="services-section">
                                <h2 class="services-title">Our Services</h2>
                                
                    <div class="service-category">
                        <h4 class="category-title">Photography Packages</h4>
                        <div class="service-grid">
                            
                        </div>
                    </div>
                
                    <div class="service-category">
                        <h4 class="category-title">Photography Packages</h4>
                        <div class="service-grid">
                            
                        </div>
                    </div>
                
                            </div>

                            <!-- Reviews Section -->
                            <div class="reviews-section">
                                <h2 class="reviews-title">Reviews (1)</h2>
                                <div id="vendor-profile-reviews-list">
                                    
                    <div class="review-card">
                        <div class="review-header">
                            <div class="reviewer">Jane Doe</div>
                            <div class="review-date">August 8, 2025</div>
                        </div>
                        <div class="review-rating"></div>
                        <div class="review-title">Absolutely fantastic!</div>
                        <div class="review-text">John and his team were amazing. They captured every special moment beautifully. Highly recommend!</div>
                    </div>
                
                                </div>
                                
                                    <button class="btn btn-outline add-review-btn" id="show-review-form" style="margin-top: 1rem;">Add Review</button>
                                    <div class="review-form" id="review-form" style="display: none;">
                                        <div class="rating-input">
                                            <span class="rating-star" data-rating="1"></span>
                                            <span class="rating-star" data-rating="2"></span>
                                            <span class="rating-star" data-rating="3"></span>
                                            <span class="rating-star" data-rating="4"></span>
                                            <span class="rating-star" data-rating="5"></span>
                                        </div>
                                        <textarea class="review-textarea" id="review-text" placeholder="Share your experience..."></textarea>
                                        <button class="btn btn-primary" id="submit-review">Submit Review</button>
                                    </div>
                                
                            </div>
                        </div>

                        <!-- Sidebar -->
                        <div style="display: flex; flex-direction: column; gap: 1rem; position: sticky; top: 2rem;">
                            <!-- Booking Summary -->
                            <div id="booking-summary" style="background-color: var(--secondary); padding: 1.5rem; border-radius: var(--radius);">
                                <h3 style="font-size: 1.2rem; font-weight: 600; margin-bottom: 1rem;">Your Booking</h3>
                                <div id="selected-services-list">
                                    <p style="font-size: 0.9rem; color: var(--text-light);">Select services from the list to get started.</p>
                                </div>
                                <div style="border-top: 1px solid var(--border); margin: 1rem 0; padding-top: 1rem; display: flex; justify-content: space-between; font-weight: 600;">
                                    <span>Total</span>
                                    <span id="booking-total-price">$0.00</span>
                                </div>
                                <button class="btn btn-primary" id="proceed-to-book-btn" style="width: 100%;" disabled="">Choose Services</button>
                            </div>

                            <!-- Contact -->
                            <div style="background-color: var(--secondary); padding: 1.5rem; border-radius: var(--radius);">
                                <h3 style="font-size: 1.2rem; font-weight: 600; margin-bottom: 1rem;">Contact Vendor</h3>
                                <p style="margin-bottom: 1rem; font-size: 0.9rem; color: var(--text-light);">Have questions? Get in touch!</p>
                                <button class="btn btn-outline" id="open-chat-btn" style="width: 100%;">Message Vendor</button>
                            </div>
                        </div>
                    </div>
                </div>

    <!-- Dashboard Modal -->
    <div id="dashboard-modal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 95%; width: 1200px; height: 90vh; display: flex; flex-direction: column;">
            <div class="modal-header">
                <h3 id="dashboard-modal-title">Dashboard</h3>
                <span class="close-modal"></span>
            </div>
            <div class="modal-body" style="padding: 0; overflow: hidden; flex-grow: 1;">
                <!-- Client Dashboard -->
                <div class="dashboard-container" id="dashboard-container" style="display: none; height: 100%;">
                    <aside class="dashboard-sidebar">
                        <div class="logo" style="padding: 1rem 0; border-bottom: 1px solid var(--border);">
                            <span></span>
                            VenueVue
                        </div>
                        <ul class="dashboard-menu">
                            <li><a href="#" class="active" data-section="dashboard">Dashboard</a></li>
                            <li><a href="#" data-section="bookings">My Bookings</a></li>
                            <li><a href="#" data-section="favorites">Favorites</a></li>
                            <li><a href="#" data-section="messages">Messages</a></li>
                            <li><a href="#" data-section="reviews">My Reviews</a></li>
                            <li><a href="#" data-section="settings">Settings</a></li>
                            <li><a href="#" id="switch-to-vendor">Switch to Vendor Mode</a></li>
                            <li><a href="#" id="logout-dashboard">Log Out</a></li>
                        </ul>
                    </aside>
                    <main class="dashboard-content" style="overflow-y: auto;">
                        <div class="dashboard-header">
                            <h1 class="dashboard-title" id="dashboard-title">Dashboard</h1>
                            <div class="user-nav">
                                <div class="nav-icon" id="dashboard-notifications-btn">
                                    
                                    <span class="badge" id="dashboard-notifications-badge">0</span>
                                </div>
                            </div>
                        </div>
                        <div id="dashboard-section">
                            <div class="dashboard-card">
                                <h2 class="dashboard-card-title">Upcoming Bookings</h2>
                                <div id="upcoming-bookings"><p>Loading upcoming bookings...</p></div>
                            </div>
                            <div class="dashboard-card">
                                <h2 class="dashboard-card-title">Recent Favorites</h2>
                                <div class="vendor-grid" id="dashboard-favorites"><p>Loading recent favorites...</p></div>
                            </div>
                        </div>
                        <div id="bookings-section" style="display: none;">
                            <div class="dashboard-card">
                                <h2 class="dashboard-card-title">All Bookings</h2>
                                <div id="all-bookings"><p>Loading all bookings...</p></div>
                            </div>
                        </div>
                        <div id="favorites-section" style="display: none;">
                            <div class="dashboard-card">
                                <h2 class="dashboard-card-title">Saved Favorites</h2>
                                <div class="vendor-grid" id="saved-favorites"><p>Loading saved favorites...</p></div>
                            </div>
                        </div>
                        <div id="messages-section" style="display: none;">
                            <div class="dashboard-card">
                                <h2 class="dashboard-card-title">Messages</h2>
                                <div class="chat-container">
                                    <div class="chat-messages" id="dashboard-chat-messages"><p>Loading messages...</p></div>
                                    <div class="chat-input">
                                        <input type="text" placeholder="Type your message..." id="dashboard-chat-input">
                                        <button class="btn btn-primary" id="dashboard-send-btn">Send</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="reviews-section" style="display: none;">
                            <div class="dashboard-card">
                                <h2 class="dashboard-card-title">My Reviews</h2>
                                <div id="user-reviews"><p>Loading your reviews...</p></div>
                            </div>
                        </div>
                        <div id="settings-section" style="display: none;">
                            <div class="dashboard-card">
                                <h2 class="dashboard-card-title">Account Settings</h2>
                                <form id="profile-form">
                                    <div class="form-group"><label for="profile-name">Full Name</label><input type="text" id="profile-name"></div>
                                    <div class="form-group"><label for="profile-email">Email</label><input type="email" id="profile-email" disabled=""></div>
                                    <div class="form-group"><label for="profile-phone">Phone Number</label><input type="tel" id="profile-phone"></div>
                                    <button type="submit" class="btn btn-primary">Save Changes</button>
                                </form>
                            </div>
                            <div class="dashboard-card">
                                <h2 class="dashboard-card-title">Change Password</h2>
                                <form id="password-form">
                                    <div class="form-group"><label for="current-password">Current Password</label><input type="password" id="current-password"></div>
                                    <div class="form-group"><label for="new-password">New Password</label><input type="password" id="new-password"></div>
                                    <div class="form-group"><label for="confirm-password">Confirm New Password</label><input type="password" id="confirm-password"></div>
                                    <button type="submit" class="btn btn-primary">Update Password</button>
                                </form>
                            </div>
                        </div>
                    </main>
                </div>
                <!-- Vendor Dashboard -->
                <div class="dashboard-container" id="vendor-dashboard-container" style="display: none; height: 100%;">
                    <aside class="dashboard-sidebar">
                        <div class="logo" style="padding: 1rem 0; border-bottom: 1px solid var(--border);">
                            <span></span>
                            VenueVue
                        </div>
                        <ul class="dashboard-menu">
                            <li><a href="#" class="active" data-section="vendor-dashboard">Dashboard</a></li>
                            <li><a href="#" data-section="vendor-bookings">Bookings</a></li>
                            <li><a href="#" data-section="vendor-services">Services</a></li>
                            <li><a href="#" data-section="vendor-messages">Messages</a></li>
                            <li><a href="#" data-section="vendor-reviews">Reviews</a></li>
                            <li><a href="#" data-section="vendor-analytics">Analytics</a></li>
                            <li><a href="#" data-section="vendor-settings">Settings</a></li>
                            <li><a href="#" id="switch-to-client">Switch to Client Mode</a></li>
                            <li><a href="#" id="vendor-logout">Log Out</a></li>
                        </ul>
                    </aside>
                    <main class="dashboard-content" style="overflow-y: auto;">
                        <div class="dashboard-header">
                            <h1 class="dashboard-title" id="vendor-dashboard-title">Vendor Dashboard</h1>
                            <div class="user-nav">
                                <div class="nav-icon" id="vendor-notifications-btn">
                                    
                                    <span class="badge" id="vendor-notifications-badge">0</span>
                                </div>
                            </div>
                        </div>
                        <div id="vendor-dashboard-section">
                            <div class="vendor-stats" id="vendor-stats"><p>Loading vendor stats...</p></div>
                            <div class="dashboard-card">
                                <h2 class="dashboard-card-title">Recent Bookings</h2>
                                <div id="vendor-recent-bookings"><p>Loading recent bookings...</p></div>
                            </div>
                            <div class="dashboard-card">
                                <h2 class="dashboard-card-title">Recent Messages</h2>
                                <div class="chat-container" style="height: 400px;">
                                    <div class="chat-messages" id="vendor-chat-messages"><p>Loading recent messages...</p></div>
                                    <div class="chat-input">
                                        <input type="text" placeholder="Type your message..." id="vendor-chat-input">
                                        <button class="btn btn-primary" id="vendor-send-btn">Send</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="vendor-bookings-section" style="display: none;">
                            <div class="dashboard-card">
                                <h2 class="dashboard-card-title">All Bookings</h2>
                                <div id="vendor-all-bookings"><p>Loading all bookings...</p></div>
                            </div>
                        </div>
                        <div id="vendor-services-section" style="display: none;">
                            <div class="dashboard-card">
                                <h2 class="dashboard-card-title">Manage Services</h2>
                                <div class="services-section" id="vendor-services"><p>Loading services...</p></div>
                            </div>
                        </div>
                        <div id="vendor-messages-section" style="display: none;">
                            <div class="dashboard-card">
                                <h2 class="dashboard-card-title">Messages</h2>
                                <div class="chat-container" style="height: 500px;">
                                    <div class="chat-messages" id="vendor-all-chat-messages"><p>Loading all messages...</p></div>
                                    <div class="chat-input">
                                        <input type="text" placeholder="Type your message..." id="vendor-all-chat-input">
                                        <button class="btn btn-primary" id="vendor-all-send-btn">Send</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="vendor-reviews-section" style="display: none;">
                            <div class="dashboard-card">
                                <h2 class="dashboard-card-title">Customer Reviews</h2>
                                <div id="vendor-reviews"><p>Loading customer reviews...</p></div>
                            </div>
                        </div>
                        <div id="vendor-analytics-section" style="display: none;">
                            <div class="dashboard-card">
                                <h2 class="dashboard-card-title">Performance Analytics</h2>
                                <div id="analytics-charts" class="analytics-charts"><p>Loading analytics data...</p></div>
                            </div>
                        </div>
                        <div id="vendor-settings-section" style="display: none;">
                            <div class="dashboard-card">
                                <h2 class="dashboard-card-title">Business Profile</h2>
                                <form id="vendor-profile-form">
                                    <div class="form-group"><label for="vendor-name">Business Name</label><input type="text" id="vendor-name"></div>
                                    <div class="form-group"><label for="vendor-category">Category</label><select id="vendor-category"></select></div>
                                    <div class="form-group"><label for="vendor-description">Description</label><textarea id="vendor-description" rows="4" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border); border-radius: var(--radius);"></textarea></div>
                                    <div class="form-group"><label for="vendor-address">Address</label><input type="text" id="vendor-address"></div>
                                    <div class="form-group"><label for="vendor-city">City</label><input type="text" id="vendor-city"></div>
                                    <div class="form-group"><label for="vendor-state">State</label><input type="text" id="vendor-state"></div>
                                    <div class="form-group"><label for="vendor-country">Country</label><input type="text" id="vendor-country"></div>
                                    <div class="form-group"><label for="vendor-postalCode">Postal Code</label><input type="text" id="vendor-postalCode"></div>
                                    <div class="form-group"><label for="vendor-phone">Phone Number</label><input type="tel" id="vendor-phone"></div>
                                    <div class="form-group"><label for="vendor-email">Business Email</label><input type="email" id="vendor-email"></div>
                                    <div class="form-group"><label for="vendor-website">Website (optional)</label><input type="url" id="vendor-website"></div>
                                    <div class="form-group"><label for="vendor-years-in-business">Years in Business</label><input type="number" id="vendor-years-in-business" min="0"></div>
                                    <div class="form-group"><label for="vendor-is-premium">Premium Vendor</label><input type="checkbox" id="vendor-is-premium"></div>
                                    <div class="form-group"><label for="vendor-is-eco-friendly">Eco-Friendly</label><input type="checkbox" id="vendor-is-eco-friendly"></div>
                                    <div class="form-group"><label for="vendor-is-award-winning">Award Winning</label><input type="checkbox" id="vendor-is-award-winning"></div>
                                    <button type="submit" class="btn btn-primary">Save Changes</button>
                                </form>
                            </div>
                            <div class="dashboard-card">
                                <h2 class="dashboard-card-title">Business Photos</h2>
                                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;" id="vendor-photos"><p>No photos uploaded.</p></div>
                                <button class="btn btn-outline" id="upload-photos-btn">Upload Photos</button>
                            </div>
                            <div class="dashboard-card">
                                <h2 class="dashboard-card-title">Availability Settings</h2>
                                <div id="vendor-availability-calendar" style="margin-bottom: 1.5rem;"></div>
                                <button class="btn btn-outline" id="set-business-hours-btn">Set Business Hours</button>
                            </div>
                        </div>
                    </main>
                </div>
            </div>
        </div>
    </div>

    <!-- Vendor Registration Modal -->
    <div id="vendor-registration-modal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h3 id="registration-title">Complete Your Vendor Setup</h3>
                <span class="close-modal"></span>
            </div>
            <div class="modal-body">
                <!-- Progress Bar -->
                <div style="margin-bottom: 2rem;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem; flex-wrap: wrap; gap: 0.5rem;">
                        <span class="step-indicator active" id="step-indicator-1">1: Business</span>
                        <span class="step-indicator" id="step-indicator-2">2: Location</span>
                        <span class="step-indicator" id="step-indicator-3">3: Gallery</span>
                        <span class="step-indicator" id="step-indicator-4">4: Services</span>
                        <span class="step-indicator" id="step-indicator-5">5: Team</span>
                        <span class="step-indicator" id="step-indicator-6">6: Social</span>
                        <span class="step-indicator" id="step-indicator-7">7: Schedule</span>
                        <span class="step-indicator" id="step-indicator-8">8: Policies</span>
                        <span class="step-indicator" id="step-indicator-9">9: Legal</span>
                        <span class="step-indicator" id="step-indicator-10">10: Complete</span>
                    </div>
                    <div style="background-color: var(--border); height: 4px; border-radius: 2px; overflow: hidden;">
                        <div id="setup-progress-bar" style="background-color: var(--primary); height: 100%; width: 10%; transition: width 0.3s ease;"></div>
                    </div>
                </div>

                <div id="reg-status-message" style="text-align: center; color: var(--primary); margin-bottom: 1rem;"></div>
                
                <!-- Step 1: Business Basics -->
                <div class="setup-step" id="setup-step-1" style="display: block;">
                    <h4 class="form-section-title">Step 1: Business Basics</h4>
                    <p style="color: var(--text-light); margin-bottom: 1.5rem;">Tell us about your business and what services you provide.</p>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-group">
                                <label for="business-name">Business Name *</label>
                                <input type="text" id="business-name" required>
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-group">
                                <label for="display-name">Display Name (for public listing)</label>
                                <input type="text" id="display-name">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-group">
                                <label for="business-email">Business Email *</label>
                                <input type="email" id="business-email" required>
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-group">
                                <label for="business-phone">Business Phone *</label>
                                <input type="tel" id="business-phone" required>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-group">
                                <label for="website-url">Website URL</label>
                                <input type="url" id="website-url" placeholder="https://yourwebsite.com">
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-group">
                                <label for="years-in-business">Years in Business</label>
                                <input type="number" id="years-in-business" min="0" max="100">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="business-description">Business Description *</label>
                        <textarea id="business-description" rows="4" required placeholder="Describe your business and what makes you unique..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="tagline">Tagline (short description)</label>
                        <input type="text" id="tagline" placeholder="Your catchy business tagline...">
                    </div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-group">
                                <label for="primary-category">Primary Category *</label>
                                <select id="primary-category" required>
                                    <option value="">Select primary category</option>
                                    <option value="Photography">Photography</option>
                                    <option value="Catering">Catering</option>
                                    <option value="DJ/Music">DJ/Music</option>
                                    <option value="Florist">Florist</option>
                                    <option value="Venue">Venue</option>
                                    <option value="Wedding Planning">Wedding Planning</option>
                                    <option value="Decoration">Decoration</option>
                                    <option value="Transportation">Transportation</option>
                                    <option value="Entertainment">Entertainment</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-group">
                                <label for="additional-categories">Additional Categories</label>
                                <select id="additional-categories" multiple style="height: 120px;">
                                    <option value="Photography">Photography</option>
                                    <option value="Videography">Videography</option>
                                    <option value="Catering">Catering</option>
                                    <option value="DJ/Music">DJ/Music</option>
                                    <option value="Live Band">Live Band</option>
                                    <option value="Florist">Florist</option>
                                    <option value="Venue">Venue</option>
                                    <option value="Wedding Planning">Wedding Planning</option>
                                    <option value="Event Planning">Event Planning</option>
                                    <option value="Decoration">Decoration</option>
                                    <option value="Lighting">Lighting</option>
                                    <option value="Transportation">Transportation</option>
                                    <option value="Entertainment">Entertainment</option>
                                    <option value="Makeup Artist">Makeup Artist</option>
                                    <option value="Hair Stylist">Hair Stylist</option>
                                </select>
                                <small style="color: var(--text-light);">Hold Ctrl/Cmd to select multiple</small>
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: flex; justify-content: flex-end; gap: 1rem; margin-top: 2rem;">
                        <button type="button" class="btn btn-primary" id="next-to-step-2">Next: Location Information</button>
                    </div>
                </div>

                <!-- Step 2: Location Information -->
                <div class="setup-step" id="setup-step-2" style="display: none;">
                    <h4 class="form-section-title">Step 2: Location Information</h4>
                    <p style="color: var(--text-light); margin-bottom: 1.5rem;">Tell us where your business is located and which areas you serve.</p>
                    
                    <h5 style="margin-bottom: 1rem; color: var(--primary);">Physical Location</h5>
                    <div class="form-group">
                        <label for="business-address">Street Address *</label>
                        <input type="text" id="business-address" required placeholder="123 Main Street">
                    </div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-group">
                                <label for="business-city">City *</label>
                                <input type="text" id="business-city" required>
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-group">
                                <label for="business-state">State/Province *</label>
                                <input type="text" id="business-state" required>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-group">
                                <label for="business-country">Country</label>
                                <select id="business-country">
                                    <option value="USA">United States</option>
                                    <option value="Canada">Canada</option>
                                    <option value="UK">United Kingdom</option>
                                    <option value="Australia">Australia</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-group">
                                <label for="business-postal">Postal/Zip Code *</label>
                                <input type="text" id="business-postal" required>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-group">
                                <label for="business-latitude">Latitude (optional)</label>
                                <input type="number" id="business-latitude" step="any" placeholder="40.7128">
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-group">
                                <label for="business-longitude">Longitude (optional)</label>
                                <input type="number" id="business-longitude" step="any" placeholder="-74.0060">
                            </div>
                        </div>
                    </div>
                    
                    <h5 style="margin: 2rem 0 1rem 0; color: var(--primary);">Service Areas</h5>
                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-group">
                                <label for="service-radius">Service Radius (miles)</label>
                                <input type="number" id="service-radius" min="1" max="500" value="25">
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-group">
                                <label for="additional-service-areas">Additional Cities/Regions Served</label>
                                <textarea id="additional-service-areas" rows="3" placeholder="Enter cities or regions you serve, separated by commas"></textarea>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="extended-area-fees">Additional Fees for Extended Areas</label>
                        <textarea id="extended-area-fees" rows="2" placeholder="Describe any additional fees for travel or extended service areas"></textarea>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; gap: 1rem; margin-top: 2rem;">
                        <button type="button" class="btn btn-outline" id="back-to-step-1">Back: Business Basics</button>
                        <button type="button" class="btn btn-primary" id="next-to-step-3">Next: Gallery & Media</button>
                    </div>
                </div>

                <!-- Step 3: Gallery & Media -->
                <div class="setup-step" id="setup-step-3" style="display: none;">
                    <h4 class="form-section-title">Step 3: Gallery & Media</h4>
                    <p style="color: var(--text-light); margin-bottom: 1.5rem;">Showcase your work with images and portfolio items.</p>
                    
                    <h5 style="margin-bottom: 1rem; color: var(--primary);">Featured Image</h5>
                    <div class="form-group">
                        <label for="featured-image">Featured/Primary Image *</label>
                        <input type="file" id="featured-image" accept="image/*" required>
                        <small style="color: var(--text-light);">This will be the main image displayed on your profile</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="featured-image-url">Or Featured Image URL</label>
                        <input type="url" id="featured-image-url" placeholder="https://example.com/featured-image.jpg">
                    </div>
                    
                    <h5 style="margin: 2rem 0 1rem 0; color: var(--primary);">Gallery Images</h5>
                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-group">
                                <label for="gallery-images">Upload Gallery Images</label>
                                <input type="file" id="gallery-images" accept="image/*" multiple>
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-group">
                                <label for="gallery-image-url">Or Add Image URL</label>
                                <div style="display: flex; gap: 0.5rem;">
                                    <input type="url" id="gallery-image-url" placeholder="https://example.com/image.jpg">
                                    <button type="button" class="btn btn-outline" id="add-gallery-url-btn">Add</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="gallery-preview" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 1rem; margin: 1.5rem 0;">
                        <!-- Gallery items will be added here -->
                    </div>
                    
                    <h5 style="margin: 2rem 0 1rem 0; color: var(--primary);">Portfolio Items</h5>
                    <div id="portfolio-list" style="margin-bottom: 1rem;">
                        <!-- Portfolio items will be listed here -->
                    </div>
                    <button type="button" class="btn btn-outline" id="add-portfolio-btn">Add Portfolio Item</button>
                    
                    <!-- Portfolio Form -->
                    <div id="portfolio-form" style="display: none; margin-top: 1rem; padding: 1rem; border: 1px solid var(--border); border-radius: var(--radius);">
                        <div class="form-group">
                            <label>Project Title</label>
                            <input type="text" id="portfolio-title" required>
                        </div>
                        <div class="form-group">
                            <label>Project Description</label>
                            <textarea id="portfolio-description" rows="3"></textarea>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label>Project Image</label>
                                    <input type="file" id="portfolio-image" accept="image/*">
                                </div>
                            </div>
                            <div class="form-col">
                                <div class="form-group">
                                    <label>Or Image URL</label>
                                    <input type="url" id="portfolio-image-url" placeholder="https://example.com/project.jpg">
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Project Date</label>
                            <input type="date" id="portfolio-date">
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button type="button" class="btn btn-primary" id="add-portfolio-item-btn">Add Portfolio Item</button>
                            <button type="button" class="btn btn-outline" onclick="document.getElementById('portfolio-form').style.display='none'">Cancel</button>
                        </div>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; gap: 1rem; margin-top: 2rem;">
                        <button type="button" class="btn btn-outline" id="back-to-step-2">Back: Location</button>
                        <button type="button" class="btn btn-primary" id="next-to-step-4">Next: Services & Packages</button>
                    </div>
                </div>

                <!-- Step 4: Services & Packages -->
                <div class="setup-step" id="setup-step-4" style="display: none;">
                    <h4 class="form-section-title">Step 4: Services & Packages</h4>
                    <p style="color: var(--text-light); margin-bottom: 1.5rem;">Define your service offerings and packages for clients.</p>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                        <!-- Service Categories Section -->
                        <div>
                            <h5 style="margin-bottom: 1rem; color: var(--primary);">Service Categories</h5>
                            <div id="service-categories-list" style="margin-bottom: 1rem;">
                                <!-- Service categories will be listed here -->
                            </div>
                            <button type="button" class="btn btn-outline" id="add-service-category-btn">Add Category</button>
                            
                            <!-- Service Category Form -->
                            <div id="service-category-form" style="display: none; margin-top: 1rem; padding: 1rem; border: 1px solid var(--border); border-radius: var(--radius);">
                                <div class="form-group">
                                    <label>Category Name</label>
                                    <input type="text" id="category-name" required>
                                </div>
                                <div class="form-group">
                                    <label>Category Description</label>
                                    <textarea id="category-description" rows="2"></textarea>
                                </div>
                                <div style="display: flex; gap: 0.5rem;">
                                    <button type="button" class="btn btn-primary" id="add-category-item-btn">Add Category</button>
                                    <button type="button" class="btn btn-outline" onclick="document.getElementById('service-category-form').style.display='none'">Cancel</button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Services Section -->
                        <div>
                            <h5 style="margin-bottom: 1rem; color: var(--primary);">Individual Services</h5>
                            <div id="services-list" style="margin-bottom: 1rem;">
                                <!-- Services will be listed here -->
                            </div>
                            <button type="button" class="btn btn-outline" id="add-service-btn">Add Service</button>
                            
                            <!-- Service Form -->
                            <div id="service-form" style="display: none; margin-top: 1rem; padding: 1rem; border: 1px solid var(--border); border-radius: var(--radius);">
                                <div class="form-group">
                                    <label>Service Name *</label>
                                    <input type="text" id="service-name" required>
                                </div>
                                <div class="form-group">
                                    <label>Description *</label>
                                    <textarea id="service-description" rows="3" required></textarea>
                                </div>
                                <div class="form-row">
                                    <div class="form-col">
                                        <div class="form-group">
                                            <label>Price ($) *</label>
                                            <input type="number" id="service-price" step="0.01" required>
                                        </div>
                                    </div>
                                    <div class="form-col">
                                        <div class="form-group">
                                            <label>Duration (minutes)</label>
                                            <input type="number" id="service-duration" placeholder="120">
                                        </div>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-col">
                                        <div class="form-group">
                                            <label>Max Attendees/Capacity</label>
                                            <input type="number" id="service-capacity" min="1">
                                        </div>
                                    </div>
                                    <div class="form-col">
                                        <div class="form-group">
                                            <label>Deposit Required (%)</label>
                                            <input type="number" id="service-deposit" min="0" max="100" value="20">
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Cancellation Policy</label>
                                    <textarea id="service-cancellation" rows="2" placeholder="Describe your cancellation policy for this service"></textarea>
                                </div>
                                <div style="display: flex; gap: 0.5rem;">
                                    <button type="button" class="btn btn-primary" id="add-service-item-btn">Add Service</button>
                                    <button type="button" class="btn btn-outline" onclick="document.getElementById('service-form').style.display='none'">Cancel</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <h5 style="margin: 2rem 0 1rem 0; color: var(--primary);">Packages</h5>
                    <div id="packages-list" style="margin-bottom: 1rem;">
                        <!-- Packages will be listed here -->
                    </div>
                    <button type="button" class="btn btn-outline" id="add-package-btn">Add Package</button>
                    
                    <!-- Package Form -->
                    <div id="package-form" style="display: none; margin-top: 1rem; padding: 1rem; border: 1px solid var(--border); border-radius: var(--radius);">
                        <div class="form-group">
                            <label>Package Name *</label>
                            <input type="text" id="package-name" required>
                        </div>
                        <div class="form-group">
                            <label>Description *</label>
                            <textarea id="package-description" rows="3" required></textarea>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label>Price ($) *</label>
                                    <input type="number" id="package-price" step="0.01" required>
                                </div>
                            </div>
                            <div class="form-col">
                                <div class="form-group">
                                    <label>Duration (minutes)</label>
                                    <input type="number" id="package-duration" placeholder="240">
                                </div>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label>Maximum Guests</label>
                                    <input type="number" id="package-max-guests" min="1">
                                </div>
                            </div>
                            <div class="form-col">
                                <div class="form-group">
                                    <label>What's Included</label>
                                    <input type="text" id="package-includes" placeholder="Setup, cleanup, decorations, etc.">
                                </div>
                            </div>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button type="button" class="btn btn-primary" id="add-package-item-btn">Add Package</button>
                            <button type="button" class="btn btn-outline" onclick="document.getElementById('package-form').style.display='none'">Cancel</button>
                        </div>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; gap: 1rem; margin-top: 2rem;">
                        <button type="button" class="btn btn-outline" id="back-to-step-3">Back: Gallery</button>
                        <button type="button" class="btn btn-primary" id="next-to-step-5">Next: Team Information</button>
                    </div>
                </div>

                <!-- Step 5: Team Information -->
                <div class="setup-step" id="setup-step-5" style="display: none;">
                    <h4 class="form-section-title">Step 5: Team Information (Optional)</h4>
                    <p style="color: var(--text-light); margin-bottom: 1.5rem;">Introduce your team members to build trust with potential clients.</p>
                    
                    <div id="team-members-list" style="margin-bottom: 1rem;">
                        <!-- Team members will be listed here -->
                    </div>
                    <button type="button" class="btn btn-outline" id="add-team-member-btn">Add Team Member</button>
                    
                    <!-- Team Member Form -->
                    <div id="team-member-form" style="display: none; margin-top: 1rem; padding: 1rem; border: 1px solid var(--border); border-radius: var(--radius);">
                        <div class="form-group">
                            <label>Name *</label>
                            <input type="text" id="team-member-name" required>
                        </div>
                        <div class="form-group">
                            <label>Role/Position</label>
                            <input type="text" id="team-member-role" placeholder="e.g., Lead Photographer, Event Coordinator">
                        </div>
                        <div class="form-group">
                            <label>Bio</label>
                            <textarea id="team-member-bio" rows="3" placeholder="Brief description of their experience and expertise"></textarea>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label>Photo</label>
                                    <input type="file" id="team-member-photo" accept="image/*">
                                </div>
                            </div>
                            <div class="form-col">
                                <div class="form-group">
                                    <label>Or Photo URL</label>
                                    <input type="url" id="team-member-photo-url" placeholder="https://example.com/photo.jpg">
                                </div>
                            </div>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button type="button" class="btn btn-primary" id="add-team-member-item-btn">Add Team Member</button>
                            <button type="button" class="btn btn-outline" onclick="document.getElementById('team-member-form').style.display='none'">Cancel</button>
                        </div>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; gap: 1rem; margin-top: 2rem;">
                        <button type="button" class="btn btn-outline" id="back-to-step-4">Back: Services</button>
                        <button type="button" class="btn btn-primary" id="next-to-step-6">Next: Social Media</button>
                    </div>
                </div>

                <!-- Step 6: Social Media & Links -->
                <div class="setup-step" id="setup-step-6" style="display: none;">
                    <h4 class="form-section-title">Step 6: Social Media & Links</h4>
                    <p style="color: var(--text-light); margin-bottom: 1.5rem;">Add your social media profiles and external links to help clients connect with you.</p>
                    
                    <h5 style="margin-bottom: 1rem; color: var(--primary);">Social Media Profiles</h5>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
                        <div class="form-group">
                            <label for="social-facebook">Facebook</label>
                            <input type="url" id="social-facebook" placeholder="https://facebook.com/yourpage">
                        </div>
                        <div class="form-group">
                            <label for="social-instagram">Instagram</label>
                            <input type="url" id="social-instagram" placeholder="https://instagram.com/youraccount">
                        </div>
                        <div class="form-group">
                            <label for="social-twitter">Twitter</label>
                            <input type="url" id="social-twitter" placeholder="https://twitter.com/youraccount">
                        </div>
                        <div class="form-group">
                            <label for="social-linkedin">LinkedIn</label>
                            <input type="url" id="social-linkedin" placeholder="https://linkedin.com/company/yourcompany">
                        </div>
                        <div class="form-group">
                            <label for="social-youtube">YouTube</label>
                            <input type="url" id="social-youtube" placeholder="https://youtube.com/yourchannel">
                        </div>
                        <div class="form-group">
                            <label for="social-tiktok">TikTok</label>
                            <input type="url" id="social-tiktok" placeholder="https://tiktok.com/@youraccount">
                        </div>
                    </div>
                    
                    <h5 style="margin: 2rem 0 1rem 0; color: var(--primary);">External Links</h5>
                    <div class="form-group">
                        <label for="booking-link">Booking Link</label>
                        <input type="url" id="booking-link" placeholder="https://yourbookingsite.com">
                        <small style="color: var(--text-light);">Direct link for clients to book your services</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="other-links">Other Relevant Links</label>
                        <textarea id="other-links" rows="3" placeholder="Enter other relevant links (portfolio site, blog, etc.), one per line"></textarea>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; gap: 1rem; margin-top: 2rem;">
                        <button type="button" class="btn btn-outline" id="back-to-step-5">Back: Team</button>
                        <button type="button" class="btn btn-primary" id="next-to-step-7">Next: Availability</button>
                    </div>
                </div>

                <!-- Step 7: Availability & Scheduling -->
                <div class="setup-step" id="setup-step-7" style="display: none;">
                    <h4 class="form-section-title">Step 7: Availability & Scheduling</h4>
                    <p style="color: var(--text-light); margin-bottom: 1.5rem;">Set your business hours and availability preferences.</p>
                    
                    <h5 style="margin-bottom: 1rem; color: var(--primary);">Regular Business Hours</h5>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                        <div class="availability-day">
                            <label style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                <input type="checkbox" id="available-0">
                                <strong>Sunday</strong>
                            </label>
                            <div style="display: flex; gap: 0.5rem;">
                                <input type="time" id="sunday-open" style="flex: 1;">
                                <input type="time" id="sunday-close" style="flex: 1;">
                            </div>
                        </div>
                        <div class="availability-day">
                            <label style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                <input type="checkbox" id="available-1">
                                <strong>Monday</strong>
                            </label>
                            <div style="display: flex; gap: 0.5rem;">
                                <input type="time" id="monday-open" style="flex: 1;">
                                <input type="time" id="monday-close" style="flex: 1;">
                            </div>
                        </div>
                        <div class="availability-day">
                            <label style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                <input type="checkbox" id="available-2">
                                <strong>Tuesday</strong>
                            </label>
                            <div style="display: flex; gap: 0.5rem;">
                                <input type="time" id="tuesday-open" style="flex: 1;">
                                <input type="time" id="tuesday-close" style="flex: 1;">
                            </div>
                        </div>
                        <div class="availability-day">
                            <label style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                <input type="checkbox" id="available-3">
                                <strong>Wednesday</strong>
                            </label>
                            <div style="display: flex; gap: 0.5rem;">
                                <input type="time" id="wednesday-open" style="flex: 1;">
                                <input type="time" id="wednesday-close" style="flex: 1;">
                            </div>
                        </div>
                        <div class="availability-day">
                            <label style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                <input type="checkbox" id="available-4">
                                <strong>Thursday</strong>
                            </label>
                            <div style="display: flex; gap: 0.5rem;">
                                <input type="time" id="thursday-open" style="flex: 1;">
                                <input type="time" id="thursday-close" style="flex: 1;">
                            </div>
                        </div>
                        <div class="availability-day">
                            <label style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                <input type="checkbox" id="available-5">
                                <strong>Friday</strong>
                            </label>
                            <div style="display: flex; gap: 0.5rem;">
                                <input type="time" id="friday-open" style="flex: 1;">
                                <input type="time" id="friday-close" style="flex: 1;">
                            </div>
                        </div>
                        <div class="availability-day">
                            <label style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                <input type="checkbox" id="available-6">
                                <strong>Saturday</strong>
                            </label>
                            <div style="display: flex; gap: 0.5rem;">
                                <input type="time" id="saturday-open" style="flex: 1;">
                                <input type="time" id="saturday-close" style="flex: 1;">
                            </div>
                        </div>
                    </div>
                    
                    <h5 style="margin: 2rem 0 1rem 0; color: var(--primary);">Booking Settings</h5>
                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-group">
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox" id="accepting-bookings">
                                    <strong>Currently Accepting Bookings</strong>
                                </label>
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-group">
                                <label for="response-time">Response Time Expectation (hours)</label>
                                <select id="response-time">
                                    <option value="1">Within 1 hour</option>
                                    <option value="2">Within 2 hours</option>
                                    <option value="4">Within 4 hours</option>
                                    <option value="12">Within 12 hours</option>
                                    <option value="24" selected>Within 24 hours</option>
                                    <option value="48">Within 48 hours</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="buffer-time">Buffer Time Between Bookings (minutes)</label>
                        <input type="number" id="buffer-time" min="0" max="480" value="30" placeholder="30">
                        <small style="color: var(--text-light);">Time needed between bookings for setup/cleanup</small>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; gap: 1rem; margin-top: 2rem;">
                        <button type="button" class="btn btn-outline" id="back-to-step-6">Back: Social Media</button>
                        <button type="button" class="btn btn-primary" id="next-to-step-8">Next: Policies</button>
                    </div>
                </div>

                <!-- Step 8: Policies & Preferences -->
                <div class="setup-step" id="setup-step-8" style="display: none;">
                    <h4 class="form-section-title">Step 8: Policies & Preferences</h4>
                    <p style="color: var(--text-light); margin-bottom: 1.5rem;">Define your business policies and payment preferences.</p>
                    
                    <h5 style="margin-bottom: 1rem; color: var(--primary);">Booking Policies</h5>
                    <div class="form-group">
                        <label for="deposit-requirements">Deposit Requirements</label>
                        <textarea id="deposit-requirements" rows="3" placeholder="Describe your deposit requirements (e.g., 25% deposit required to secure booking)"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="cancellation-policy">Cancellation Policy</label>
                        <textarea id="cancellation-policy" rows="3" placeholder="Describe your cancellation policy and any fees"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="rescheduling-policy">Rescheduling Policy</label>
                        <textarea id="rescheduling-policy" rows="3" placeholder="Describe your rescheduling policy and any restrictions"></textarea>
                    </div>
                    
                    <h5 style="margin: 2rem 0 1rem 0; color: var(--primary);">Payment Preferences</h5>
                    <div class="form-group">
                        <label>Accepted Payment Methods</label>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 0.5rem; margin-top: 0.5rem;">
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" id="payment-cash">
                                Cash
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" id="payment-check">
                                Check
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" id="payment-credit">
                                Credit Card
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" id="payment-debit">
                                Debit Card
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" id="payment-paypal">
                                PayPal
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" id="payment-venmo">
                                Venmo
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" id="payment-zelle">
                                Zelle
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" id="payment-bank">
                                Bank Transfer
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="payment-terms">Payment Terms</label>
                        <textarea id="payment-terms" rows="3" placeholder="Describe your payment terms (e.g., full payment due 7 days before event)"></textarea>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; gap: 1rem; margin-top: 2rem;">
                        <button type="button" class="btn btn-outline" id="back-to-step-7">Back: Availability</button>
                        <button type="button" class="btn btn-primary" id="next-to-step-9">Next: Verification</button>
                    </div>
                </div>

                <!-- Step 9: Verification & Legal -->
                <div class="setup-step" id="setup-step-9" style="display: none;">
                    <h4 class="form-section-title">Step 9: Verification & Legal</h4>
                    <p style="color: var(--text-light); margin-bottom: 1.5rem;">Provide verification information to build trust with clients.</p>
                    
                    <h5 style="margin-bottom: 1rem; color: var(--primary);">Business Verification</h5>
                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-group">
                                <label for="license-number">License Number</label>
                                <input type="text" id="license-number" placeholder="Business license number">
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-group">
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox" id="insurance-verified">
                                    <strong>Insurance Verified</strong>
                                </label>
                                <small style="color: var(--text-light);">Check if you have liability insurance</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="awards-certifications">Awards & Certifications</label>
                        <textarea id="awards-certifications" rows="3" placeholder="List any awards, certifications, or professional memberships"></textarea>
                    </div>
                    
                    <h5 style="margin: 2rem 0 1rem 0; color: var(--primary);">Business Attributes</h5>
                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-group">
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox" id="eco-friendly">
                                    <strong>Eco-Friendly Practices</strong>
                                </label>
                                <small style="color: var(--text-light);">Check if you use sustainable/eco-friendly practices</small>
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-group">
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox" id="premium-status">
                                    <strong>Premium Status</strong>
                                </label>
                                <small style="color: var(--text-light);">Request premium listing status</small>
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; gap: 1rem; margin-top: 2rem;">
                        <button type="button" class="btn btn-outline" id="back-to-step-8">Back: Policies</button>
                        <button type="button" class="btn btn-primary" id="next-to-step-10">Next: Complete Setup</button>
                    </div>
                </div>

                <!-- Step 10: Setup Completion -->
                <div class="setup-step" id="setup-step-10" style="display: none;">
                    <h4 class="form-section-title">Step 10: Setup Completion</h4>
                    <p style="color: var(--text-light); margin-bottom: 1.5rem;">Add optional information and complete your vendor profile setup.</p>
                    
                    <h5 style="margin-bottom: 1rem; color: var(--primary);">FAQ Section (Optional)</h5>
                    <div id="faqs-list" style="margin-bottom: 1rem;">
                        <!-- FAQs will be listed here -->
                    </div>
                    <button type="button" class="btn btn-outline" id="add-faq-btn">Add FAQ</button>
                    
                    <!-- FAQ Form -->
                    <div id="faq-form" style="display: none; margin-top: 1rem; padding: 1rem; border: 1px solid var(--border); border-radius: var(--radius);">
                        <div class="form-group">
                            <label>Question</label>
                            <input type="text" id="faq-question" required placeholder="What is your typical response time?">
                        </div>
                        <div class="form-group">
                            <label>Answer</label>
                            <textarea id="faq-answer" rows="3" required placeholder="I typically respond to inquiries within 24 hours..."></textarea>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button type="button" class="btn btn-primary" id="add-faq-item-btn">Add FAQ</button>
                            <button type="button" class="btn btn-outline" onclick="document.getElementById('faq-form').style.display='none'">Cancel</button>
                        </div>
                    </div>
                    
                    <h5 style="margin: 2rem 0 1rem 0; color: var(--primary);">Setup Summary</h5>
                    <div id="setup-summary" style="background-color: var(--secondary); padding: 1.5rem; border-radius: var(--radius); margin-bottom: 2rem;">
                        <p style="margin-bottom: 1rem;"> <strong>Congratulations!</strong> You're about to complete your vendor profile setup.</p>
                        <p style="margin-bottom: 1rem;">Your profile will include:</p>
                        <ul style="margin-left: 1.5rem; margin-bottom: 1rem;">
                            <li>Business information and categories</li>
                            <li>Location and service areas</li>
                            <li>Gallery and portfolio</li>
                            <li>Services and packages</li>
                            <li>Team information</li>
                            <li>Social media links</li>
                            <li>Availability schedule</li>
                            <li>Business policies</li>
                            <li>Verification details</li>
                        </ul>
                        <p><strong>Once completed, your profile will be live and visible to potential clients!</strong></p>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; gap: 1rem; margin-top: 2rem;">
                        <button type="button" class="btn btn-outline" id="back-to-step-9">Back: Verification</button>
                        <button type="button" class="btn btn-primary" id="complete-setup-btn" style="background-color: #28a745; border-color: #28a745;"> Complete Setup & Go Live!</button>
                    </div>
                </div>

                <!-- Step 3: Social Media -->
                <div class="setup-step" id="setup-step-3" style="display: none;">
                    <h4 class="form-section-title">Step 3: Social Media Links</h4>
                    <p style="color: var(--text-light); margin-bottom: 1.5rem;">Add your social media profiles to help clients connect with you.</p>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
                        <div class="form-group">
                            <label for="social-facebook">Facebook</label>
                            <input type="url" id="social-facebook" placeholder="https://facebook.com/yourpage">
                        </div>
                        <div class="form-group">
                            <label for="social-instagram">Instagram</label>
                            <input type="url" id="social-instagram" placeholder="https://instagram.com/youraccount">
                        </div>
                        <div class="form-group">
                            <label for="social-twitter">Twitter</label>
                            <input type="url" id="social-twitter" placeholder="https://twitter.com/youraccount">
                        </div>
                        <div class="form-group">
                            <label for="social-linkedin">LinkedIn</label>
                            <input type="url" id="social-linkedin" placeholder="https://linkedin.com/company/yourcompany">
                        </div>
                        <div class="form-group">
                            <label for="social-youtube">YouTube</label>
                            <input type="url" id="social-youtube" placeholder="https://youtube.com/yourchannel">
                        </div>
                        <div class="form-group">
                            <label for="social-tiktok">TikTok</label>
                            <input type="url" id="social-tiktok" placeholder="https://tiktok.com/@youraccount">
                        </div>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; gap: 1rem; margin-top: 2rem;">
                        <button type="button" class="btn btn-outline" id="back-to-step-2">Back: Packages &amp; Services</button>
                        <button type="button" class="btn btn-primary" id="next-to-step-4">Next: Availability</button>
                    </div>
                </div>

                <!-- Step 4: Availability -->
                <div class="setup-step" id="setup-step-4" style="display: none;">
                    <h4 class="form-section-title">Step 4: Set Your Availability</h4>
                    <p style="color: var(--text-light); margin-bottom: 1.5rem;">Let clients know when you're available for bookings.</p>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                        <div class="availability-day">
                            <label style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                <input type="checkbox" id="available-0">
                                <strong>Sunday</strong>
                            </label>
                            <div style="display: flex; gap: 0.5rem;">
                                <input type="time" id="start-0" style="flex: 1;">
                                <span style="align-self: center;">to</span>
                                <input type="time" id="end-0" style="flex: 1;">
                            </div>
                        </div>
                        <div class="availability-day">
                            <label style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                <input type="checkbox" id="available-1">
                                <strong>Monday</strong>
                            </label>
                            <div style="display: flex; gap: 0.5rem;">
                                <input type="time" id="start-1" style="flex: 1;">
                                <span style="align-self: center;">to</span>
                                <input type="time" id="end-1" style="flex: 1;">
                            </div>
                        </div>
                        <div class="availability-day">
                            <label style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                <input type="checkbox" id="available-2">
                                <strong>Tuesday</strong>
                            </label>
                            <div style="display: flex; gap: 0.5rem;">
                                <input type="time" id="start-2" style="flex: 1;">
                                <span style="align-self: center;">to</span>
                                <input type="time" id="end-2" style="flex: 1;">
                            </div>
                        </div>
                        <div class="availability-day">
                            <label style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                <input type="checkbox" id="available-3">
                                <strong>Wednesday</strong>
                            </label>
                            <div style="display: flex; gap: 0.5rem;">
                                <input type="time" id="start-3" style="flex: 1;">
                                <span style="align-self: center;">to</span>
                                <input type="time" id="end-3" style="flex: 1;">
                            </div>
                        </div>
                        <div class="availability-day">
                            <label style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                <input type="checkbox" id="available-4">
                                <strong>Thursday</strong>
                            </label>
                            <div style="display: flex; gap: 0.5rem;">
                                <input type="time" id="start-4" style="flex: 1;">
                                <span style="align-self: center;">to</span>
                                <input type="time" id="end-4" style="flex: 1;">
                            </div>
                        </div>
                        <div class="availability-day">
                            <label style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                <input type="checkbox" id="available-5">
                                <strong>Friday</strong>
                            </label>
                            <div style="display: flex; gap: 0.5rem;">
                                <input type="time" id="start-5" style="flex: 1;">
                                <span style="align-self: center;">to</span>
                                <input type="time" id="end-5" style="flex: 1;">
                            </div>
                        </div>
                        <div class="availability-day">
                            <label style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                <input type="checkbox" id="available-6">
                                <strong>Saturday</strong>
                            </label>
                            <div style="display: flex; gap: 0.5rem;">
                                <input type="time" id="start-6" style="flex: 1;">
                                <span style="align-self: center;">to</span>
                                <input type="time" id="end-6" style="flex: 1;">
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; gap: 1rem; margin-top: 2rem;">
                        <button type="button" class="btn btn-outline" id="back-to-step-3">Back: Social Media</button>
                        <button type="button" class="btn btn-primary" id="complete-setup-btn">Complete Setup</button>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- Vendor Modal (working version) -->
    <div id="vendor-modal" class="modal" style="display:none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-vendor-name">Vendor Name</h3>
                <span class="close-modal"></span>
            </div>
            <div class="modal-body">
                <!-- Image Gallery -->
                <div id="modal-image-gallery" class="image-gallery">
                    <!-- Images will be loaded dynamically here -->
                </div>

                <!-- Header Info -->
                <div class="vendor-detail-header">
                    <div class="vendor-detail-image">
                        <!-- Image or placeholder will be rendered here -->
                    </div>
                    <div class="vendor-detail-info">
                        <h2 id="modal-vendor-name-full" class="vendor-detail-name">Vendor Name</h2>
                        <div class="vendor-detail-location"> <span id="modal-vendor-location">Location</span></div>
                        <div class="vendor-detail-ratings">
                            <div class="review-rating" id="modal-vendor-rating">
                                 <span>(0.0) | 0 Reviews</span>
                            </div>
                        </div>
                        <div class="vendor-detail-features">
                            <div class="feature">
                                <span class="feature-icon" id="modal-vendor-category-icon"></span>
                                <span id="modal-vendor-category-name"></span>
                            </div>
                            <div class="feature">
                                <span class="feature-icon"></span>
                                <span id="modal-vendor-services-offered">Services</span>
                            </div>
                        </div>
                        <p class="vendor-detail-price" id="modal-vendor-price"></p>
                    </div>
                </div>

                <!-- About Us -->
                <h3 class="services-title">About Us</h3>
                <p id="modal-vendor-description" class="vendor-detail-description">
                    Vendor description will appear here...
                </p>

                <!-- Services -->
                <div id="services-section" class="services-section">
                    <h3 class="services-title">Available Services</h3>
                    <!-- Services will be rendered here -->
                </div>

                <!-- Booking Form -->
                <div class="booking-flow">
                    <h3 class="services-title">Book This Vendor</h3>
                    <div class="form-group">
                        <label for="booking-date-picker" class="form-label">Select a Date and Time</label>
                        <input type="text" id="booking-date-picker" class="form-control" placeholder="Choose a date and time">
                    </div>
                    <button class="btn btn-primary" id="open-booking-modal-btn">
                        Book Now
                    </button>
                    <button class="btn btn-outline" id="open-chat-btn">
                        Message Vendor
                    </button>
                </div>

                <!-- Booking Calendar Section (Moved inside modal-body) -->
                <div class="booking-calendar-section">
                    <h3 class="calendar-title">Select Date &amp; Time</h3>
                    <div id="booking-calendar"></div>
                    <div class="time-slots" id="time-slots"></div>
                </div>

                <!-- Reviews Section -->
                <div class="reviews-section">
                    <h3 class="reviews-title">Customer Reviews</h3>
                    <div id="modal-reviews-list">
                        <!-- Reviews will be rendered here -->
                    </div>

                    ${currentUser ? `
                        <button class="btn btn-outline add-review-btn" id="show-review-form">Add Review</button>
                        <div class="review-form" id="review-form" style="display: none;">
                            <div class="rating-input">
                                <span class="rating-star" data-rating="1"></span>
                                <span class="rating-star" data-rating="2"></span>
                                <span class="rating-star" data-rating="3"></span>
                                <span class="rating-star" data-rating="4"></span>
                                <span class="rating-star" data-rating="5"></span>
                            </div>
                            <textarea class="review-textarea" id="review-text" placeholder="Share your experience..."></textarea>
                            <button class="btn btn-primary" id="submit-review">Submit Review</button>
                        </div>
                    ` : '<p><a href="#" id="login-to-review" style="color: var(--primary);">Log in</a> to leave a review</p>'}
                </div>

                <!-- Chat Section -->
                <div class="chat-section">
                    <h3 class="chat-title">Message Vendor</h3>
                    <div class="chat-container">
                        <div class="chat-messages" id="chat-messages">
                            <!-- Messages will load here -->
                        </div>
                        <div class="chat-input">
                            <input type="text" placeholder="Type your message..." id="chat-input">
                            <button class="btn btn-primary" id="send-btn">Send</button>
                        </div>
                    </div>
                </div>

                <!-- Payment Section -->
                <div class="payment-section" id="payment-section" style="display: none;">
                    <h3 class="payment-title">Payment Information</h3>
                    <div class="payment-form">
                        <div class="form-group">
                            <label>Cardholder Name</label>
                            <input type="text" id="cardholder-name">
                        </div>
                        <div class="card-element" id="card-element"></div>
                        <button class="btn btn-primary" id="pay-now-btn">Pay Now</button>
                    </div>
                </div>

                <div class="vendor-actions" style="margin-top: 2rem; justify-content: center;">
                    <button class="btn btn-primary" id="book-now-btn">Book Now</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- New Chat Modal -->
    <div id="chat-modal" class="modal chat-modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Chat with <span id="chat-vendor-name">Vendor</span></h3>
                <span class="close-modal"></span>
            </div>
            <div class="modal-body">
                <div class="chat-container">
                    <div class="chat-messages" id="profile-chat-messages">
                        <!-- Messages will load here -->
                    </div>
                    <div class="chat-input">
                        <input type="text" placeholder="Type your message..." id="profile-chat-input">
                        <button class="btn btn-primary" id="profile-send-btn">Send</button>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- Booking Confirmation -->
    <div id="confirmation-modal" class="booking-confirmation" style="display: none;">
        <div class="confirmation-content">
            <h3> Booking Confirmed!</h3>
            <p><strong>Vendor:</strong> <span id="conf-venue-name"></span></p>
            <p><strong>Services:</strong> <span id="conf-services"></span></p>
            <p><strong>Date:</strong> <span id="conf-date"></span></p>
            <p><strong>Time:</strong> <span id="conf-time"></span></p>
            <p><strong>Confirmation #:</strong> <span id="conf-id"></span></p>
            <p>A confirmation email has been sent to your registered email address.</p>
            <button class="btn btn-primary" id="conf-done-btn">Done</button>
        </div>
    </div>

    <!-- Location Permission Modal -->
    <div id="location-permission" class="location-permission" style="display: none;">
        <div class="location-content">
            <h3>Find Vendors Near You</h3>
            <p>VenueVue would like to access your location to show vendors near you.</p>
            <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 1.5rem;">
                <button class="btn btn-outline" id="deny-location">Not Now</button>
                <button class="btn btn-primary" id="allow-location">
                    Allow
                    <span id="location-loading" class="location-loading" style="display: none;"></span>
                </button>
            </div>
        </div>
    </div>

    <!-- Profile Modal -->
    <div id="profile-modal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h3 id="profile-modal-title">My Account</h3>
                <span class="close-modal" id="close-profile-modal"></span>
            </div>
            <div class="modal-body">
                <!-- Login Form (shown by default) -->
                <div id="login-form" style="display: none;">
                    <div style="margin-bottom: 1.5rem;">
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Email</label>
                        <input type="email" id="login-email" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border); border-radius: var(--radius); margin-bottom: 1rem;">
                    </div>
                    <div style="margin-bottom: 1.5rem;">
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Password</label>
                        <input type="password" id="login-password" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border); border-radius: var(--radius); margin-bottom: 1rem;">
                    </div>
                    <button class="btn btn-primary" id="login-btn" style="width: 100%; margin-bottom: 1rem;">Log In</button>
                    <div style="text-align: center; margin-bottom: 1.5rem;">
                        <a href="#" id="show-signup" style="color: var(--primary); text-decoration: none; font-size: 0.9rem;">Don't have an account? Sign up</a>
                    </div>
                    <div style="display: flex; align-items: center; margin-bottom: 1.5rem;">
                        <div style="flex: 1; height: 1px; background-color: var(--border);"></div>
                        <div style="padding: 0 1rem; color: var(--text-light); font-size: 0.9rem;">OR</div>
                        <div style="flex: 1; height: 1px; background-color: var(--border);"></div>
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                        <button class="btn btn-outline" id="google-login" style="width: 100%; display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/c/c1/Google_%22G%22_logo.svg" width="20" height="20">
                            <span>Continue with Google</span>
                        </button>
                        <button class="btn btn-outline" id="facebook-login" style="width: 100%; display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/5/51/Facebook_f_logo_%282019%29.svg" width="20" height="20">
                            <span>Continue with Facebook</span>
                        </button>
                    </div>
                </div>

                <!-- Signup Form (hidden by default) -->
                <div id="signup-form" style="display: none;">
                    <div style="margin-bottom: 1.5rem;">
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Full Name</label>
                        <input type="text" id="signup-name" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border); border-radius: var(--radius); margin-bottom: 1rem;">
                    </div>
                    <div style="margin-bottom: 1.5rem;">
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Email</label>
                        <input type="email" id="signup-email" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border); border-radius: var(--radius); margin-bottom: 1rem;">
                    </div>
                    <div style="margin-bottom: 1.5rem;">
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Password</label>
                        <input type="password" id="signup-password" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border); border-radius: var(--radius); margin-bottom: 1rem;">
                    </div>
                    <div class="form-group" style="margin-bottom: 1.5rem;">
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Account Type</label>
                        <select id="account-type" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border); border-radius: var(--radius);">
                            <option value="client">Client (I want to book vendors)</option>
                            <option value="vendor">Vendor (I provide services)</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" id="signup-btn" style="width: 100%; margin-bottom: 1rem;">Create Account</button>
                    <div style="text-align: center;">
                        <a href="#" id="show-login" style="color: var(--primary); text-decoration: none; font-size: 0.9rem;">Already have an account? Log in</a>
                    </div>
                </div>

                <!-- Logged In View (hidden by default) -->
                <div id="logged-in-view" style="display: block; text-align: center;">
                    <div class="profile-avatar" id="profile-avatar">S</div>
                    <h3 style="margin-bottom: 0.5rem;" id="profile-name">User Name</h3>
                    <p style="color: var(--text-light); margin-bottom: 1.5rem;" id="profile-email">user@example.com</p>
                    <button class="btn btn-primary" id="view-dashboard-btn" style="width: 100%; margin-bottom: 1rem;">View Dashboard</button>
                    <button class="btn btn-outline" id="logout-btn" style="width: 100%;">Log Out</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Lightbox Modal -->
    <div id="lightbox-modal" class="lightbox-modal">
        <span class="lightbox-close"></span>
        <button class="lightbox-nav lightbox-prev"></button>
        <div class="lightbox-content">
            <img src="" alt="Lightbox image" id="lightbox-image">
        </div>
        <button class="lightbox-nav lightbox-next"></button>
    </div>

    <!-- Google Maps API -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB41DRUbKWJHPxaFjMAwdrzWzbVKartNGg&amp;libraries=places&amp;v=weekly" defer=""></script>

    <!-- Facebook SDK -->
    <script>
      window.fbAsyncInit = function() {
        FB.init({
          appId: 'YOUR_FACEBOOK_APP_ID',
          cookie: true,
          xfbml: true,
          version: 'v18.0'
        });
      };
    </script>
    <script async="" defer="" crossorigin="anonymous" src="https://connect.facebook.net/en_US/sdk.js"></script>

    <!-- Main Application Script -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // API base URL
            const API_BASE_URL = 'https://bdb-3-0-venuevue-api.onrender.com/api';

            // Initialize variables
            const mainAppView = document.getElementById('app-container');
            const vendorProfilePage = document.getElementById('vendor-profile-page');
            const confirmationModal = document.getElementById('confirmation-modal');
            const locationPermissionModal = document.getElementById('location-permission');
            const vendorGrid = document.getElementById('vendor-grid');
            const mapVenueList = document.getElementById('map-venue-list');
            const resultsTitle = document.querySelector('.results-title');
            const resultsCount = document.querySelector('.results-count');
            const mapViewContainer = document.getElementById('map-view-container');
            const searchInput = document.getElementById('search-input');
            const sortSelect = document.getElementById('sort-select');
            const wishlistBtn = document.getElementById('wishlist-btn');
            const notificationsBtn = document.getElementById('notifications-btn');
            const profileBtn = document.getElementById('profile-btn');
            const filterResetBtns = document.querySelectorAll('.filter-reset');
            const trendingTags = document.querySelectorAll('.trending-tag');
            const pagination = document.getElementById('pagination');
            const prevPageBtn = document.getElementById('prev-page');
            const nextPageBtn = document.getElementById('next-page');
            const locateMeBtn = document.getElementById('locate-me');
            const allowLocationBtn = document.getElementById('allow-location');
            const denyLocationBtn = document.getElementById('deny-location');
            const currentLocationCheckbox = document.getElementById('current-location');
            const locationLoading = document.getElementById('location-loading');
            const locationInput = document.getElementById('location-input');
            const categoryItems = document.querySelectorAll('.category-item');
            const advancedToggle = document.getElementById('advanced-toggle');
            const advancedContent = document.getElementById('advanced-content');
            const categoriesListInner = document.getElementById('categories-list');
            const categoriesListWrapper = document.querySelector('.categories-list-wrapper');
            const scrollLeftBtn = document.getElementById('scroll-left');
            const scrollRightBtn = document.getElementById('scroll-right');

            // Profile modal elements
            const profileModal = document.getElementById('profile-modal');
            const closeProfileModal = document.getElementById('close-profile-modal');
            const loginForm = document.getElementById('login-form');
            const signupForm = document.getElementById('signup-form');
            const loggedInView = document.getElementById('logged-in-view');
            const showSignup = document.getElementById('show-signup');
            const showLogin = document.getElementById('show-login');
            const loginBtn = document.getElementById('login-btn');
            const signupBtn = document.getElementById('signup-btn');
            const logoutBtn = document.getElementById('logout-btn');
            const googleLoginBtn = document.getElementById('google-login');
            const facebookLoginBtn = document.getElementById('facebook-login');
            const viewDashboardBtn = document.getElementById('view-dashboard-btn');
            const accountTypeSelect = document.getElementById('account-type');

            // Dashboard elements
            const appContainer = document.getElementById('app-container');
            const clientDashboardContainer = document.getElementById('dashboard-container');
            const vendorDashboardContainer = document.getElementById('vendor-dashboard-container');
            const clientDashboardMenuItems = clientDashboardContainer.querySelectorAll('.dashboard-menu a');
            const vendorDashboardMenuItems = vendorDashboardContainer.querySelectorAll('.dashboard-menu a');
            const switchToVendorBtn = document.getElementById('switch-to-vendor');
            const switchToClientBtn = document.getElementById('switch-to-client');
            const logoutDashboardBtn = document.getElementById('logout-dashboard');
            const vendorLogoutBtn = document.getElementById('vendor-logout');
            
            // Chat modal elements
            const chatModal = document.getElementById('chat-modal');
            const chatVendorName = document.getElementById('chat-vendor-name');
            const profileChatInput = document.getElementById('profile-chat-input');
            const profileSendBtn = document.getElementById('profile-send-btn');
            const profileChatMessages = document.getElementById('profile-chat-messages');

            // Vendor registration elements
            const vendorRegistrationModal = document.getElementById('vendor-registration-modal');
            const regStatusMessage = document.getElementById('reg-status-message');


            // Chat state manager
            const chatState = {
                messages: [],
                currentConversation: null,
                currentChatVendorId: null,

                init: function() {
                    this.messages = [];
                    this.currentConversation = null;
                    this.currentChatVendorId = null;
                    console.log('Chat state initialized.');
                },

                addMessage: function(message) {
                    if (!this.messages) this.messages = [];
                    const formattedMsg = this.formatMessage(message);
                    this.messages.push(formattedMsg);
                    console.log('Message added to chat state:', formattedMsg);
                    return formattedMsg;
                },

                setMessages: function(messages) {
                    this.messages = Array.isArray(messages) ? messages.map(msg => this.formatMessage(msg)) : [];
                    console.log('Chat messages set:', this.messages);
                },

                getMessages: function() {
                    return this.messages || [];
                },

                formatMessage: function(message) {
                    console.log('Formatting message:', message);
                    const content = message.Content || message.content || message.text || message.messageContent;
                    if (content === undefined) {
                        console.warn('Message content is undefined after formatting attempts for message:', message);
                    }
                    return {
                        id: message.MessageID || message.id || `msg-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,
                        conversationId: message.ConversationID || message.conversationId || this.currentConversation,
                        senderId: message.SenderID || message.senderId,
                        senderName: message.SenderName || message.senderName || (message.SenderID === currentUser?.id ? currentUser.name : 'Vendor'),
                        content: content,
                        timestamp: message.CreatedAt || message.timestamp || new Date().toISOString(),
                        isCurrentUser: message.SenderID === currentUser?.id || message.isCurrentUser,
                        isRead: message.IsRead || message.isRead || false
                    };
                }
            };


            // App state
            let state = {
                vendors: [],
                filteredVendors: [],
                favorites: [],
                currentPage: 1,
                itemsPerPage: 6,
                map: null,
                markers: [],
                currentView: 'list',
                userLocation: null,
                currentCategory: 'all',
                filters: {
                    location: '',
                    types: ['independent', 'company'],
                    price: 40,
                    popular: [],
                    startDate: null,
                    endDate: null,
                    region: ''
                },
                currentVendor: null,
                selectedServices: [],
                selectedDate: null,
                selectedTime: null,
                stripe: null,
                elements: null,
                paymentIntent: null,
                socket: null,
                chat: chatState
            };

            // User state
            let currentUser = null;

            // State variables for dashboard mode and active section, persisted in localStorage
            let isVendorMode = localStorage.getItem('isVendorMode') === 'true';
            let activeDashboardSection = localStorage.getItem('activeDashboardSection') || 'dashboard';

            // Lightbox state
            let lightboxImages = [];
            let currentLightboxIndex = 0;

            // Initialize the app
            init();

            async function init() {
                // Load categories first
                await loadCategories();

                // Check for existing user session
                await checkAuthStatus();
                
                // Handle initial page load based on URL or state
                handleUrlChange();

                // Show loading state
                vendorGrid.innerHTML = '<div style="grid-column:1/-1;text-align:center;padding:2rem;">Loading vendors...</div>';

                try {
                    // Load vendors data from API
                    await loadVendors();

                    // Initialize Stripe
                    initializeStripe();

                    // Connect to Socket.IO
                    connectToChat();

                    // Request location after everything is loaded
                    requestLocationWithFeedback();

                    // Setup event listeners
                    setupEventListeners();

                    // Always show the main app container on initial load
                    mainAppView.style.display = 'grid';
                    clientDashboardContainer.style.display = 'none';
                    vendorDashboardContainer.style.display = 'none';

                    // Setup lightbox event listeners
                    setupLightboxEventListeners();

                } catch (error) {
                    console.error('Initialization error:', error);
                    showError("Failed to load vendors. Please try again later.");
                }
            }
            
            // New router-like functionality for SPA
            function handleUrlChange() {
                const path = window.location.hash.substring(1);
                // Dashboard is now a modal, not a separate page route
                if (path.startsWith('/listings/')) {
                    const vendorId = path.split('/')[2];
                    showVendorProfilePage(vendorId);
                } else {
                    showMainApp();
                }
            }

            function showMainApp() {
                mainAppView.style.display = 'grid';
                vendorProfilePage.style.display = 'none';
                // Dashboards are now in a modal, so we don't hide them here
                // The modal's own close button will handle hiding it.
                window.location.hash = '';
                document.body.style.overflow = 'auto';
            }

            // Load categories from API
            async function loadCategories() {
                try {
                    // In a real app, you would fetch categories from your API
                    // For now, we'll use a predefined list that matches the backend
                    state.categories = [
                        { id: 'all', name: 'All Categories' },
                        { id: 'venue', name: 'Venues' },
                        { id: 'photo', name: 'Photo/Video' },
                        { id: 'music', name: 'Music/DJ' },
                        { id: 'catering', name: 'Catering' },
                        { id: 'entertainment', name: 'Entertainment' },
                        { id: 'experiences', name: 'Experiences' },
                        { id: 'decor', name: 'Decorations' },
                        { id: 'beauty', name: 'Beauty' },
                        { id: 'cake', name: 'Cake' },
                        { id: 'transport', name: 'Transportation' },
                        { id: 'planner', name: 'Planners' },
                        { id: 'fashion', name: 'Fashion' },
                        { id: 'stationery', name: 'Stationery' }
                    ];

            // Render categories
            renderCategories();

        } catch (error) {
            console.error('Error loading categories:', error);
        }
    }

    // Render categories in the navigation with icons vertically stacked
    function renderCategories() {
        categoriesListInner.innerHTML = '';

        state.categories.forEach(category => {
            const categoryItem = document.createElement('div');
            categoryItem.className = 'category-item';
            if (category.id === 'all') categoryItem.classList.add('active');
            categoryItem.dataset.category = category.id;

            // Add icon element above label
            const iconHtml = getCategoryIconHtml(category.id);
            categoryItem.innerHTML = `${iconHtml}<span>${category.name}</span>`;

            categoryItem.addEventListener('click', () => {
                // Update active category
                document.querySelectorAll('.category-item').forEach(item => item.classList.remove('active'));
                categoryItem.classList.add('active');

                // Set current category
                state.currentCategory = category.id;

                // Filter vendors
                filterVendors();
            });

            categoriesListInner.appendChild(categoryItem);
        });
    }

    // Helper function to get category icon HTML using Font Awesome icons
    function getCategoryIconHtml(category) {
        const icons = {
            "all": "<i class='fas fa-th-large'></i>",
            "venue": "<i class='fas fa-building'></i>",
            "photo": "<i class='fas fa-camera'></i>",
            "music": "<i class='fas fa-music'></i>",
            "catering": "<i class='fas fa-utensils'></i>",
            "entertainment": "<i class='fas fa-theater-masks'></i>",
            "experiences": "<i class='fas fa-star'></i>",
            "decor": "<i class='fas fa-ribbon'></i>",
            "beauty": "<i class='fas fa-spa'></i>",
            "cake": "<i class='fas fa-birthday-cake'></i>",
            "transport": "<i class='fas fa-shuttle-van'></i>",
            "planner": "<i class='fas fa-clipboard-list'></i>",
            "fashion": "<i class='fas fa-tshirt'></i>",
            "stationery": "<i class='fas fa-envelope'></i>"
        };
        return icons[category] || "<i class='fas fa-gem'></i>";
    }
            async function loadVendors() {
                try {
                    console.log('Loading vendors from API:', `${API_BASE_URL}/vendors`);
                    const response = await fetch(`${API_BASE_URL}/vendors`);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }

                    const data = await response.json();
                    console.log('API Response:', data);
                    
                    if (data && data.vendors && Array.isArray(data.vendors) && data.vendors.length > 0) {
                        // Process vendor data from API with Cloudinary images
                        state.vendors = data.vendors.map(vendor => {
                            // Parse services if they come as JSON string
                            let services = [];
                            try {
                                if (typeof vendor.services === 'string') {
                                    services = JSON.parse(vendor.services);
                                } else if (Array.isArray(vendor.services)) {
                                    services = vendor.services;
                                }
                            } catch (e) {
                                console.warn('Error parsing services for vendor:', vendor.name, e);
                                services = [];
                            }

                            // Parse reviews if they come as JSON string
                            let reviews = [];
                            try {
                                if (typeof vendor.reviews === 'string') {
                                    reviews = JSON.parse(vendor.reviews);
                                } else if (Array.isArray(vendor.reviews)) {
                                    reviews = vendor.reviews;
                                }
                            } catch (e) {
                                console.warn('Error parsing reviews for vendor:', vendor.name, e);
                                reviews = [];
                            }

                            // Map type to category
                            const category = mapTypeToCategory(vendor.type);

                            // Process Cloudinary images
                            const featuredImage = vendor.featuredImage || null;
                            const images = vendor.images || [];
                            const imageCount = vendor.imageCount || 0;

                            return {
                                ...vendor,
                                services: services,
                                reviews: reviews,
                                category: category,
                                featuredImage: featuredImage,
                                images: images,
                                imageCount: imageCount,
                                coordinates: {
                                    lat: vendor.latitude || getRandomLat(),
                                    lng: vendor.longitude || getRandomLng()
                                },
                                priceLevel: vendor.priceLevel || getRandomPriceLevel(),
                                isPremium: vendor.isPremium || false,
                                isEcoFriendly: vendor.isEcoFriendly || false,
                                isAwardWinning: vendor.isAwardWinning || false,
                                rating: vendor.rating || '4.5',
                                reviewCount: vendor.reviewCount || vendor.ReviewCount || 0
                            };
                        });

                        state.filteredVendors = [...state.vendors];

                        console.log('Processed vendors:', state.vendors.length);
                        
                        // Update UI
                        updateMetadata({ total: data.totalCount || state.filteredVendors.length });
                        renderVendors();

                    } else {
                        console.error('Invalid API response structure:', data);
                        showError("No vendors found or invalid API response");
                    }
                } catch (error) {
                    console.error('Error loading vendors from API:', error);
                    showError(`Failed to load vendors: ${error.message}`);
                }
            }

            // Helper function to generate sample reviews
            function generateSampleReviews() {
                const reviews = [];
                const reviewTexts = [
                    "Great service! Would definitely book again.",
                    "Very professional and easy to work with.",
                    "The venue was perfect for our event.",
                    "Everything went smoothly, highly recommend!",
                    "Good quality but communication could be better.",
                    "Delivered exactly what was promised."
                ];

                const names = ["John D.", "Sarah M.", "Michael T.", "Emily R.", "David K.", "Jessica L."];

                for (let i = 0; i < 5; i++) {
                    reviews.push({
                        id: `review-${i}`,
                        user: names[i],
                        rating: Math.floor(Math.random() * 2) + 4,
                        comment: reviewTexts[i],
                        date: new Date(Date.now() - Math.floor(Math.random() * 30) * 24 * 60 * 60 * 1000).toISOString()
                    });
                }

                return reviews;
            }

            // Helper function to map vendor types to categories
            function mapTypeToCategory(type) {
                const typeMap = {
                    "Photography": "photo",
                    "Photo": "photo",
                    "Videography": "photo",
                    "Entertainment": "entertainment",
                    "Music": "music",
                    "DJ": "music",
                    "Decor": "decor",
                    "Florist": "decor",
                    "Catering": "catering",
                    "Food": "catering",
                    "Venue": "venue",
                    "Hotel": "venue",
                    "Transportation": "transport",
                };
                return typeMap[type] || type.toLowerCase();
            }

            // Check for existing user session
            async function checkAuthStatus() {
                const token = localStorage.getItem('token');
                if (!token) return;

                try {
                    const response = await fetch(`${API_BASE_URL}/users/me`, {
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });

                    if (response.ok) {
                        const userData = await response.json();
                        simulateLogin({
                            id: userData.userId,
                            name: userData.name || userData.email.split('@')[0],
                            email: userData.email,
                            avatar: userData.name ? userData.name[0].toUpperCase() : userData.email[0].toUpperCase(),
                            isVendor: userData.isVendor || false
                        });

                        // Load user favorites
                        await loadUserFavorites();

                        // Load notifications
                        await loadNotifications();
                    }
                } catch (error) {
                    console.error('Auth check failed:', error);
                    localStorage.removeItem('token');
                }
            }

            // Load user favorites
            async function loadUserFavorites() {
                if (!currentUser) return;

                try {
                    const response = await fetch(`${API_BASE_URL}/favorites/user/${currentUser.id}`, {
                        headers: {
                            'Authorization': `Bearer ${localStorage.getItem('token')}`
                        }
                    });

                    if (response.ok) {
                        const favorites = await response.json();
                        state.favorites = favorites.map(fav => fav.vendorProfileID);

                        // Update favorites badge
                        document.querySelectorAll('.badge').forEach(badge => {
                            if (badge.id === 'favorites-badge' || !badge.id) {
                                badge.textContent = state.favorites.length;
                            }
                        });
                    }
                } catch (error) {
                    console.error('Error loading favorites:', error);
                }
            }

            // Load notifications
            async function loadNotifications() {
                if (!currentUser) return;

                try {
                    const response = await fetch(`${API_BASE_URL}/notifications/user/${currentUser.id}?unreadOnly=true`, {
                        headers: {
                            'Authorization': `Bearer ${localStorage.getItem('token')}`
                        }
                    });

                    if (response.ok) {
                        const notifications = await response.json();
                        const unreadCount = notifications.length;

                        // Update notifications badge
                        document.querySelectorAll('.badge').forEach(badge => {
                            if (badge.id === 'notifications-badge' || badge.id === 'dashboard-notifications-badge' || badge.id === 'vendor-notifications-badge' || !badge.id) {
                                badge.textContent = unreadCount;
                            }
                        });
                    }
                } catch (error) {
                    console.error('Error loading notifications:', error);
                }
            }

            // Initialize Stripe
            function initializeStripe() {
                state.stripe = Stripe('pk_test_YOUR_STRIPE_PUBLIC_KEY');
                state.elements = state.stripe.elements();
            }


            // Connect to Socket.IO for chat
            function connectToChat() {
                const token = localStorage.getItem('token');
                if (!token) {
                    console.warn('No token available for chat connection. Chat features may be limited.');
                    return;
                }

                if (state.socket && state.socket.connected) {
                    console.log('Socket already connected.');
                    return;
                }

                console.log('Attempting to connect to chat server...');
                state.socket = io(API_BASE_URL, {
                    auth: { token },
                    transports: ['websocket'],
                    reconnectionAttempts: 5
                });
                
                state.socket.on('connect', () => {
                    console.log('Connected to chat server.');
                    if (currentUser) {
                        state.socket.emit('authenticate', { userId: currentUser.id });
                    }
                });
                
                state.socket.on('new-message', (message) => {
                    console.log('Received new message via Socket.IO:', message);
                    
                    if (!message || !message.ConversationID) {
                        console.error('Invalid message format received:', message);
                        return;
                    }
                    
                    // Only process if it's for the current conversation
                    if (message.ConversationID === state.chat.currentConversation) {
                        const formattedMessage = state.chat.formatMessage(message);
                        state.chat.addMessage(formattedMessage);
                        renderChatMessages();
                    } else {
                        console.log(`Received message for conversation ${message.ConversationID}, but current is ${state.chat.currentConversation}. Not rendering.`);
                    }
                });
                
                state.socket.on('error', (error) => {
                    console.error('Socket error:', error);
                    showChatError('Connection error. Please refresh the page.');
                });
                
                state.socket.on('disconnect', () => {
                    console.log('Disconnected from chat server.');
                    showChatError('Disconnected. Trying to reconnect...');
                });
            }

async function loadInitialMessages() {
                if (!currentUser || !state.chat.currentConversation) {
                    console.warn('Cannot load messages: Missing user or conversation ID.', {
                        user: currentUser,
                        conversation: state.chat.currentConversation
                    });
                    return;
                }
                
                try {
                    console.log(`Loading messages for conversation: ${state.chat.currentConversation} and user: ${currentUser.id}`);
                    const response = await fetch(`${API_BASE_URL}/messages/conversation/${state.chat.currentConversation}?userId=${currentUser.id}`, {
                        headers: {
                            'Authorization': `Bearer ${localStorage.getItem('token')}`
                        }
                    });
                    
                    if (!response.ok) {
                        const errorText = await response.text();
                        throw new Error(`Failed to load messages: ${response.status} ${response.statusText} - ${errorText}`);
                    }
                    
                    const data = await response.json();
                    
                    // The API returns messages directly as an array
                    if (!Array.isArray(data.messages)) {
                        throw new Error('Invalid message data format from API');
                    }
                    
                    state.chat.setMessages(data.messages);
                    renderChatMessages();
                } catch (error) {
                    console.error('Error loading messages:', error);
                    state.chat.setMessages([]); // Clear messages on error
                    renderChatMessages();
                    showChatError('Failed to load messages. Please try again.');
                }
            }


            function setupChatEventListeners(chatInputId, sendButtonId) {
                const chatInput = document.getElementById(chatInputId);
                const sendButton = document.getElementById(sendButtonId);

                if (chatInput && sendButton) {

                    sendButton.removeEventListener('click', sendChatMessage);
                    chatInput.removeEventListener('keypress', handleChatInputKeypress);


                    sendButton.addEventListener('click', sendChatMessage);
                    chatInput.addEventListener('keypress', handleChatInputKeypress);
                    console.log(`Chat event listeners attached for input: ${chatInputId}, button: ${sendButtonId}`);
                } else {
                    console.warn(`Could not find chat elements: Input ID ${chatInputId}, Button ID ${sendButtonId}`);
                }
            }

            function handleChatInputKeypress(e) {
                if (e.key === 'Enter') {
                    sendChatMessage();
                }
            }

async function sendChatMessage() {
                const input = document.getElementById('chat-input') ||
                            document.getElementById('dashboard-chat-input') ||
                            document.getElementById('vendor-chat-input') ||
                            document.getElementById('vendor-all-chat-input') ||
                            document.getElementById('profile-chat-input');
                const message = input?.value.trim();

                console.log('Attempting to send message:', message, 'Current User:', currentUser, 'Current Conversation:', state.chat.currentConversation);

                if (!message) {
                    console.warn('Message is empty.');
                    return;
                }

                if (!currentUser) {
                    alert('Please login to send messages.');
                    profileModal.style.display = 'flex';
                    showLoginView();
                    return;
                }
                
                if (!state.chat.currentChatVendorId) {
                    alert('Could not determine vendor to message. Please try again from a vendor profile.');
                    return;
                }
                
                if (!state.chat.currentConversation) {
                    console.log('No existing conversation found, creating a new one...');
                    try {
                        const createResponse = await fetch(`${API_BASE_URL}/messages/conversation`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${localStorage.getItem('token')}`
                            },
                            body: JSON.stringify({
                                userId: currentUser.id,
                                vendorProfileId: state.chat.currentChatVendorId
                            })
                        });
                        
                        if (!createResponse.ok) {
                             const errorText = await createResponse.text();
                            throw new Error(`Failed to create conversation: ${createResponse.status} ${createResponse.statusText} - ${errorText}`);
                        }
                        
                        const createData = await createResponse.json();
                        state.chat.currentConversation = createData.conversation.ConversationID || createData.conversationId;
                        console.log('New conversation created:', state.chat.currentConversation);
                    } catch (err) {
                        console.error('Failed to create new conversation:', err);
                        showChatError('Failed to start chat. Please try again.');
                        return;
                    }
                }

                try {

                    const tempMessage = {
                        id: `temp-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,
                        conversationId: state.chat.currentConversation,
                        senderId: currentUser.id,
                        senderName: currentUser.name,
                        content: message,
                        timestamp: new Date().toISOString(),
                        isCurrentUser: true,
                        isPending: true
                    };


                    state.chat.addMessage(tempMessage);
                    input.value = '';
                    renderChatMessages();


                    if (state.socket && state.socket.connected) {
                        console.log('Sending message via Socket.IO...');
                        state.socket.emit('send-message', {
                            conversationId: state.chat.currentConversation,
                            senderId: currentUser.id,
                            content: message
                        });
                    } else {
                        console.log('Socket not connected, falling back to HTTP POST...');

                        const response = await fetch(`${API_BASE_URL}/messages`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${localStorage.getItem('token')}`
                            },
                            body: JSON.stringify({
                                conversationId: state.chat.currentConversation,
                                senderId: currentUser.id,
                                content: message
                            })
                        });

                        if (!response.ok) {
                            const errorData = await response.json();
                            throw new Error(errorData.message || 'Failed to send message via HTTP.');
                        }

                        const result = await response.json();
                        console.log('HTTP POST message response:', result);

                        const savedMessage = state.chat.formatMessage(result);


                        state.chat.setMessages(
                            state.chat.getMessages()
                                .filter(m => m.id !== tempMessage.id)
                                .concat([savedMessage])
                        );
                    }

                    renderChatMessages();

                } catch (err) {
                    console.error('Message send failed:', err);

                    state.chat.setMessages(
                        state.chat.getMessages().filter(m => m.id !== tempMessage.id)
                    );
                    renderChatMessages();
                    showChatError('Failed to send message: ' + err.message);
                }
            }

            function renderChatMessages() {
                const chatContainer = document.getElementById('chat-messages') ||
                                    document.getElementById('dashboard-chat-messages') ||
                                    document.getElementById('vendor-chat-messages') ||
                                    document.getElementById('vendor-all-chat-messages') ||
                                    document.getElementById('profile-chat-messages');
                
                if (!chatContainer) {
                    console.warn('Chat container not found for rendering messages.');
                    return;
                }

                chatContainer.innerHTML = '';


                const sortedMessages = [...state.chat.getMessages()].sort((a, b) =>
                    new Date(a.timestamp) - new Date(b.timestamp));


                sortedMessages.forEach(message => {
                    const messageDiv = document.createElement('div');
                    messageDiv.className = `message ${message.senderId === currentUser?.id ? 'sent' : 'received'}`;

                    const messageDate = new Date(message.timestamp);
                    const timeString = messageDate.toLocaleTimeString([], {
                        hour: '2-digit',
                        minute: '2-digit'
                    });


                    const senderInfo = (message.senderId !== currentUser?.id && message.senderName) ?
                        `<div class="message-sender">${message.senderName}</div>` : '';

                    messageDiv.innerHTML = `
                        ${senderInfo}
                        <div class="message-content">${message.content}</div>
                        <div class="message-time">${timeString}</div>
                    `;

                    chatContainer.appendChild(messageDiv);
                });


                chatContainer.scrollTop = chatContainer.scrollHeight;
            }

            // Add this function to load conversations for the dashboard
async function loadConversations(containerId, chatInputId, sendButtonId) {
                if (!currentUser) {
                    console.warn('Cannot load conversations: User not logged in.');
                    return;
                }
                
                try {
                    console.log(`Loading conversations for user: ${currentUser.id}`);
                    const url = currentUser.isVendor ? `${API_BASE_URL}/messages/conversations/vendor/${currentUser.id}` : `${API_BASE_URL}/messages/conversations/user/${currentUser.id}`;
                    const response = await fetch(url, {
                        headers: {
                            'Authorization': `Bearer ${localStorage.getItem('token')}`
                        }
                    });
                    
                    if (!response.ok) {
                        const errorText = await response.text();
                        throw new Error(`Failed to load conversations: ${response.status} ${response.statusText} - ${errorText}`);
                    }
                    
                    const responseData = await response.json();
                    const conversations = responseData.conversations;
                    
                    if (!Array.isArray(conversations)) {
                        throw new Error('Invalid conversations data format from API');
                    }
                    
                    renderConversationsList(conversations, containerId, chatInputId, sendButtonId);
                } catch (error) {
                    console.error('Error loading conversations:', error);
                    const container = document.getElementById(containerId);
                    if (container) {
                        container.innerHTML = `<p style="color:var(--accent);">Failed to load conversations. ${error.message}</p>`;
                    }
                }
            }

            function renderConversationsList(conversations, containerId, chatInputId, sendButtonId) {
                const container = document.getElementById(containerId);
                if (!container) {
                    console.warn('Conversations container not found:', containerId);
                    return;
                }


                container.innerHTML = `
                    <div class="dashboard-card">
                        <h2 class="dashboard-card-title">Messages</h2>
                        <div class="conversations-list" style="max-height: 200px; overflow-y: auto; border-bottom: 1px solid var(--border); margin-bottom: 1rem; padding-bottom: 1rem;">
                            ${conversations.length === 0 ? '<p>No active conversations.</p>' :
                                conversations.map(conv => {
                                    const partnerName = conv.VendorName || conv.UserName || 'Unknown Partner';
                                    const lastMessagePreview = conv.LastMessageContent ? conv.LastMessageContent.substring(0, 50) + (conv.LastMessageContent.length > 50 ? '...' : '') : 'No messages yet.';
                                    const lastMessageTime = conv.LastMessageCreatedAt ? new Date(conv.LastMessageCreatedAt).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) : '';
                                    return `
                                        <div class="conversation-item" data-id="${conv.ConversationID}"
                                             style="padding: 0.75rem; border-bottom: 1px solid #eee; cursor: pointer; display: flex; justify-content: space-between; align-items: center;">
                                            <div>
                                                <div style="font-weight: 600;">${partnerName}</div>
                                                <div style="font-size: 0.9rem; color: var(--text-light);">${lastMessagePreview}</div>
                                            </div>
                                            <div style="font-size: 0.8rem; color: var(--text-light);">${lastMessageTime}</div>
                                        </div>
                                    `;
                                }).join('')
                            }
                        </div>
                        <div class="chat-container" style="height: 300px;">
                            <div class="chat-messages" id="${chatInputId.replace('-input', '-messages')}"></div>
                            <div class="chat-input">
                                <input type="text" placeholder="Type your message..." id="${chatInputId}">
                                <button class="btn btn-primary" id="${sendButtonId}">Send</button>
                            </div>
                        </div>
                    </div>
                `;

                document.querySelectorAll('.conversation-item').forEach(convItem => {
                    convItem.addEventListener('click', () => {
                        const conversationId = parseInt(convItem.dataset.id);
                        state.chat.currentConversation = conversationId;
                        console.log('Selected conversation:', conversationId);
                        loadInitialMessages();
                    });
                });


                setupChatEventListeners(chatInputId, sendButtonId);


                if (conversations.length > 0 && !state.chat.currentConversation) {
                    state.chat.currentConversation = conversations[0].ConversationID;
                    console.log('Defaulting to first conversation:', state.chat.currentConversation);
                    loadInitialMessages();
                } else if (state.chat.currentConversation) {

                    loadInitialMessages();
                }
            }

            function disableChatInput() {
                const chatInput = document.getElementById('chat-input');
                const sendBtn = document.getElementById('send-btn');
                if (chatInput) chatInput.disabled = true;
                if (sendBtn) sendBtn.disabled = true;
                console.log('Chat input and send button disabled.');
            }

            function showChatError(message) {
                const chatMessagesContainer = document.getElementById('chat-messages') ||
                                              document.getElementById('dashboard-chat-messages') ||
                                              document.getElementById('vendor-chat-messages') ||
                                              document.getElementById('vendor-all-chat-messages') ||
                                              document.getElementById('profile-chat-messages');
                if (chatMessagesContainer) {
                    const errorElement = document.createElement('p');
                    errorElement.style.color = 'var(--accent)';
                    errorElement.style.fontSize = '0.8rem';
                    errorElement.textContent = message;
                    chatMessagesContainer.appendChild(errorElement);
                    chatMessagesContainer.scrollTop = chatMessagesContainer.scrollHeight;
                }
                console.error('Chat error displayed:', message);
            }

            async function initializeChat(vendorProfileId, vendorName) {
                if (!currentUser) {
                    showChatError('Please log in to start a chat.');
                    return;
                }
                
                // Set the current chat vendor ID and name
                state.chat.currentChatVendorId = vendorProfileId;
                chatVendorName.textContent = vendorName;
                chatModal.style.display = 'flex';
                document.body.style.overflow = 'hidden';

                console.log(`Initializing chat for vendor: ${vendorProfileId} and user: ${currentUser.id}`);
                state.chat.init();

                try {
                    // Check for an existing conversation
                    const checkResponse = await fetch(`${API_BASE_URL}/messages/conversation/check`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${localStorage.getItem('token')}`
                        },
                        body: JSON.stringify({
                            userId: currentUser.id,
                            vendorProfileId: vendorProfileId
                        })
                    });

                    if (!checkResponse.ok) {
                        const errorText = await checkResponse.text();
                        throw new Error(`Failed to check conversation: ${checkResponse.status} ${checkResponse.statusText} - ${errorText}`);
                    }

                    const checkData = await checkResponse.json();

                    if (checkData.conversationId) {
                        state.chat.currentConversation = checkData.conversationId;
                        console.log('Existing conversation found:', state.chat.currentConversation);
                        await loadInitialMessages();
                    } else {
                        console.log('No existing conversation found. A new one will be created on the first message.');
                        profileChatMessages.innerHTML = '<p style="text-align:center; color: var(--text-light); margin-top: 1rem;">Start a new conversation...</p>';
                    }
                    
                    setupChatEventListeners('profile-chat-input', 'profile-send-btn');
                    
                } catch (error) {
                    console.error('Chat initialization failed:', error);
                    showChatError('Failed to initialize chat: ' + error.message);
                }
            }
            
            // New improved location request function
            function requestLocationWithFeedback() {
                console.log("Attempting to get location...");
                if (!navigator.geolocation) {
                    console.log("Geolocation not supported by this browser");
                    return;
                }

                // Visual feedback
                locationInput.placeholder = "Detecting your location...";

                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        console.log("Location obtained:", position);
                        handleLocationSuccess(position);
                    },
                    (error) => {
                        console.log("Location error:", error);
                        locationInput.placeholder = "City or ZIP code";

                        if (error.code === error.PERMISSION_DENIED) {
                            // Only show modal if this is a fresh page load
                            if (!sessionStorage.getItem('locationRequested')) {
                                locationPermissionModal.style.display = 'flex';
                                sessionStorage.setItem('locationRequested', 'true');
                            }
                        }
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 0
                    }
                );
            }

            // Modified location success handler
            function handleLocationSuccess(position) {
                state.userLocation = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                };

                // Update UI
                currentLocationCheckbox.checked = true;
                document.getElementById('within50').checked = true;
                locationInput.value = "Near You";
                locationInput.placeholder = "Near You";

                filterVendors();

                if (state.map) {
                    centerMapOnUser();
                }
            }

            // Google Maps initialization
            function initMap() {
                if (typeof google === 'undefined' || typeof google.maps === 'undefined') {
                    console.error('Google Maps API not loaded.');
                    document.getElementById('map').innerHTML = '<p style="text-align:center; padding: 2rem; color: var(--accent);">Map could not be loaded. Please check your connection and API key.</p>';
                    return;
                }

                if (state.filteredVendors.length === 0) return;

                // Default to first vendor's location or user location if available
                const center = state.userLocation ||
                               { lat: state.filteredVendors[0].coordinates.lat,
                                 lng: state.filteredVendors[0].coordinates.lng };

                // Create map
                state.map = new google.maps.Map(document.getElementById("map"), {
                    zoom: 12,
                    center: center,
                    styles: [
                        {
                            "featureType": "poi",
                            "stylers": [
                                { "visibility": "off" }
                            ]
                        }
                    ]
                });

                // Add markers
                updateMapMarkers();

                // Center map on user location if available
                if (state.userLocation) {
                    centerMapOnUser();
                }
            }

            // Helper function to generate random coordinates (for demo)
            function getRandomLat() { return 34.0522 + (Math.random() * 0.2 - 0.1); }
            function getRandomLng() { return -118.2437 + (Math.random() * 0.2 - 0.1); }

            // Helper function to generate random price level (for demo)
            function getRandomPriceLevel() {
                const levels = ['$', '$$', '$$$'];
                return levels[Math.floor(Math.random() * levels.length)];
            }

            // Setup all event listeners
            function setupEventListeners() {
                // View toggle buttons
                document.getElementById('list-view-btn').addEventListener('click', () => {
                    state.currentView = 'list';
                    mapViewContainer.style.display = 'none';
                    vendorGrid.style.display = 'grid';
                    document.getElementById('list-view-btn').classList.add('active');
                    document.getElementById('map-view-btn').classList.remove('active');
                });

                document.getElementById('map-view-btn').addEventListener('click', () => {
                    state.currentView = 'map';
                    mapViewContainer.style.display = 'flex';
                    vendorGrid.style.display = 'none';
                    document.getElementById('map-view-btn').classList.add('active');
                    document.getElementById('list-view-btn').classList.remove('active');
                    
                    // Initialize map if it hasn't been already
                    if (!state.map) {
                        initMap();
                    }
                });

            // Search
            searchInput.addEventListener('input', filterVendors);

            // Make search icon clickable to focus input
            const searchButton = document.getElementById('search-button');
            if (searchButton) {
                searchButton.addEventListener('click', () => {
                    searchInput.focus();
                });
            }

            // Sorting
            sortSelect.addEventListener('change', sortVendors);

                // Filter resets
                filterResetBtns.forEach(btn => {
                    btn.addEventListener('click', () => {
                        const filterType = btn.id.replace('-reset', '');
                        resetFilter(filterType);
                    });
                });

                // Filter inputs
                document.querySelectorAll('.filter-section input').forEach(input => {
                    input.addEventListener('change', filterVendors);
                });

                // Current location checkbox
                currentLocationCheckbox.addEventListener('change', function() {
                    if (this.checked) {
                        requestLocationWithFeedback();
                    } else {
                        state.userLocation = null;
                        locationInput.value = '';
                        locationInput.placeholder = 'City or ZIP code';
                        filterVendors();
                    }
                });

                // Popular filters
                trendingTags.forEach(tag => {
                    tag.addEventListener('click', () => {
                        tag.classList.toggle('active');
                        const filter = tag.dataset.filter;

                        if (tag.classList.contains('active')) {
                            if (!state.filters.popular.includes(filter)) {
                                state.filters.popular.push(filter);
                            }
                        } else {
                            state.filters.popular = state.filters.popular.filter(f => f !== filter);
                        }

                        filterVendors();
                    });
                });

                // Advanced filters toggle
                advancedToggle.addEventListener('click', () => {
                    advancedContent.classList.toggle('show');
                    advancedToggle.querySelector('span').textContent =
                        advancedContent.classList.contains('show') ? '' : '+';
                });

                // Date filters
                document.getElementById('start-date').addEventListener('change', function() {
                    state.filters.startDate = this.value;
                    filterVendors();
                });

                document.getElementById('end-date').addEventListener('change', function() {
                    state.filters.endDate = this.value;
                    filterVendors();
                });

                // Region filter
                document.getElementById('region-select').addEventListener('change', function() {
                    state.filters.region = this.value;
                    filterVendors();
                });

                // Pagination
                prevPageBtn.addEventListener('click', () => {
                    if (state.currentPage > 1) {
                        state.currentPage--;
                        renderVendors();
                    }
                });

                nextPageBtn.addEventListener('click', () => {
                    const totalPages = Math.ceil(state.filteredVendors.length / state.itemsPerPage);
                    if (state.currentPage < totalPages) {
                        state.currentPage++;
                        renderVendors();
                    }
                });

                // User nav buttons
                wishlistBtn.addEventListener('click', () => {
                    if (currentUser) {
                        displayUserDashboard('client', 'favorites');
                    } else {
                        profileModal.style.display = 'flex';
                    }
                });

                notificationsBtn.addEventListener('click', () => {
                    if (currentUser) {
                        displayUserDashboard('client', 'dashboard');
                    } else {
                        profileModal.style.display = 'flex';
                    }
                });

            // Profile button click handler
            profileBtn.addEventListener('click', () => {
                if (currentUser) {
                    showLoggedInView();
                } else {
                    showLoginView();
                }
                profileModal.style.display = 'flex';
            });

            // Logo click navigates to main page
            const logo = document.querySelector('.logo');
            if (logo) {
                logo.addEventListener('click', () => {
                    window.location.hash = '';
                    showMainApp();
                });
            }

                // Generic close modal buttons (for all modals)
                document.querySelectorAll('.close-modal').forEach(closeBtn => {
                    closeBtn.addEventListener('click', function() {
                        this.closest('.modal').style.display = 'none';
                        document.body.style.overflow = 'auto';
                    });
                });

                // Generic close modals when clicking outside the content (for all modals)
                document.querySelectorAll('.modal').forEach(m => {
                    const oldListener = m.__overlayClickListener;
                    if (oldListener) {
                        m.removeEventListener('click', oldListener);
                    }

                    const newListener = (e) => {
                        if (e.target === m) {
                            m.style.display = 'none';
                            document.body.style.overflow = 'auto';
                        }
                    };
                    m.addEventListener('click', newListener);
                    m.__overlayClickListener = newListener;
                });

                // Add an event listener for hash changes
                window.addEventListener('hashchange', handleUrlChange);

                // Toggle between login and signup forms
                showSignup.addEventListener('click', (e) => {
                    e.preventDefault();
                    showSignupView();
                });

                showLogin.addEventListener('click', (e) => {
                    e.preventDefault();
                    showLoginView();
                });

                // Login with email/password
                loginBtn.addEventListener('click', async () => {
                    const email = document.getElementById('login-email').value;
                    const password = document.getElementById('login-password').value;

                    if (!email || !password) {
                        alert('Please enter both email and password');
                        return;
                    }

                    try {
                        const response = await fetch(`${API_BASE_URL}/users/login`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({ email, password }),
                        });

                        if (!response.ok) {
                            const errorData = await response.json();
                            throw new Error(errorData.message || 'Login failed');
                        }

                        const userData = await response.json();

                        // Store the token in localStorage
                        localStorage.setItem('token', userData.token);

                        // Update UI with user data
                        simulateLogin({
                            id: userData.userId,
                            name: userData.name || userData.email.split('@')[0],
                            email: userData.email,
                            avatar: userData.name ? userData.name[0].toUpperCase() : userData.email[0].toUpperCase(),
                            isVendor: userData.isVendor || false
                        });

                        // Connect to chat after login
                        connectToChat();
                    } catch (error) {
                        console.error('Login error:', error);
                        alert('Login failed. ' + error.message);
                    }
                });

                // Sign up with email/password
                signupBtn.addEventListener('click', async () => {
                    const name = document.getElementById('signup-name').value;
                    const email = document.getElementById('signup-email').value;
                    const password = document.getElementById('signup-password').value;
                    const accountType = document.getElementById('account-type').value;

                    if (!name || !email || !password) {
                        alert('Please fill in all fields');
                        return;
                    }

                    if (password.length < 8) {
                        alert('Password should be at least 8 characters');
                        return;
                    }

                    try {
                        const response = await fetch(`${API_BASE_URL}/users/register`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                name,
                                email,
                                password,
                                isVendor: accountType === 'vendor'
                            }),
                        });

                        if (!response.ok) {
                            const errorData = await response.json();
                            throw new Error(errorData.message || 'Signup failed');
                        }

                        const userData = await response.json();

                        // Store the token
                        localStorage.setItem('token', userData.token);

                        // Update user object and UI
                        currentUser = {
                            id: userData.userId,
                            name: userData.name,
                            email: userData.email,
                            avatar: userData.name[0].toUpperCase(),
                            isVendor: userData.isVendor || false
                        };
                        showLoggedInView();
                        profileModal.style.display = 'none';
                        alert(`Welcome, ${currentUser.name}! You are now logged in.`);

                        // Connect to chat after signup
                        connectToChat();

                        // If signing up as vendor, show setup wizard
                        if (accountType === 'vendor') {
                            initializeVendorSetup(currentUser.id);
                        }
                    } catch (error) {
                        console.error('Signup error:', error);
                        alert('Signup failed. ' + error.message);
                    }
                });

                // Google Login Handler
                googleLoginBtn.addEventListener('click', () => {
                    google.accounts.id.initialize({
                        client_id: '900405597637-50g402qo0kbh2msi9bqii8e9od6oq0fk.apps.googleusercontent.com',
                        callback: handleGoogleSignIn
                    });
                    google.accounts.id.prompt();
                });

                // Facebook Login Handler
                facebookLoginBtn.addEventListener('click', () => {
                    FB.login(function(response) {
                        if (response.authResponse) {
                            fetch(`${API_BASE_URL}/users/social-login`, {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                                body: JSON.stringify({
                                  email: 'mock-facebook-email@example.com',
                                  name: 'Mock Facebook User',
                                  authProvider: 'facebook',
                                  avatar: 'M'
                                }),
                            })
                            .then(response => response.json())
                            .then(data => {
                                if (data.token) {
                                    localStorage.setItem('token', data.token);
                                    simulateLogin({
                                        id: data.userId,
                                        name: data.name,
                                        email: data.email,
                                        avatar: data.name[0].toUpperCase(),
                                        isVendor: data.isVendor || false
                                    });
                                    connectToChat();
                                    promptForAccountType(data.userId);
                                }
                            })
                            .catch(error => {
                                console.error('Facebook login error:', error);
                                alert('Facebook login failed. Please try again.');
                            });
                        }
                    }, {scope: 'public_profile,email'});
                });

                // Logout handler
                logoutBtn.addEventListener('click', () => {
                    // Clear the token from storage
                    localStorage.removeItem('token');
                    localStorage.removeItem('isVendorMode');
                    localStorage.removeItem('activeDashboardSection');

                    // Disconnect from chat
                    if (state.socket) {
                        state.socket.disconnect();
                    }

                    currentUser = null;
                    showLoginView();
                    alert('You have been logged out');

                    // Reset profile button
                    profileBtn.textContent = '';
                    profileBtn.style.backgroundColor = '';
                    profileBtn.style.color = '';
                    profileBtn.style.borderRadius = '';
                    profileBtn.style.width = '';
                    profileBtn.style.height = '';
                    profileBtn.style.display = '';
                    profileBtn.style.alignItems = '';
                    profileBtn.style.justifyContent = '';

                    showMainApp();
                });

                // View dashboard button
                viewDashboardBtn.addEventListener('click', () => {
                    profileModal.style.display = 'none';
                    const initialSection = currentUser.isVendor ? 'vendor-dashboard' : 'dashboard';
                    displayUserDashboard(currentUser.isVendor ? 'vendor' : 'client', activeDashboardSection || initialSection);
                });

                // Dashboard menu items (both client and vendor)
                clientDashboardMenuItems.forEach(item => {
                    item.addEventListener('click', (e) => {
                        e.preventDefault();
                        const section = item.dataset.section;
                        displayUserDashboard('client', section);
                    });
                });

                vendorDashboardMenuItems.forEach(item => {
                    item.addEventListener('click', (e) => {
                        e.preventDefault();
                        const section = item.dataset.section;
                        displayUserDashboard('vendor', section);
                    });
                });

                // Switch to vendor mode
                switchToVendorBtn.addEventListener('click', async (e) => {
                    e.preventDefault();
                    if (currentUser.isVendor) {
                        displayUserDashboard('vendor', 'vendor-dashboard');
                    } else {
                        // Check if user has a vendor profile
                        try {
                            const response = await fetch(`${API_BASE_URL}/vendors/status?userId=${currentUser.id}`, {
                                headers: {
                                    'Authorization': `Bearer ${localStorage.getItem('token')}`
                                }
                            });
                            const data = await response.json();
                            if (data.isVendor && data.isProfileComplete) {
                                // User is a vendor and profile is complete
                                currentUser.isVendor = true;
                                displayUserDashboard('vendor', 'vendor-dashboard');
                        } else {
                            // User is not a vendor or profile is incomplete, show setup wizard
                            initializeVendorSetup(currentUser.id);
                        }
                        } catch (error) {
                            console.error('Error checking vendor status:', error);
                            alert('Failed to check vendor status. Please try again.');
                        }
                    }
                });

                // Switch to client mode
                switchToClientBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    displayUserDashboard('client', 'dashboard');
                });

                // Logout from dashboard
                logoutDashboardBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    logoutBtn.click();
                });

                // Logout from vendor dashboard
                vendorLogoutBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    logoutBtn.click();
                });

                // Vendor registration form steps
                document.querySelectorAll('.next-step').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const currentStep = btn.closest('.form-section');
                        const nextStepId = `reg-step-${btn.dataset.step}`;
                        const nextStep = document.getElementById(nextStepId);

                        if (validateStep(currentStep.id)) {
                            currentStep.style.display = 'none';
                            nextStep.style.display = 'block';
                            updateRegistrationStatus(btn.dataset.step);
                        } else {
                            alert('Please fill out all required fields.');
                        }
                    });
                });

                document.querySelectorAll('.prev-step').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const currentStep = btn.closest('.form-section');
                        const prevStepId = `reg-step-${btn.dataset.step}`;
                        const prevStep = document.getElementById(prevStepId);

                        currentStep.style.display = 'none';
                        prevStep.style.display = 'block';
                        updateRegistrationStatus(btn.dataset.step);
                    });
                });


                // Map controls
                document.getElementById('zoom-in')?.addEventListener('click', () => {
                    if (state.map) {
                        state.map.setZoom(state.map.getZoom() + 1);
                    }
                });

                document.getElementById('zoom-out')?.addEventListener('click', () => {
                    if (state.map) {
                        state.map.setZoom(state.map.getZoom() - 1);
                    }
                });

                locateMeBtn?.addEventListener('click', () => {
                    if (state.userLocation) {
                        centerMapOnUser();
                    } else {
                        requestLocationWithFeedback();
                    }
                });

                // Location permission
                allowLocationBtn.addEventListener('click', () => {
                    locationLoading.style.display = 'inline-block';
                    allowLocationBtn.disabled = true;

                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            locationPermissionModal.style.display = 'none';
                            handleLocationSuccess(position);
                            locationLoading.style.display = 'none';
                            allowLocationBtn.disabled = false;
                        },
                        (error) => {
                            console.log("Location error:", error);
                            locationPermissionModal.style.display = 'none';
                            locationLoading.style.display = 'none';
                            allowLocationBtn.disabled = false;
                            currentLocationCheckbox.checked = false;
                            alert("Could not get your location. Please try again or enter a location manually.");
                        },
                        {
                            enableHighAccuracy: true,
                            timeout: 10000
                        }
                    );
                });

                denyLocationBtn.addEventListener('click', () => {
                    locationPermissionModal.style.display = 'none';
                    currentLocationCheckbox.checked = false;
                });

                // Confirmation modal
                document.getElementById('conf-done-btn').addEventListener('click', () => {
                    confirmationModal.style.display = 'none';
                });

                // Category scroll buttons
                if (scrollLeftBtn && scrollRightBtn && categoriesListWrapper) {
                    scrollLeftBtn.addEventListener('click', () => {
                        categoriesListWrapper.scrollBy({
                            left: -200,
                            behavior: 'smooth'
                        });
                    });

                    scrollRightBtn.addEventListener('click', () => {
                        categoriesListWrapper.scrollBy({
                            left: 200,
                            behavior: 'smooth'
                        });
                    });
                }
            }

            // Comprehensive Vendor Setup Wizard State
            let vendorSetupState = {
                currentStep: 1,
                vendorId: null,
                stepData: {
                    step1: {}, // Business Basics
                    step2: {}, // Location Information
                    step3: {}, // Gallery & Media
                    step4: {}, // Services & Packages
                    step5: {}, // Team Information
                    step6: {}, // Social Media & Links
                    step7: {}, // Availability & Scheduling
                    step8: {}, // Policies & Preferences
                    step9: {}, // Verification & Legal
                    step10: {} // Setup Completion
                },
                gallery: [],
                portfolio: [],
                packages: [],
                services: [],
                teamMembers: [],
                faqs: []
            };

            // Initialize Vendor Setup
            function initializeVendorSetup(vendorId) {
                vendorSetupState.vendorId = vendorId;
                vendorSetupState.currentStep = 1;
                
                // Reset all data
                Object.keys(vendorSetupState.stepData).forEach(key => {
                    vendorSetupState.stepData[key] = {};
                });
                vendorSetupState.gallery = [];
                vendorSetupState.portfolio = [];
                vendorSetupState.packages = [];
                vendorSetupState.services = [];
                vendorSetupState.teamMembers = [];
                vendorSetupState.faqs = [];
                
                // Show the setup modal
                vendorRegistrationModal.style.display = 'flex';
                document.body.style.overflow = 'hidden';
                
                // Setup event listeners
                setupVendorSetupEventListeners();
                
                // Show first step
                showSetupStep(1);
            }

            // Setup Event Listeners for All 10 Steps
            function setupVendorSetupEventListeners() {
                // Navigation buttons - Forward
                document.getElementById('next-to-step-2')?.addEventListener('click', () => goToSetupStep(2));
                document.getElementById('next-to-step-3')?.addEventListener('click', () => goToSetupStep(3));
                document.getElementById('next-to-step-4')?.addEventListener('click', () => goToSetupStep(4));
                document.getElementById('next-to-step-5')?.addEventListener('click', () => goToSetupStep(5));
                document.getElementById('next-to-step-6')?.addEventListener('click', () => goToSetupStep(6));
                document.getElementById('next-to-step-7')?.addEventListener('click', () => goToSetupStep(7));
                document.getElementById('next-to-step-8')?.addEventListener('click', () => goToSetupStep(8));
                document.getElementById('next-to-step-9')?.addEventListener('click', () => goToSetupStep(9));
                document.getElementById('next-to-step-10')?.addEventListener('click', () => goToSetupStep(10));
                
                // Navigation buttons - Backward
                document.getElementById('back-to-step-1')?.addEventListener('click', () => goToSetupStep(1));
                document.getElementById('back-to-step-2')?.addEventListener('click', () => goToSetupStep(2));
                document.getElementById('back-to-step-3')?.addEventListener('click', () => goToSetupStep(3));
                document.getElementById('back-to-step-4')?.addEventListener('click', () => goToSetupStep(4));
                document.getElementById('back-to-step-5')?.addEventListener('click', () => goToSetupStep(5));
                document.getElementById('back-to-step-6')?.addEventListener('click', () => goToSetupStep(6));
                document.getElementById('back-to-step-7')?.addEventListener('click', () => goToSetupStep(7));
                document.getElementById('back-to-step-8')?.addEventListener('click', () => goToSetupStep(8));
                document.getElementById('back-to-step-9')?.addEventListener('click', () => goToSetupStep(9));
                
                // Step 3: Gallery & Media functionality
                document.getElementById('featured-image')?.addEventListener('change', handleFeaturedImageUpload);
                document.getElementById('gallery-images')?.addEventListener('change', handleGalleryUpload);
                document.getElementById('add-portfolio-btn')?.addEventListener('click', showPortfolioForm);
                document.getElementById('add-portfolio-item-btn')?.addEventListener('click', addPortfolioItem);
                
                // Step 4: Services & Packages functionality
                document.getElementById('add-service-category-btn')?.addEventListener('click', showServiceCategoryForm);
                document.getElementById('add-category-item-btn')?.addEventListener('click', addServiceCategory);
                document.getElementById('add-service-btn')?.addEventListener('click', showServiceForm);
                document.getElementById('add-service-item-btn')?.addEventListener('click', addServiceItem);
                document.getElementById('add-package-btn')?.addEventListener('click', showPackageForm);
                document.getElementById('add-package-item-btn')?.addEventListener('click', addPackageItem);
                
                // Step 5: Team functionality
                document.getElementById('add-team-member-btn')?.addEventListener('click', showTeamMemberForm);
                document.getElementById('add-team-item-btn')?.addEventListener('click', addTeamMember);
                
                // Step 10: FAQ functionality
                document.getElementById('add-faq-btn')?.addEventListener('click', showFaqForm);
                document.getElementById('add-faq-item-btn')?.addEventListener('click', addFaqItem);
                
                // Complete setup
                document.getElementById('complete-setup-btn')?.addEventListener('click', completeVendorSetup);
            }

            // Navigation Functions
            async function goToSetupStep(step) {
                // Validate current step before proceeding
                if (!validateCurrentStep()) {
                    return;
                }
                
                // Save current step data
                saveCurrentStepData();
                
                // Submit current step data to backend
                try {
                    await submitCurrentStepToBackend();
                } catch (error) {
                    console.error('Failed to save step data:', error);
                    alert('Failed to save step data. Please try again.');
                    return;
                }
                
                // Update step
                vendorSetupState.currentStep = step;
                showSetupStep(step);
            }

            function showSetupStep(step) {
                // Hide all steps
                document.querySelectorAll('.setup-step').forEach(stepEl => {
                    stepEl.style.display = 'none';
                });
                
                // Show current step
                const currentStepEl = document.getElementById(`setup-step-${step}`);
                if (currentStepEl) {
                    currentStepEl.style.display = 'block';
                }
                
                // Update progress bar (10 steps total)
                const progressBar = document.getElementById('setup-progress-bar');
                if (progressBar) {
                    progressBar.style.width = `${(step / 10) * 100}%`;
                }
                
                // Update step indicators
                document.querySelectorAll('.step-indicator').forEach((indicator, index) => {
                    indicator.classList.remove('active', 'completed');
                    if (index + 1 === step) {
                        indicator.classList.add('active');
                    } else if (index + 1 < step) {
                        indicator.classList.add('completed');
                    }
                });
            }

            // Validation Functions
            function validateCurrentStep() {
                const step = vendorSetupState.currentStep;
                
                switch(step) {
                    case 1: // Business Basics
                        const businessName = document.getElementById('business-name')?.value;
                        const businessDescription = document.getElementById('business-description')?.value;
                        if (!businessName || !businessDescription) {
                            alert('Please fill in all required fields for Business Basics.');
                            return false;
                        }
                        break;
                    case 2: // Location Information
                        const address = document.getElementById('business-address')?.value;
                        if (!address) {
                            alert('Please provide your business address.');
                            return false;
                        }
                        break;
                    // Add more validation as needed
                }
                return true;
            }

            // Data Collection Functions
            function saveCurrentStepData() {
                const step = vendorSetupState.currentStep;
                
                switch(step) {
                    case 1: // Business Basics
                        vendorSetupState.stepData.step1 = {
                            businessName: document.getElementById('business-name')?.value || '',
                            businessDescription: document.getElementById('business-description')?.value || '',
                            businessType: document.getElementById('business-type')?.value || '',
                            yearsInBusiness: document.getElementById('years-in-business')?.value || '',
                            categories: Array.from(document.querySelectorAll('input[name="vendor-categories"]:checked')).map(cb => cb.value)
                        };
                        break;
                    case 2: // Location Information
                        vendorSetupState.stepData.step2 = {
                            address: document.getElementById('business-address')?.value || '',
                            city: document.getElementById('business-city')?.value || '',
                            state: document.getElementById('business-state')?.value || '',
                            zipCode: document.getElementById('business-zip')?.value || '',
                            serviceRadius: document.getElementById('service-radius')?.value || '',
                            serviceAreas: document.getElementById('service-areas')?.value || ''
                        };
                        break;
                    case 6: // Social Media & Links
                        vendorSetupState.stepData.step6 = {
                            website: document.getElementById('business-website')?.value || '',
                            facebook: document.getElementById('social-facebook')?.value || '',
                            instagram: document.getElementById('social-instagram')?.value || '',
                            twitter: document.getElementById('social-twitter')?.value || '',
                            linkedin: document.getElementById('social-linkedin')?.value || '',
                            youtube: document.getElementById('social-youtube')?.value || '',
                            tiktok: document.getElementById('social-tiktok')?.value || ''
                        };
                        break;
                    case 7: // Availability & Scheduling
                        const businessHours = [];
                        const days = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'];
                        days.forEach((day, index) => {
                            const available = document.getElementById(`available-${index}`)?.checked || false;
                            const openTime = document.getElementById(`${day}-open`)?.value || '';
                            const closeTime = document.getElementById(`${day}-close`)?.value || '';
                            if (available && openTime && closeTime) {
                                businessHours.push({
                                    dayOfWeek: index,
                                    openTime,
                                    closeTime,
                                    isAvailable: true
                                });
                            }
                        });
                        
                        vendorSetupState.stepData.step7 = {
                            businessHours,
                            acceptingBookings: document.getElementById('accepting-bookings')?.checked || false,
                            responseTime: document.getElementById('response-time')?.value || '24',
                            bufferTime: document.getElementById('buffer-time')?.value || '30'
                        };
                        break;
                    case 8: // Policies & Preferences
                        const paymentMethods = [];
                        ['cash', 'check', 'credit', 'debit', 'paypal', 'venmo', 'zelle', 'bank'].forEach(method => {
                            if (document.getElementById(`payment-${method}`)?.checked) {
                                paymentMethods.push(method);
                            }
                        });
                        
                        vendorSetupState.stepData.step8 = {
                            depositRequirements: document.getElementById('deposit-requirements')?.value || '',
                            cancellationPolicy: document.getElementById('cancellation-policy')?.value || '',
                            reschedulingPolicy: document.getElementById('rescheduling-policy')?.value || '',
                            paymentMethods,
                            paymentTerms: document.getElementById('payment-terms')?.value || ''
                        };
                        break;
                    case 9: // Verification & Legal
                        vendorSetupState.stepData.step9 = {
                            licenseNumber: document.getElementById('license-number')?.value || '',
                            insuranceVerified: document.getElementById('insurance-verified')?.checked || false,
                            awardsCertifications: document.getElementById('awards-certifications')?.value || '',
                            ecoFriendly: document.getElementById('eco-friendly')?.checked || false,
                            premiumStatus: document.getElementById('premium-status')?.checked || false
                        };
                        break;
                }
            }

            // Cloudinary Upload Function
            async function uploadImageToCloudinary(file, imageType) {
                const formData = new FormData();
                formData.append('image', file);
                formData.append('imageType', imageType);
                
                try {
                    console.log(`Uploading ${imageType} image to Cloudinary:`, file.name);
                    
                    const response = await fetch(`${API_BASE_URL}/upload/image`, {
                        method: 'POST',
                        body: formData
                    });
                    
                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.message || 'Upload failed');
                    }
                    
                    const result = await response.json();
                    console.log('Cloudinary upload successful:', result);
                    
                    // Return the secure URL from Cloudinary
                    return result.secure_url || result.url;
                    
                } catch (error) {
                    console.error('Cloudinary upload error:', error);
                    throw new Error(`Failed to upload ${imageType} image: ${error.message}`);
                }
            }

            // Gallery & Media Functions
            async function handleFeaturedImageUpload(event) {
                const file = event.target.files[0];
                if (file) {
                    try {
                        console.log('Uploading featured image to Cloudinary...');
                        const uploadedUrl = await uploadImageToCloudinary(file, 'featured');
                        vendorSetupState.stepData.step3 = {
                            ...vendorSetupState.stepData.step3,
                            featuredImage: uploadedUrl
                        };
                        console.log('Featured image uploaded:', uploadedUrl);
                    } catch (error) {
                        console.error('Failed to upload featured image:', error);
                        alert('Failed to upload featured image. Please try again.');
                    }
                }
            }

            async function handleGalleryUpload(event) {
                const files = event.target.files;
                for (const file of files) {
                    try {
                        console.log('Uploading gallery image to Cloudinary:', file.name);
                        const uploadedUrl = await uploadImageToCloudinary(file, 'gallery');
                        vendorSetupState.gallery.push({
                            url: uploadedUrl,
                            type: 'upload',
                            caption: file.name
                        });
                        updateGalleryDisplay();
                        console.log('Gallery image uploaded:', uploadedUrl);
                    } catch (error) {
                        console.error('Failed to upload gallery image:', error);
                        alert(`Failed to upload ${file.name}. Please try again.`);
                    }
                }
            }

            function showPortfolioForm() {
                document.getElementById('portfolio-form').style.display = 'block';
            }

            async function addPortfolioItem() {
                const title = document.getElementById('portfolio-title')?.value;
                const description = document.getElementById('portfolio-description')?.value;
                const imageFile = document.getElementById('portfolio-image')?.files[0];
                
                if (title && description) {
                    const portfolioItem = { title, description };
                    
                    if (imageFile) {
                        try {
                            console.log('Uploading portfolio image to Cloudinary:', imageFile.name);
                            portfolioItem.imageUrl = await uploadImageToCloudinary(imageFile, 'portfolio');
                            console.log('Portfolio image uploaded:', portfolioItem.imageUrl);
                        } catch (error) {
                            console.error('Failed to upload portfolio image:', error);
                            alert('Failed to upload portfolio image. Please try again.');
                            return;
                        }
                    }
                    
                    if (imageFile) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            portfolioItem.image = e.target.result;
                            vendorSetupState.portfolio.push(portfolioItem);
                            updatePortfolioDisplay();
                            clearPortfolioForm();
                        };
                        reader.readAsDataURL(imageFile);
                    } else {
                        vendorSetupState.portfolio.push(portfolioItem);
                        updatePortfolioDisplay();
                        clearPortfolioForm();
                    }
                }
            }

            // Services & Packages Functions
            function showServiceCategoryForm() {
                document.getElementById('service-category-form').style.display = 'block';
            }

            function addServiceCategory() {
                const name = document.getElementById('category-name')?.value;
                const description = document.getElementById('category-description')?.value;
                
                if (name) {
                    if (!vendorSetupState.serviceCategories) {
                        vendorSetupState.serviceCategories = [];
                    }
                    vendorSetupState.serviceCategories.push({
                        name, 
                        description: description || ''
                    });
                    updateServiceCategoriesDisplay();
                    clearServiceCategoryForm();
                    document.getElementById('service-category-form').style.display = 'none';
                }
            }

            function showServiceForm() {
                document.getElementById('service-form').style.display = 'block';
            }

            function addServiceItem() {
                const name = document.getElementById('service-name')?.value;
                const description = document.getElementById('service-description')?.value;
                const price = document.getElementById('service-price')?.value;
                const duration = document.getElementById('service-duration')?.value;
                
                if (name && description && price) {
                    vendorSetupState.services.push({
                        name, description, price: parseFloat(price), duration
                    });
                    updateServicesDisplay();
                    clearServiceForm();
                }
            }

            function showPackageForm() {
                document.getElementById('package-form').style.display = 'block';
            }

            function addPackageItem() {
                const name = document.getElementById('package-name')?.value;
                const description = document.getElementById('package-description')?.value;
                const price = document.getElementById('package-price')?.value;
                const includes = document.getElementById('package-includes')?.value;
                
                if (name && description && price) {
                    vendorSetupState.packages.push({
                        name, description, price: parseFloat(price), includes
                    });
                    updatePackagesDisplay();
                    clearPackageForm();
                }
            }

            // Team Functions
            function showTeamMemberForm() {
                document.getElementById('team-form').style.display = 'block';
            }

            function addTeamMember() {
                const name = document.getElementById('team-name')?.value;
                const role = document.getElementById('team-role')?.value;
                const bio = document.getElementById('team-bio')?.value;
                const photoFile = document.getElementById('team-photo')?.files[0];
                
                if (name && role) {
                    const teamMember = { name, role, bio };
                    
                    if (photoFile) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            teamMember.photo = e.target.result;
                            vendorSetupState.teamMembers.push(teamMember);
                            updateTeamDisplay();
                            clearTeamForm();
                        };
                        reader.readAsDataURL(photoFile);
                    } else {
                        vendorSetupState.teamMembers.push(teamMember);
                        updateTeamDisplay();
                        clearTeamForm();
                    }
                }
            }

            // FAQ Functions
            function showFaqForm() {
                document.getElementById('faq-form').style.display = 'block';
            }

            function addFaqItem() {
                const question = document.getElementById('faq-question')?.value;
                const answer = document.getElementById('faq-answer')?.value;
                
                if (question && answer) {
                    vendorSetupState.faqs.push({ question, answer });
                    updateFaqDisplay();
                    clearFaqForm();
                }
            }

            // Display Update Functions
            function updateGalleryDisplay() {
                // Update gallery preview
                console.log('Gallery updated:', vendorSetupState.gallery);
            }

            function updatePortfolioDisplay() {
                const container = document.getElementById('portfolio-list');
                if (container) {
                    container.innerHTML = vendorSetupState.portfolio.map((item, index) => `
                        <div class="portfolio-item">
                            <strong>${item.title}</strong>
                            <p>${item.description}</p>
                            <button onclick="removePortfolioItem(${index})">Remove</button>
                        </div>
                    `).join('');
                }
            }

            function updateServiceCategoriesDisplay() {
                const container = document.getElementById('service-categories-list');
                if (container && vendorSetupState.serviceCategories) {
                    container.innerHTML = vendorSetupState.serviceCategories.map((category, index) => `
                        <div class="service-category-item">
                            <strong>${category.name}</strong>
                            <p>${category.description}</p>
                            <button onclick="removeServiceCategory(${index})">Remove</button>
                        </div>
                    `).join('');
                }
            }

            function updateServicesDisplay() {
                const container = document.getElementById('services-list');
                if (container) {
                    container.innerHTML = vendorSetupState.services.map((service, index) => `
                        <div class="service-item">
                            <strong>${service.name}</strong> - $${service.price}
                            <p>${service.description}</p>
                            <button onclick="removeService(${index})">Remove</button>
                        </div>
                    `).join('');
                }
            }

            function updatePackagesDisplay() {
                const container = document.getElementById('packages-list');
                if (container) {
                    container.innerHTML = vendorSetupState.packages.map((pkg, index) => `
                        <div class="package-item">
                            <strong>${pkg.name}</strong> - $${pkg.price}
                            <p>${pkg.description}</p>
                            <button onclick="removePackage(${index})">Remove</button>
                        </div>
                    `).join('');
                }
            }

            function updateTeamDisplay() {
                const container = document.getElementById('team-list');
                if (container) {
                    container.innerHTML = vendorSetupState.teamMembers.map((member, index) => `
                        <div class="team-item">
                            <strong>${member.name}</strong> - ${member.role}
                            <p>${member.bio}</p>
                            <button onclick="removeTeamMember(${index})">Remove</button>
                        </div>
                    `).join('');
                }
            }

            function updateFaqDisplay() {
                const container = document.getElementById('faqs-list');
                if (container) {
                    container.innerHTML = vendorSetupState.faqs.map((faq, index) => `
                        <div class="faq-item">
                            <strong>Q: ${faq.question}</strong>
                            <p>A: ${faq.answer}</p>
                            <button onclick="removeFaq(${index})">Remove</button>
                        </div>
                    `).join('');
                }
            }

            // Clear Form Functions
            function clearPortfolioForm() {
                document.getElementById('portfolio-title').value = '';
                document.getElementById('portfolio-description').value = '';
                document.getElementById('portfolio-image').value = '';
                document.getElementById('portfolio-form').style.display = 'none';
            }

            function clearServiceCategoryForm() {
                document.getElementById('category-name').value = '';
                document.getElementById('category-description').value = '';
            }

            function clearServiceForm() {
                document.getElementById('service-name').value = '';
                document.getElementById('service-description').value = '';
                document.getElementById('service-price').value = '';
                document.getElementById('service-duration').value = '';
                document.getElementById('service-form').style.display = 'none';
            }

            function clearPackageForm() {
                document.getElementById('package-name').value = '';
                document.getElementById('package-description').value = '';
                document.getElementById('package-price').value = '';
                document.getElementById('package-includes').value = '';
                document.getElementById('package-form').style.display = 'none';
            }

            function clearTeamForm() {
                document.getElementById('team-name').value = '';
                document.getElementById('team-role').value = '';
                document.getElementById('team-bio').value = '';
                document.getElementById('team-photo').value = '';
                document.getElementById('team-form').style.display = 'none';
            }

            function clearFaqForm() {
                document.getElementById('faq-question').value = '';
                document.getElementById('faq-answer').value = '';
                document.getElementById('faq-form').style.display = 'none';
            }

            // Remove Functions
            function removeServiceCategory(index) {
                if (vendorSetupState.serviceCategories) {
                    vendorSetupState.serviceCategories.splice(index, 1);
                    updateServiceCategoriesDisplay();
                }
            }

            // Complete Vendor Setup
            async function completeVendorSetup() {
                try {
                    // Save current step data (Step 10)
                    saveCurrentStepData();

                    // Show loading
                    const completeBtn = document.getElementById('complete-setup-btn');
                    completeBtn.textContent = 'Completing Setup...';
                    completeBtn.disabled = true;

                    // Get vendor profile ID
                    if (!vendorSetupState.vendorProfileId) {
                        const vendorProfileResponse = await fetch(`${API_BASE_URL}/vendors/profile?userId=${vendorSetupState.vendorId}`, {
                            headers: {
                                'Authorization': `Bearer ${localStorage.getItem('token')}`
                            }
                        });

                        if (!vendorProfileResponse.ok) {
                            throw new Error('Failed to fetch vendor profile ID');
                        }

                        const vendorProfileData = await vendorProfileResponse.json();
                        vendorSetupState.vendorProfileId = vendorProfileData.vendorProfileId;
                    }

                    // Submit completion data to backend
                    const response = await fetch(`${API_BASE_URL}/vendors/setup/step10-completion`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${localStorage.getItem('token')}`
                        },
                        body: JSON.stringify({
                            vendorProfileId: vendorSetupState.vendorProfileId,
                            faqs: vendorSetupState.faqs || [],
                            testimonials: vendorSetupState.testimonials || []
                        })
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.message || 'Setup completion failed');
                    }

                    const result = await response.json();
                    
                    alert(' Congratulations! Your vendor profile setup is complete and now live!');
                    vendorRegistrationModal.style.display = 'none';
                    document.body.style.overflow = 'auto';
                    
                    // Update current user to vendor mode
                    currentUser.isVendor = true;
                    
                    // Redirect to vendor dashboard
                    displayUserDashboard('vendor', 'vendor-dashboard');
                    
                } catch (error) {
                    console.error('Setup completion error:', error);
                    alert('Setup failed: ' + error.message);
                } finally {
                    const completeBtn = document.getElementById('complete-setup-btn');
                    if (completeBtn) {
                        completeBtn.textContent = ' Complete Setup & Go Live!';
                        completeBtn.disabled = false;
                    }
                }
            }

            // Remove FAQ function
            function removeFaq(index) {
                vendorSetupState.faqs.splice(index, 1);
                updateFaqDisplay();
            }

            function renderGalleryPreview() {
                const container = document.getElementById('gallery-preview');
                container.innerHTML = vendorSetupState.gallery.map((item, index) => `
                    <div class="gallery-item">
                        <img src="${item.url}" alt="${item.caption}">
                        <button class="remove-btn" onclick="removeGalleryItem(${index})"></button>
                    </div>
                `).join('');
            }

            function removeGalleryItem(index) {
                vendorSetupState.gallery.splice(index, 1);
                renderGalleryPreview();
            }

            function addPackage() {
                const form = document.getElementById('package-form');
                const packageData = {
                    name: form.querySelector('[name="package_name"]').value,
                    description: form.querySelector('[name="description"]').value,
                    price: parseFloat(form.querySelector('[name="price"]').value),
                    duration: form.querySelector('[name="duration"]').value,
                    maxGuests: parseInt(form.querySelector('[name="max_guests"]').value),
                    includes: form.querySelector('[name="includes"]').value
                };
                
                if (!packageData.name || !packageData.price) {
                    alert('Please fill in package name and price');
                    return;
                }
                
                vendorSetupState.packages.push(packageData);
                renderPackagesList();
                form.reset();
                form.style.display = 'none';
            }

            function addService() {
                const form = document.getElementById('service-form');
                const serviceData = {
                    name: form.querySelector('[name="service_name"]').value,
                    description: form.querySelector('[name="service_description"]').value,
                    price: parseFloat(form.querySelector('[name="service_price"]').value),
                    duration: form.querySelector('[name="service_duration"]').value
                };
                
                if (!serviceData.name || !serviceData.price) {
                    alert('Please fill in service name and price');
                    return;
                }
                
                vendorSetupState.services.push(serviceData);
                renderServicesList();
                form.reset();
                form.style.display = 'none';
            }

            function renderPackagesList() {
                const container = document.getElementById('packages-list');
                container.innerHTML = vendorSetupState.packages.map((pkg, index) => `
                    <div class="package-item">
                        <h6>${pkg.name}</h6>
                        <p>${pkg.description}</p>
                        <div class="price">$${pkg.price} - ${pkg.duration}</div>
                        <button onclick="removePackage(${index})" style="margin-top: 0.5rem; background: var(--accent); color: white; border: none; padding: 0.25rem 0.5rem; border-radius: 4px; cursor: pointer;">Remove</button>
                    </div>
                `).join('');
            }

            function renderServicesList() {
                const container = document.getElementById('services-list');
                container.innerHTML = vendorSetupState.services.map((service, index) => `
                    <div class="service-item">
                        <h6>${service.name}</h6>
                        <p>${service.description}</p>
                        <div class="price">$${service.price} - ${service.duration}</div>
                        <button onclick="removeService(${index})" style="margin-top: 0.5rem; background: var(--accent); color: white; border: none; padding: 0.25rem 0.5rem; border-radius: 4px; cursor: pointer;">Remove</button>
                    </div>
                `).join('');
            }

            function removePackage(index) {
                vendorSetupState.packages.splice(index, 1);
                renderPackagesList();
            }

            function removeService(index) {
                vendorSetupState.services.splice(index, 1);
                renderServicesList();
            }

            function saveCurrentStepData() {
                switch (vendorSetupState.currentStep) {
                    case 3: // Social Media
                        const platforms = ['facebook', 'instagram', 'twitter', 'linkedin', 'youtube', 'tiktok'];
                        platforms.forEach(platform => {
                            const input = document.getElementById(`social-${platform}`);
                            if (input && input.value.trim()) {
                                vendorSetupState.socialMedia[platform] = input.value.trim();
                            }
                        });
                        break;
                    case 4: // Availability
                        vendorSetupState.availability = [];
                        for (let day = 0; day < 7; day++) {
                            const checkbox = document.getElementById(`available-${day}`);
                            const startTime = document.getElementById(`start-${day}`);
                            const endTime = document.getElementById(`end-${day}`);
                            
                            if (checkbox.checked && startTime.value && endTime.value) {
                                vendorSetupState.availability.push({
                                    day: day,
                                    start: startTime.value,
                                    end: endTime.value
                                });
                            }
                        }
                        break;
                    case 10: // Setup Completion - Collect FAQ data
                        // Collect FAQ data from the UI
                        if (!vendorSetupState.faqs) {
                            vendorSetupState.faqs = [];
                        }
                        // FAQs are already collected via addFAQ function, so just ensure they exist
                        console.log('Step 10 - FAQ data collected:', vendorSetupState.faqs);
                        break;
                }
            }

            // Remove functions for various items
            function removePortfolioItem(index) {
                vendorSetupState.portfolio.splice(index, 1);
                updatePortfolioDisplay();
            }

            function removeTeamMember(index) {
                vendorSetupState.teamMembers.splice(index, 1);
                updateTeamDisplay();
            }

            // Submit current step data to backend
            async function submitCurrentStepToBackend() {
                const currentStep = vendorSetupState.currentStep;
                const token = localStorage.getItem('token');
                
                if (!token) {
                    throw new Error('No authentication token found');
                }

                // Get vendor profile ID if not already set
                if (!vendorSetupState.vendorProfileId) {
                    const vendorProfileResponse = await fetch(`${API_BASE_URL}/vendors/profile?userId=${vendorSetupState.vendorId}`, {
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });

                    if (!vendorProfileResponse.ok) {
                        throw new Error('Failed to fetch vendor profile ID');
                    }

                    const vendorProfileData = await vendorProfileResponse.json();
                    vendorSetupState.vendorProfileId = vendorProfileData.vendorProfileId;
                }

                // Prepare step data based on current step
                let stepData = {};
                let endpoint = '';

                switch (currentStep) {
                    case 1: // Business Basics
                        const primaryCategory = document.getElementById('primary-category')?.value || '';
                        const additionalCategories = Array.from(document.getElementById('additional-categories')?.selectedOptions || []).map(option => option.value);
                        const allCategories = primaryCategory ? [primaryCategory, ...additionalCategories.filter(cat => cat !== primaryCategory)] : additionalCategories;
                        
                        stepData = {
                            vendorProfileId: vendorSetupState.vendorProfileId,
                            businessName: document.getElementById('business-name')?.value || '',
                            businessEmail: document.getElementById('business-email')?.value || '',
                            businessPhone: document.getElementById('business-phone')?.value || '',
                            businessDescription: document.getElementById('business-description')?.value || '',
                            primaryCategory: primaryCategory,
                            displayName: document.getElementById('display-name')?.value || '',
                            website: document.getElementById('website-url')?.value || '',
                            tagline: document.getElementById('tagline')?.value || '',
                            yearsInBusiness: parseInt(document.getElementById('years-in-business')?.value) || 0,
                            categories: allCategories
                        };
                        endpoint = '/vendors/setup/step1-business-basics';
                        break;

                    case 2: // Location Information
                        stepData = {
                            vendorProfileId: vendorSetupState.vendorProfileId,
                            address: document.getElementById('business-address')?.value || '',
                            city: document.getElementById('business-city')?.value || '',
                            state: document.getElementById('business-state')?.value || '',
                            postalCode: document.getElementById('business-postal')?.value || '',
                            country: document.getElementById('business-country')?.value || 'USA',
                            latitude: parseFloat(document.getElementById('business-latitude')?.value) || null,
                            longitude: parseFloat(document.getElementById('business-longitude')?.value) || null,
                            serviceRadius: parseInt(document.getElementById('service-radius')?.value) || 25,
                            serviceAreas: document.getElementById('service-areas')?.value.split('\n').filter(area => area.trim())
                        };
                        endpoint = '/vendors/setup/step2-location';
                        break;

                    case 3: // Gallery & Media
                        // Use the Cloudinary URLs that were uploaded via handleFeaturedImageUpload
                        const featuredImage = vendorSetupState.stepData.step3?.featuredImage || 
                                            document.getElementById('featured-image-url')?.value || 
                                            'https://via.placeholder.com/400x300.jpg';
                        
                        stepData = {
                            vendorProfileId: vendorSetupState.vendorProfileId,
                            featuredImage: featuredImage,
                            gallery: vendorSetupState.gallery || [],
                            portfolio: vendorSetupState.portfolio || []
                        };
                        endpoint = '/vendor-cloudinary/setup/step3-gallery';
                        break;

                    case 4: // Services & Packages
                        stepData = {
                            vendorProfileId: vendorSetupState.vendorProfileId,
                            serviceCategories: vendorSetupState.serviceCategories || [],
                            services: vendorSetupState.services || [],
                            packages: vendorSetupState.packages || []
                        };
                        endpoint = '/vendors/setup/step4-services';
                        break;

                    case 5: // Team Information
                        stepData = {
                            vendorProfileId: vendorSetupState.vendorProfileId,
                            teamMembers: vendorSetupState.teamMembers || []
                        };
                        endpoint = '/vendors/setup/step5-team';
                        break;

                    case 6: // Social Media & Links
                        const socialMediaProfiles = [];
                        
                        // Collect social media profiles
                        const socialPlatforms = [
                            { platform: 'website', id: 'business-website' },
                            { platform: 'facebook', id: 'social-facebook' },
                            { platform: 'instagram', id: 'social-instagram' },
                            { platform: 'twitter', id: 'social-twitter' },
                            { platform: 'linkedin', id: 'social-linkedin' },
                            { platform: 'youtube', id: 'social-youtube' },
                            { platform: 'tiktok', id: 'social-tiktok' }
                        ];
                        
                        socialPlatforms.forEach(item => {
                            const url = document.getElementById(item.id)?.value || '';
                            if (url.trim()) {
                                socialMediaProfiles.push({
                                    platform: item.platform,
                                    url: url.trim()
                                });
                            }
                        });
                        
                        stepData = {
                            vendorProfileId: vendorSetupState.vendorProfileId,
                            socialMediaProfiles,
                            bookingLink: document.getElementById('booking-link')?.value || ''
                        };
                        endpoint = '/vendors/setup/step6-social';
                        break;

                    case 7: // Availability & Scheduling
                        const businessHours = [];
                        const days = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'];
                        days.forEach((day, index) => {
                            const available = document.getElementById(`available-${index}`)?.checked || false;
                            const openTime = document.getElementById(`${day}-open`)?.value || '';
                            const closeTime = document.getElementById(`${day}-close`)?.value || '';
                            if (available && openTime && closeTime) {
                                // Ensure proper time format for SQL Server
                                const formatTime = (time) => {
                                    if (!time) return null;
                                    // If already has seconds, don't add more
                                    if (time.split(':').length === 3) return time;
                                    // Add seconds if only HH:MM format
                                    if (time.split(':').length === 2) return time + ':00';
                                    return time;
                                };
                                
                                const formattedOpenTime = formatTime(openTime);
                                const formattedCloseTime = formatTime(closeTime);
                                
                                // Only add if both times are valid
                                if (formattedOpenTime && formattedCloseTime) {
                                    businessHours.push({
                                        dayOfWeek: index,
                                        openTime: formattedOpenTime,
                                        closeTime: formattedCloseTime,
                                        isAvailable: true
                                    });
                                }
                            }
                        });

                        stepData = {
                            vendorProfileId: vendorSetupState.vendorProfileId,
                            businessHours,
                            acceptingBookings: document.getElementById('accepting-bookings')?.checked || false,
                            responseTimeExpectation: parseInt(document.getElementById('response-time')?.value) || 24,
                            bufferTime: parseInt(document.getElementById('buffer-time')?.value) || 30
                        };
                        endpoint = '/vendors/setup/step7-availability';
                        break;

                    case 8: // Policies & Preferences
                        const paymentMethods = [];
                        ['cash', 'check', 'credit', 'debit', 'paypal', 'venmo', 'zelle', 'bank'].forEach(method => {
                            if (document.getElementById(`payment-${method}`)?.checked) {
                                paymentMethods.push(method);
                            }
                        });

                        stepData = {
                            vendorProfileId: vendorSetupState.vendorProfileId,
                            depositRequirements: document.getElementById('deposit-requirements')?.value || '',
                            cancellationPolicy: document.getElementById('cancellation-policy')?.value || '',
                            reschedulingPolicy: document.getElementById('rescheduling-policy')?.value || '',
                            paymentMethods,
                            paymentTerms: document.getElementById('payment-terms')?.value || ''
                        };
                        endpoint = '/vendors/setup/step8-policies';
                        break;

                    case 9: // Verification & Legal
                        stepData = {
                            vendorProfileId: vendorSetupState.vendorProfileId,
                            licenseNumber: document.getElementById('license-number')?.value || '',
                            insuranceVerified: document.getElementById('insurance-verified')?.checked || false,
                            awardsCertifications: document.getElementById('awards-certifications')?.value || '',
                            businessType: document.getElementById('business-type')?.value || '',
                            taxId: document.getElementById('tax-id')?.value || '',
                            isEcoFriendly: document.getElementById('eco-friendly')?.checked || false,
                            isPremium: document.getElementById('premium-status')?.checked || false
                        };
                        endpoint = '/vendors/setup/step9-verification';
                        break;

                    default:
                        // No submission needed for steps that don't have backend endpoints
                        return;
                }

                // Submit to backend
                console.log(`Submitting step ${currentStep} data:`, stepData);
                const response = await fetch(`${API_BASE_URL}${endpoint}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(stepData)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || `Step ${currentStep} submission failed`);
                }

                const result = await response.json();
                console.log(`Step ${currentStep} submitted successfully:`, result);
                return result;
            }

            // Make functions global for onclick handlers
            window.addPackage = addPackage;
            window.addService = addService;
            window.removePackage = removePackage;
            window.removeService = removeService;
            window.removeGalleryItem = removeGalleryItem;
            
            // Handle Google Sign-in response
            async function handleGoogleSignIn(response) {
                const credential = response.credential;
                const decodedToken = parseJwt(credential);

                if (!decodedToken.email || !decodedToken.name) {
                    alert('Google sign-in failed. Email or name is missing.');
                    return;
                }

                try {
                    const apiResponse = await fetch(`${API_BASE_URL}/users/social-login`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            email: decodedToken.email,
                            name: decodedToken.name,
                            authProvider: 'google',
                            avatar: decodedToken.picture
                        })
                    });

                    if (!apiResponse.ok) {
                        const errorData = await apiResponse.json();
                        throw new Error(errorData.message || 'Social login failed.');
                    }

                    const userData = await apiResponse.json();
                    localStorage.setItem('token', userData.token);
                    
                    simulateLogin({
                        id: userData.userId,
                        name: userData.name,
                        email: userData.email,
                        avatar: userData.avatar || userData.name[0].toUpperCase(),
                        isVendor: userData.isVendor || false
                    });
                    connectToChat();
                    promptForAccountType(userData.userId);

                } catch (error) {
                    console.error('Google sign-in API error:', error);
                    alert('Google sign-in failed: ' + error.message);
                }
            }

            function parseJwt(token) {
                try {
                    const base64Url = token.split('.')[1];
                    const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
                    const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
                    }).join(''));
                    return JSON.parse(jsonPayload);
                } catch (e) {
                    return null;
                }
            }

            // Prompt user for account type after social login
            function promptForAccountType(userId) {
                const accountType = prompt("Welcome! Are you a Client or a Vendor? (Type 'client' or 'vendor')");
                if (accountType && accountType.toLowerCase() === 'vendor') {
                    if (currentUser) currentUser.isVendor = true;
                    // Automatically show the vendor setup wizard
                    initializeVendorSetup(userId);
                } else {
                    alert("You have been registered as a client. You can switch to a vendor account later.");
                }
            }


            // Filter vendors based on current filters
            function filterVendors() {
                // Get search term
                const searchTerm = searchInput.value.toLowerCase();

                // Get filter values
                const selectedTypes = [];
                document.querySelectorAll('.filter-section input[type="checkbox"]:checked').forEach(checkbox => {
                    if (checkbox.id !== 'current-location' && checkbox.id !== 'within50') {
                        selectedTypes.push(checkbox.id);
                    }
                });

                const priceRange = document.getElementById('price-slider').value;
                const useCurrentLocation = document.getElementById('current-location').checked;
                const within50Miles = document.getElementById('within50').checked;
                const startDate = document.getElementById('start-date').value;
                const endDate = document.getElementById('end-date').value;
                const region = document.getElementById('region-select').value;

                // First apply all filters EXCEPT location
                let filtered = state.vendors.filter(vendor => {
                    // Category filter
                    if (state.currentCategory !== 'all' && vendor.category !== state.currentCategory) {
                        return false;
                    }

                    // Search term (vendor name, location, or services)
                    if (searchTerm) {
                        const nameMatch = vendor.name.toLowerCase().includes(searchTerm);
                        const locationMatch = vendor.location.toLowerCase().includes(searchTerm);
                        let serviceMatch = false;

                        if (vendor.services) {
                            serviceMatch = vendor.services.some(category =>
                                category.services.some(service =>
                                    service.name.toLowerCase().includes(searchTerm) ||
                                    service.description.toLowerCase().includes(searchTerm))
                            );
                        }

                        if (!nameMatch && !locationMatch && !serviceMatch) {
                            return false;
                        }
                    }


                    // Vendor type
                    const vendorType = vendor.type?.toLowerCase() || 'independent';
                    if (selectedTypes.length > 0 && !selectedTypes.includes(vendorType)) {
                        return false;
                    }

                    // Price range
                    if (priceRange < 33 && vendor.priceLevel === '$$$') return false;
                    if (priceRange > 66 && vendor.priceLevel === '$') return false;

                    // Popular filters
                    if (state.filters.popular.length > 0) {
                        if (state.filters.popular.includes('premium') && !vendor.isPremium) return false;
                        if (state.filters.popular.includes('eco-friendly') && !vendor.isEcoFriendly) return false;
                        if (state.filters.popular.includes('award-winning') && !vendor.isAwardWinning) return false;
                    }

                    // Date availability filter
                    if (startDate) {
                        // In a real app, you would check vendor availability against the date
                        // For demo, we'll just filter randomly
                        if (Math.random() < 0.7) return false;
                    }

                    // Region filter
                    if (region && vendor.region !== region) {
                        return false;
                    }

                    return true;
                });

                // Handle location filter
                let locationMessage = '';
                if (useCurrentLocation && state.userLocation && within50Miles) {
                    // For demo purposes, we'll simulate nearby vendors by filtering the first few
                    const nearbyVendors = filtered.slice(0, 3);
                    if (nearbyVendors.length > 0) {
                        filtered = nearbyVendors;
                        locationMessage = `${filtered.length} vendors available near you`;
                    } else {
                        // If no nearby vendors, show ALL vendors that match other filters
                        locationMessage = "No vendors near you. Showing all available vendors.";
                    }
                } else {
                    locationMessage = `${filtered.length} vendors available`;
                }

                state.filteredVendors = filtered;
                resultsCount.textContent = locationMessage;

                // Apply sorting
                sortVendors(false);

                // Reset to first page
                state.currentPage = 1;

                // Update UI
                updateMetadata({ total: state.filteredVendors.length });
                renderVendors();

                // Update map if in map view
                if (state.map) {
                    updateMapMarkers();
                }
            }

            // Sort vendors
            function sortVendors(shouldRender = true) {
                const sortValue = sortSelect.value;

                switch(sortValue) {
                    case 'price-low':
                        state.filteredVendors.sort((a, b) => {
                            const priceA = a.priceLevel === '$' ? 1 : a.priceLevel === '$$' ? 2 : 3;
                            const priceB = b.priceLevel === '$' ? 1 : b.priceLevel === '$$' ? 2 : 3;
                            return priceA - priceB;
                        });
                        break;
                    case 'price-high':
                        state.filteredVendors.sort((a, b) => {
                            const priceA = a.priceLevel === '$' ? 1 : a.priceLevel === '$$' ? 2 : 3;
                            const priceB = b.priceLevel === '$' ? 1 : b.priceLevel === '$$' ? 2 : 3;
                            return priceB - priceA;
                        });
                        break;
                    case 'popular':
                        state.filteredVendors.sort((a, b) => {
                            const ratingA = parseFloat(a.rating?.split(' ')[0] || 0);
                            const ratingB = parseFloat(b.rating?.split(' ')[0] || 0);
                            return ratingB - ratingA;
                        });
                        break;
                    case 'nearest':
                        if (state.userLocation) {
                            // In a real app, we would calculate distance properly
                            // For demo, we'll just shuffle the array
                            state.filteredVendors.sort(() => Math.random() - 0.5);
                        }
                        break;
                    case 'rating':
                        state.filteredVendors.sort((a, b) => {
                            const ratingA = a.rating || 0;
                            const ratingB = b.rating || 0;
                            return ratingB - ratingA;
                        });
                        break;
                    default:
                        break;
                }

                if (shouldRender) {
                    renderVendors();
                    if (state.map) {
                        updateMapMarkers();
                    }
                }
            }

            // Reset specific filter
            function resetFilter(filterType) {
                switch(filterType) {
                    case 'location':
                        document.getElementById('location-input').value = '';
                        document.getElementById('current-location').checked = false;
                        document.getElementById('within50').checked = false;
                        state.userLocation = null;
                        break;
                    case 'type':
                        document.querySelectorAll('.filter-section input[type="checkbox"]').forEach(checkbox => {
                            checkbox.checked = ['independent', 'company'].includes(checkbox.id);
                        });
                        break;
                    case 'price':
                        document.getElementById('price-slider').value = 40;
                        break;
                    case 'advanced':
                        document.getElementById('start-date').value = '';
                        document.getElementById('end-date').value = '';
                        state.filters.startDate = null;
                        state.filters.endDate = null;
                        state.filters.region = '';
                        break;
                }

                filterVendors();
            }

            // Render vendor cards
            function renderVendors() {
                if (!state.filteredVendors || state.filteredVendors.length === 0) {
                    vendorGrid.innerHTML = '<div style="grid-column:1/-1;text-align:center;padding:2rem;">No vendors match your filters</div>';
                    updatePagination();
                    return;
                }

                // Pagination
                const startIndex = (state.currentPage - 1) * state.itemsPerPage;
                const endIndex = startIndex + state.itemsPerPage;
                const paginatedVendors = state.filteredVendors.slice(startIndex, endIndex);

            vendorGrid.innerHTML = '';

            // Show skeleton cards while loading
            if (state.filteredVendors.length === 0) {
                for (let i = 0; i < state.itemsPerPage; i++) {
                    const skeletonCard = document.createElement('div');
                    skeletonCard.className = 'vendor-card skeleton-card';
                    skeletonCard.innerHTML = `
                        <div class="vendor-image skeleton-box"></div>
                        <div class="vendor-details">
                            <h3 class="vendor-name skeleton-box" style="width: 60%; height: 1.2rem;"></h3>
                            <div class="vendor-location skeleton-box" style="width: 40%; height: 1rem; margin: 0.5rem 0;"></div>
                            <div class="vendor-features" style="display: flex; gap: 0.5rem;">
                                <div class="feature skeleton-box" style="width: 30%; height: 1rem;"></div>
                                <div class="feature skeleton-box" style="width: 20%; height: 1rem;"></div>
                                <div class="feature skeleton-box" style="width: 25%; height: 1rem;"></div>
                            </div>
                            <div class="vendor-footer" style="display: flex; gap: 0.5rem; margin-top: 1rem;">
                                <button class="btn btn-outline skeleton-box" style="width: 50%; height: 2rem;"></button>
                                <button class="btn btn-primary skeleton-box" style="width: 50%; height: 2rem;"></button>
                            </div>
                        </div>
                    `;
                    vendorGrid.appendChild(skeletonCard);
                }
                return;
            }

            paginatedVendors.forEach(vendor => {
                const isFavorite = state.favorites.includes(vendor.id);

                const vendorCard = document.createElement('div');
                vendorCard.className = 'vendor-card';
                vendorCard.innerHTML = `
                    <div class="vendor-image">
                        ${vendor.image ? `<img src="${vendor.image}" alt="${vendor.name}" style="width:100%;height:100%;object-fit:cover;">` : getCategoryIcon(vendor.category)}
                        <div class="vendor-favorite ${isFavorite ? 'active' : ''}" data-id="${vendor.id}"></div>
                        <div class="vendor-badges" style="position: absolute; bottom: 8px; left: 8px; display: flex; gap: 6px;">
                            ${vendor.isPremium ? '<span class="badge" style="background-color: #5e72e4; color: white; padding: 2px 6px; border-radius: 12px; font-size: 0.75rem;">Premium</span>' : ''}
                            ${vendor.isEcoFriendly ? '<span class="badge" style="background-color: #38a169; color: white; padding: 2px 6px; border-radius: 12px; font-size: 0.75rem;">Eco-Friendly</span>' : ''}
                            ${vendor.isAwardWinning ? '<span class="badge" style="background-color: #d69e2e; color: white; padding: 2px 6px; border-radius: 12px; font-size: 0.75rem;">Award Winning</span>' : ''}
                        </div>
                    </div>
                    <div class="vendor-details">
                        <h3 class="vendor-name">${vendor.name}</h3>
                        <div class="vendor-location">
                             ${vendor.location}
                        </div>
                        <div class="vendor-features">
                            <div class="feature">
                                <span class="feature-icon">${getCategoryIcon(vendor.category)}</span>
                                <span>${getCategoryName(vendor.category)}</span>
                            </div>
                            <div class="feature">
                                <span class="feature-icon"></span>
                                <span>${vendor.rating} (${vendor.reviewCount})</span>
                            </div>
                            <div class="feature">
                                <div class="price-indicator">
                                    ${renderPriceIndicator(vendor.priceLevel)}
                                </div>
                            </div>
                        </div>
                        <div class="vendor-footer">
                            <button class="btn btn-outline save-btn" data-id="${vendor.id}">Save</button>
                            <button class="btn btn-primary view-btn" data-id="${vendor.id}">View</button>
                        </div>
                    </div>
                `;
                vendorGrid.appendChild(vendorCard);

                // Add event listeners to buttons
                vendorCard.querySelector('.view-btn').addEventListener('click', () => {
                    window.location.hash = `/listings/${vendor.id}`;
                });

                vendorCard.querySelector('.save-btn').addEventListener('click', (e) => {
                    e.stopPropagation();
                    toggleFavorite(vendor.id);
                });

                vendorCard.querySelector('.vendor-favorite').addEventListener('click', (e) => {
                    e.stopPropagation();
                    toggleFavorite(vendor.id);
                });
            });

            updatePagination();
            }

            // Helper function to get category icon
            function getCategoryIcon(category) {
                const icons = {
                    "all": "",
                    "venue": "",
                    "photo": "",
                    "music": "",
                    "catering": "",
                    "entertainment": "",
                    "experiences": "",
                    "decor": "",
                    "beauty": "",
                    "cake": "",
                    "transport": "",
                    "planner": "",
                    "fashion": "",
                    "stationery": ""
                };
                return icons[category] || "";
            }

            // Helper function to get category name
            function getCategoryName(category) {
                const names = {
                    "all": "All Categories",
                    "venue": "Venue",
                    "photo": "Photo/Video",
                    "music": "Music/DJ",
                    "catering": "Catering",
                    "entertainment": "Entertainment",
                    "experiences": "Experiences",
                    "decor": "Decorations",
                    "beauty": "Beauty",
                    "cake": "Cake",
                    "transport": "Transportation",
                    "planner": "Planner",
                    "fashion": "Fashion",
                    "stationery": "Stationery"
                };
                return names[category] || "Vendor";
            }

            // Render price indicator
            function renderPriceIndicator(priceLevel) {
                const levels = priceLevel || '$';
                let html = '';

                for (let i = 0; i < 3; i++) {
                    const isFilled = i < levels.length;
                    html += `<span class="price-dot ${isFilled ? 'filled' : ''}"></span>`;
                }

                return html;
            }

            // Update pagination controls
            function updatePagination() {
                const totalPages = Math.ceil(state.filteredVendors.length / state.itemsPerPage);

                if (totalPages <= 1) {
                    pagination.style.display = 'none';
                    return;
                }

                pagination.style.display = 'flex';

                // Clear existing page buttons (except prev/next)
                const pageBtns = pagination.querySelectorAll('.page-btn:not(#prev-page):not(#next-page)');
                pageBtns.forEach(btn => btn.remove());

                // Add page buttons
                for (let i = 1; i <= totalPages; i++) {
                    const pageBtn = document.createElement('div');
                    pageBtn.className = `page-btn ${i === state.currentPage ? 'active' : ''}`;
                    pageBtn.textContent = i;
                    pageBtn.addEventListener('click', () => {
                        state.currentPage = i;
                        renderVendors();
                    });

                    pagination.insertBefore(pageBtn, nextPageBtn);
                }

                // Update prev/next button states
                prevPageBtn.classList.toggle('disabled', state.currentPage === 1);
                nextPageBtn.classList.toggle('disabled', state.currentPage === totalPages);
            }

            // Update metadata in header
            function updateMetadata(metadata) {
                const usingLocation = state.userLocation && document.getElementById('current-location').checked;
                const locationText = usingLocation ? "Near You" : (metadata?.location || 'Los Angeles');
                const categoryText = state.currentCategory === 'all' ? '' : getCategoryName(state.currentCategory) + ' ';

                resultsTitle.textContent = `${categoryText}Vendors in ${locationText}`;
                resultsCount.textContent = `${state.filteredVendors.length} vendors available${usingLocation ? ' near you' : ''}`;
            }

            // Show error message
            function showError(message) {
                vendorGrid.innerHTML = `<div style="grid-column:1/-1;text-align:center;padding:2rem;color:var(--accent)">${message}</div>`;
                resultsTitle.textContent = "Error";
                resultsCount.textContent = message;
            }

            // Show dedicated vendor profile page
            async function showVendorProfilePage(vendorId) {
                mainAppView.style.display = 'none';
                clientDashboardContainer.style.display = 'none';
                vendorDashboardContainer.style.display = 'none';
                vendorProfilePage.style.display = 'block';
                document.body.style.overflow = 'auto';

                vendorProfilePage.innerHTML = '<p style="text-align: center; margin-top: 5rem;">Loading vendor profile...</p>';

                try {
                    const response = await fetch(`${API_BASE_URL}/vendors/${vendorId}?userId=${currentUser ? currentUser.id : ''}`);
                    if (!response.ok) {
                        throw new Error(`Failed to fetch vendor details: ${response.statusText}`);
                    }
                    const data = await response.json();
                    const fullVendorDetails = data.data;

                    renderVendorProfile(fullVendorDetails);
                    
                    // Add logic for the new review form
                    const reviewForm = document.getElementById('review-form');
                    const showReviewFormBtn = document.getElementById('show-review-form');
                    const ratingStars = document.querySelectorAll('#review-form .rating-star');
                    let currentRating = 0;
                    
                    if(showReviewFormBtn) {
                        showReviewFormBtn.addEventListener('click', () => {
                            reviewForm.style.display = 'block';
                            showReviewFormBtn.style.display = 'none';
                        });
                    }

                    ratingStars.forEach(star => {
                        star.addEventListener('click', () => {
                            currentRating = parseInt(star.dataset.rating);
                            ratingStars.forEach(s => {
                                s.classList.toggle('selected', parseInt(s.dataset.rating) <= currentRating);
                            });
                        });
                    });
                    
                    const submitReviewBtn = document.getElementById('submit-review');
                    if (submitReviewBtn) {
                        submitReviewBtn.addEventListener('click', async () => {
                            if (!currentUser) {
                                alert('You must be logged in to leave a review.');
                                return;
                            }
                            const reviewText = document.getElementById('review-text').value;
                            if (reviewText.trim() === '' || currentRating === 0) {
                                alert('Please provide a rating and a comment.');
                                return;
                            }
                            
                            try {
                                const reviewResponse = await fetch(`${API_BASE_URL}/reviews/submit`, {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/json',
                                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                                    },
                                    body: JSON.stringify({
                                        userId: currentUser.id,
                                        vendorProfileId: vendorId,
                                        rating: currentRating,
                                        comment: reviewText
                                    })
                                });
                                
                                if (!reviewResponse.ok) {
                                    const errorData = await reviewResponse.json();
                                    throw new Error(errorData.message || 'Failed to submit review');
                                }
                                
                                alert('Review submitted successfully!');
                                // Simulate adding the new review to the list
                                const newReview = {
                                    ReviewerName: currentUser.name,
                                    Rating: currentRating,
                                    Comment: reviewText,
                                    CreatedAt: new Date().toISOString()
                                };
                                const reviewsList = document.getElementById('vendor-profile-reviews-list');
                                const existingReviews = reviewsList.innerHTML;
                                reviewsList.innerHTML = renderReviews([newReview]) + existingReviews;
                                
                                // Reset the form
                                reviewForm.style.display = 'none';
                                showReviewFormBtn.style.display = 'block';
                                document.getElementById('review-text').value = '';
                                ratingStars.forEach(s => s.classList.remove('selected'));
                                currentRating = 0;
                                
                            } catch (error) {
                                console.error('Review submission failed:', error);
                                alert('Failed to submit review: ' + error.message);
                            }
                        });
                    }
                    
                } catch (error) {
                    console.error('Error fetching vendor profile:', error);
                    vendorProfilePage.innerHTML = `<p style="text-align: center; color: var(--accent); margin-top: 5rem;">Error loading profile: ${error.message}</p>`;
                }
            }

            function renderVendorProfile(details) {
                const profile = details.profile;
                const isFavorite = details.isFavorite;

                // Build HTML for the entire page
                let html = `
                    <!-- Back Button -->
                    <div style="margin-bottom: 2rem;">
                        <button onclick="window.location.hash = ''" class="btn btn-outline" style="display: flex; align-items: center; gap: 0.5rem;">
                            <span> Back to search results</span>
                        </button>
                    </div>
                    
                    <!-- Image Gallery -->
                    <div id="modal-image-gallery" class="image-gallery">
                        <!-- Images will be loaded dynamically here -->
                    </div>

                    <!-- Vendor Header -->
                    <div class="vendor-profile-header">
                        <div class="vendor-profile-info">
                            <h1 style="font-size: 2.5rem; font-weight: 700; margin-bottom: 0.5rem;">${profile.BusinessName}</h1>
                            <p style="font-size: 1.1rem; color: var(--primary); margin-bottom: 1rem;">${profile.Tagline || profile.BusinessDescription}</p>
                            <div style="display: flex; align-items: center; gap: 1rem; color: var(--text-light); margin-bottom: 1rem;">
                                <span> ${profile.City}, ${profile.State}</span>
                                <span class="review-rating" style="color: #fbbf24;">${''.repeat(Math.round(profile.AverageRating))}${''.repeat(5 - Math.round(profile.AverageRating))}</span>
                                <span>(${profile.AverageRating ? profile.AverageRating.toFixed(1) : '0.0'}) | ${profile.ReviewCount} Reviews</span>
                            </div>
                        </div>
                         <!-- Favorite Button -->
                        <div class="vendor-favorite ${isFavorite ? 'active' : ''}" data-id="${profile.VendorProfileID}" style="flex-shrink: 0; align-self: flex-start; margin-top: 1rem;"></div>
                    </div>

                    <!-- Vendor Content Sections -->
                    <div style="display: grid; grid-template-columns: 1fr 320px; gap: 2rem; margin-top: 2rem;">
                        <!-- Main Content Area -->
                        <div>
                            <h2 class="services-title">About Us</h2>
                            <p style="line-height: 1.6;">${profile.BusinessDescription}</p>
                            
                            <!-- Social Media Section -->
                            <div class="services-section">
                                <h2 class="services-title">Social Media</h2>
                                <div style="display: flex; gap: 1rem;">
                                    <a href="${profile.Instagram || '#'}" target="_blank" style="text-decoration: none; color: var(--text); opacity: ${profile.Instagram ? '1' : '0.5'}; pointer-events: ${profile.Instagram ? 'auto' : 'none'};">
                                        <img src="https://upload.wikimedia.org/wikipedia/commons/a/a5/Instagram_icon.png" width="36" height="36" alt="Instagram">
                                    </a>
                                    <a href="${profile.Facebook || '#'}" target="_blank" style="text-decoration: none; color: var(--text); opacity: ${profile.Facebook ? '1' : '0.5'}; pointer-events: ${profile.Facebook ? 'auto' : 'none'};">
                                        <img src="https://upload.wikimedia.org/wikipedia/commons/5/51/Facebook_f_logo_%282019%29.svg" width="36" height="36" alt="Facebook">
                                    </a>
                                    <a href="${profile.Website || '#'}" target="_blank" style="text-decoration: none; color: var(--text); opacity: ${profile.Website ? '1' : '0.5'}; pointer-events: ${profile.Website ? 'auto' : 'none'};">
                                        <img src="https://upload.wikimedia.org/wikipedia/commons/c/c4/Globe_icon.svg" width="36" height="36" alt="Website">
                                    </a>
                                </div>
                            </div>
                            
                            <!-- Services -->
                            <div id="profile-services-section" class="services-section">
                                <h2 class="services-title">Our Services</h2>
                                ${renderServices(details.services)}
                            </div>

                            <!-- Reviews Section -->
                            <div class="reviews-section">
                                <h2 class="reviews-title">Reviews (${profile.ReviewCount})</h2>
                                <div id="vendor-profile-reviews-list">
                                    ${renderReviews(details.reviews)}
                                </div>
                                ${currentUser ? `
                                    <button class="btn btn-outline add-review-btn" id="show-review-form" style="margin-top: 1rem;">Add Review</button>
                                    <div class="review-form" id="review-form" style="display: none;">
                                        <div class="rating-input">
                                            <span class="rating-star" data-rating="1"></span>
                                            <span class="rating-star" data-rating="2"></span>
                                            <span class="rating-star" data-rating="3"></span>
                                            <span class="rating-star" data-rating="4"></span>
                                            <span class="rating-star" data-rating="5"></span>
                                        </div>
                                        <textarea class="review-textarea" id="review-text" placeholder="Share your experience..."></textarea>
                                        <button class="btn btn-primary" id="submit-review">Submit Review</button>
                                    </div>
                                ` : '<p><a href="#" id="login-to-review" style="color: var(--primary);">Log in</a> to leave a review</p>'}
                            </div>
                        </div>

                        <!-- Sidebar -->
                        <div style="display: flex; flex-direction: column; gap: 1rem; position: sticky; top: 2rem;">
                            <!-- Booking Summary -->
                            <div id="booking-summary" style="background-color: var(--secondary); padding: 1.5rem; border-radius: var(--radius);">
                                <h3 style="font-size: 1.2rem; font-weight: 600; margin-bottom: 1rem;">Your Booking</h3>
                                <div id="selected-services-list">
                                    <p style="font-size: 0.9rem; color: var(--text-light);">Select services from the list to get started.</p>
                                </div>
                                <div style="border-top: 1px solid var(--border); margin: 1rem 0; padding-top: 1rem; display: flex; justify-content: space-between; font-weight: 600;">
                                    <span>Total</span>
                                    <span id="booking-total-price">$0.00</span>
                                </div>
                                <button class="btn btn-primary" id="proceed-to-book-btn" style="width: 100%;" disabled>Choose Services</button>
                            </div>

                            <!-- Contact -->
                            <div style="background-color: var(--secondary); padding: 1.5rem; border-radius: var(--radius);">
                                <h3 style="font-size: 1.2rem; font-weight: 600; margin-bottom: 1rem;">Contact Vendor</h3>
                                <p style="margin-bottom: 1rem; font-size: 0.9rem; color: var(--text-light);">Have questions? Get in touch!</p>
                                <button class="btn btn-outline" id="open-chat-btn" style="width: 100%;">Message Vendor</button>
                            </div>
                        </div>
                    </div>
                `;

                vendorProfilePage.innerHTML = html;

                // Add event listeners for the new elements on the profile page
                vendorProfilePage.querySelector('.vendor-favorite').addEventListener('click', () => {
                    toggleFavorite(profile.VendorProfileID);
                });
                
                // Populate and set up the image gallery
                populateImageGallery(details.images);

                vendorProfilePage.querySelector('#open-chat-btn').addEventListener('click', () => {
                    initializeChat(profile.VendorProfileID, profile.BusinessName);
                });
                
                 if(document.getElementById('login-to-review')) {
                    document.getElementById('login-to-review').addEventListener('click', (e) => {
                         e.preventDefault();
                         profileModal.style.display = 'flex';
                         showLoginView();
                    });
                }
            }

            // Render services for a vendor
            function renderServices(serviceCategories) {
                return serviceCategories.map(category => `
                    <div class="service-category">
                        <h4 class="category-title">${category.CategoryName || category.Name}</h4>
                        <div class="service-grid">
                            ${(category.services || []).map(service => `
                                <div class="service-card">
                                    <div class="service-name">${service.name}</div>
                                    <div class="service-description">${service.description}</div>
                                    <div class="service-price">$${service.Price || service.price || 'N/A'}</div>
                                    <div class="service-actions">
                                        <button class="btn btn-outline btn-sm add-service-btn"
                                                data-service-id="${service.ServiceID}"
                                                data-service-name="${service.name}"
                                                data-price="${service.Price || service.price}">
                                            Add
                                        </button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `).join('');
            }

            // Render reviews for a vendor
            function renderReviews(reviews) {
                if (!reviews || reviews.length === 0) {
                    return '<p>No reviews yet.</p>';
                }
                return reviews.map(review => `
                    <div class="review-card">
                        <div class="review-header">
                            <div class="reviewer">${review.ReviewerName || review.UserName || 'Anonymous'}</div>
                            <div class="review-date">${new Date(review.CreatedAt).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</div>
                        </div>
                        <div class="review-rating">${''.repeat(review.Rating)}${''.repeat(5 - review.Rating)}</div>
                        ${review.Title ? `<div class="review-title">${review.Title}</div>` : ''}
                        <div class="review-text">${review.Comment}</div>
                    </div>
                `).join('');
            }

            // Close modal (specifically for vendor-modal and its state)
            function closeBookingModal() {
                document.getElementById('vendor-modal').style.display = 'none';
                document.body.style.overflow = 'auto';
                resetBookingModalState();
            }

            // New function to reset the state related to the booking modal
            function resetBookingModalState() {
                state.currentVendor = null;
                state.selectedServices = [];
                state.selectedDate = null;
                state.selectedTime = null;
                // Potentially clear calendar selection or time slots if FullCalendar allows
                const calendarEl = document.getElementById('booking-calendar');
                if (calendarEl && calendarEl._fullCalendar) {
                    calendarEl._fullCalendar.unselect();
                    document.getElementById('time-slots').innerHTML = '';
                }
                document.getElementById('payment-section').style.display = 'none';
                document.getElementById('book-now-btn').style.display = 'block';
            }

            // Show login view in profile modal
            function showLoginView() {
                loginForm.style.display = 'block';
                signupForm.style.display = 'none';
                loggedInView.style.display = 'none';
                document.getElementById('profile-modal-title').textContent = 'Welcome to VenueVue';
                // Clear form fields
                document.getElementById('login-email').value = '';
                document.getElementById('login-password').value = '';
            }

            // Show signup view in profile modal
            function showSignupView() {
                loginForm.style.display = 'none';
                signupForm.style.display = 'block';
                loggedInView.style.display = 'none';
                document.getElementById('profile-modal-title').textContent = 'Create an Account';
                // Clear form fields
                document.getElementById('signup-name').value = '';
                document.getElementById('signup-email').value = '';
                document.getElementById('signup-password').value = '';
            }

            // Show logged in view in profile modal
            function showLoggedInView() {
                loginForm.style.display = 'none';
                signupForm.style.display = 'none';
                loggedInView.style.display = 'block';
                document.getElementById('profile-modal-title').textContent = 'My Account';

                // Update user info
                document.getElementById('profile-name').textContent = currentUser.name;
                document.getElementById('profile-email').textContent = currentUser.email;
                document.getElementById('profile-avatar').textContent = currentUser.avatar;
            }

            // Unified function to display either client or vendor dashboard
            async function displayUserDashboard(mode, section) {
                // Update global state and localStorage
                isVendorMode = (mode === 'vendor');
                activeDashboardSection = section;
                localStorage.setItem('isVendorMode', isVendorMode);
                localStorage.setItem('activeDashboardSection', activeDashboardSection);

                // Show the dashboard modal
                const dashboardModal = document.getElementById('dashboard-modal');
                dashboardModal.style.display = 'flex';
                document.body.style.overflow = 'hidden';

                // Determine which dashboard to show
                if (isVendorMode) {
                    clientDashboardContainer.style.display = 'none';
                    vendorDashboardContainer.style.display = 'grid';
                } else {
                    clientDashboardContainer.style.display = 'grid';
                    vendorDashboardContainer.style.display = 'none';
                }

                // Get the correct menu and content sections based on the mode
                const currentDashboardMenu = isVendorMode ? vendorDashboardContainer.querySelector('.dashboard-menu') : clientDashboardContainer.querySelector('.dashboard-menu');
                const currentDashboardContentSections = document.querySelectorAll(
                    isVendorMode ? '#vendor-dashboard-container main > div[id]' : '#dashboard-container main > div[id]'
                );

                // Hide all sections in the active dashboard first
                currentDashboardContentSections.forEach(sec => {
                    sec.style.display = 'none';
                });

                // Show the selected section
                const targetSectionElement = document.getElementById(section + '-section');
                if (targetSectionElement) {
                    targetSectionElement.style.display = 'block';
                    // Update dashboard title
                    const dashboardTitleElement = document.getElementById('dashboard-modal-title');
                    if (dashboardTitleElement) {
                        const titleText = section.charAt(0).toUpperCase() + section.slice(1).replace('vendor-', '').replace('-', ' ');
                        dashboardTitleElement.textContent = isVendorMode ? `Vendor Dashboard - ${titleText}` : `Dashboard - ${titleText}`;
                    }
                } else {
                    // Fallback for the main dashboard view
                    const mainDashboardSection = document.getElementById(isVendorMode ? 'vendor-dashboard-section' : 'dashboard-section');
                    if(mainDashboardSection) mainDashboardSection.style.display = 'block';
                    document.getElementById('dashboard-modal-title').textContent = isVendorMode ? 'Vendor Dashboard' : 'Dashboard';
                }

                // Update active class on menu items
                currentDashboardMenu.querySelectorAll('a').forEach(link => {
                    link.classList.remove('active');
                    if (link.dataset.section === section) {
                        link.classList.add('active');
                    }
                });

                // Load specific data for sections
                if (currentUser) {
                    if (mode === 'client') {
                        await loadClientDashboardData(section);
                    } else {
                        await loadVendorDashboardData(section);
                    }
                } else {
                    // Handle not logged in scenario for dashboard views
                    alert('Please log in to view the dashboard.');
                    dashboardModal.style.display = 'none';
                    document.body.style.overflow = 'auto';
                    showLoginView();
                    profileModal.style.display = 'flex';
                }
            }

            // Client Dashboard Data Loading
            async function loadClientDashboardData(section) {
                if (!currentUser || !currentUser.id) return;

                try {
                    const response = await fetch(`${API_BASE_URL}/users/${currentUser.id}/dashboard`, {
                        headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
                    });
                    if (!response.ok) throw new Error('Failed to fetch client dashboard data');
                    const dashboardData = await response.json();

                    // Update notifications badge
                    document.getElementById('dashboard-notifications-badge').textContent = dashboardData.unreadNotifications || 0;

                    if (section === 'dashboard') {
                        renderUpcomingBookings(dashboardData.upcomingBookings);
                        renderRecentFavorites(dashboardData.recentFavorites);
                    } else if (section === 'bookings') {
                        await loadAllUserBookings();
                    } else if (section === 'favorites') {
                        await loadUserFavoritesDashboard();
                    } else if (section === 'messages') {
                        await loadConversations('messages-section', 'dashboard-chat-input', 'dashboard-send-btn');
                    } else if (section === 'reviews') {
                        await loadUserReviews();
                    } else if (section === 'settings') {
                        await loadUserProfileDetails();
                    }
                } catch (error) {
                    console.error('Error loading client dashboard:', error);
                    alert('Failed to load dashboard data: ' + error.message);
                }
            }

            function renderUpcomingBookings(bookings) {
                const container = document.getElementById('upcoming-bookings');
                container.innerHTML = '';
                if (bookings && bookings.length > 0) {
                    bookings.forEach(booking => {
                        const bookingItem = document.createElement('div');
                        bookingItem.className = 'booking-item';
                        bookingItem.innerHTML = `
                            <div class="booking-info">
                                <div class="booking-vendor">${booking.VendorName}</div>
                                <div class="booking-date">${new Date(booking.EventDate).toLocaleDateString()} - ${booking.ServiceName}</div>
                            </div>
                            <span class="booking-status status-${booking.Status}">${booking.Status}</span>
                        `;
                        container.appendChild(bookingItem);
                    });
                } else {
                    container.innerHTML = '<p>No upcoming bookings.</p>';
                }
            }

            function renderRecentFavorites(favorites) {
                const container = document.getElementById('dashboard-favorites');
                container.innerHTML = '';
                if (favorites && favorites.length > 0) {
                    favorites.forEach(vendor => {
                        const vendorCard = document.createElement('div');
                        vendorCard.className = 'vendor-card';
                        vendorCard.innerHTML = `
                            <div class="vendor-image">
                                ${vendor.PortfolioImage ? `<img src="${vendor.PortfolioImage}" alt="${vendor.VendorName}" style="width:100%;height:100%;object-fit:cover;">` : getCategoryIcon(vendor.Categories?.split(',')[0] || 'all')}
                                <div class="vendor-favorite active" data-id="${vendor.VendorProfileID}"></div>
                            </div>
                            <div class="vendor-details">
                                <h3 class="vendor-name">${vendor.VendorName}</h3>
                                <div class="vendor-location">
                                     ${vendor.City}, ${vendor.State}
                                </div>
                                <div class="vendor-footer">
                                    <button class="btn btn-primary" style="width: 100%;" data-id="${vendor.VendorProfileID}">View</button>
                                </div>
                            </div>
                        `;
                        container.appendChild(vendorCard);
                        vendorCard.querySelector('button').addEventListener('click', () => {
                            window.location.hash = `/listings/${vendor.VendorProfileID}`;
                        });
                        vendorCard.querySelector('.vendor-favorite').addEventListener('click', (e) => {
                            e.stopPropagation();
                            toggleFavorite(vendor.VendorProfileID);
                        });
                    });
                } else {
                    container.innerHTML = '<p>No recent favorites.</p>';
                }
            }

            async function loadAllUserBookings() {
                const container = document.getElementById('all-bookings');
                container.innerHTML = '<p>Loading all bookings...</p>';
                try {
                    const response = await fetch(`${API_BASE_URL}/users/${currentUser.id}/bookings/all`, {
                        headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
                    });
                    if (!response.ok) throw new Error('Failed to fetch all bookings');
                    const bookings = await response.json();
                    renderBookingsList(bookings, container);
                } catch (error) {
                    console.error('Error loading all user bookings:', error);
                    container.innerHTML = `<p style="color:var(--accent);">Failed to load all bookings: ${error.message}</p>`;
                }
            }

            async function loadUserFavoritesDashboard() {
                const container = document.getElementById('saved-favorites');
                container.innerHTML = '<p>Loading saved favorites...</p>';
                try {
                    const response = await fetch(`${API_BASE_URL}/favorites/user/${currentUser.id}`, {
                        headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
                    });
                    if (!response.ok) throw new Error('Failed to fetch user favorites');
                    const favorites = await response.json();
                    renderFavoritesList(favorites, container);
                } catch (error) {
                    console.error('Error loading user favorites:', error);
                    container.innerHTML = `<p style="color:var(--accent);">Failed to load favorites: ${error.message}</p>`;
                }
            }

            function renderFavoritesList(favorites, container) {
                container.innerHTML = '';
                if (favorites && favorites.length > 0) {
                    favorites.forEach(vendor => {
                        const vendorCard = document.createElement('div');
                        vendorCard.className = 'vendor-card';
                        vendorCard.innerHTML = `
                            <div class="vendor-image">
                                ${vendor.PortfolioImage ? `<img src="${vendor.PortfolioImage}" alt="${vendor.VendorName}" style="width:100%;height:100%;object-fit:cover;">` : getCategoryIcon(vendor.Categories?.split(',')[0] || 'all')}
                                <div class="vendor-favorite active" data-id="${vendor.VendorProfileID}"></div>
                            </div>
                            <div class="vendor-details">
                                <h3 class="vendor-name">${vendor.VendorName}</h3>
                                <div class="vendor-location">
                                     ${vendor.City}, ${vendor.State}
                                </div>
                                <div class="vendor-footer">
                                    <button class="btn btn-primary" style="width: 100%;" data-id="${vendor.VendorProfileID}">View</button>
                                </div>
                            </div>
                        `;
                        container.appendChild(vendorCard);
                        vendorCard.querySelector('button').addEventListener('click', () => {
                            window.location.hash = `/listings/${vendor.VendorProfileID}`;
                        });
                        vendorCard.querySelector('.vendor-favorite').addEventListener('click', (e) => {
                            e.stopPropagation();
                            toggleFavorite(vendor.VendorProfileID);
                        });
                    });
                } else {
                    container.innerHTML = '<p>No saved favorites.</p>';
                }
            }

            async function loadUserReviews() {
                const container = document.getElementById('user-reviews');
                container.innerHTML = '<p>Loading your reviews...</p>';
                try {
                    const response = await fetch(`${API_BASE_URL}/users/${currentUser.id}/reviews`, {
                        headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
                    });
                    if (!response.ok) throw new Error('Failed to fetch user reviews');
                    const reviews = await response.json();
                    renderReviewsList(reviews, container);
                } catch (error) {
                    console.error('Error loading user reviews:', error);
                    container.innerHTML = `<p style="color:var(--accent);">Failed to load reviews: ${error.message}</p>`;
                }
            }

            function renderReviewsList(reviews, container) {
                container.innerHTML = '';
                if (reviews && reviews.length > 0) {
                    reviews.forEach(review => {
                        const reviewCard = document.createElement('div');
                        reviewCard.className = 'review-card';
                        reviewCard.innerHTML = `
                            <div class="review-header">
                                <div class="reviewer">${review.VendorName}</div>
                                <div class="review-date">${new Date(review.CreatedAt).toLocaleDateString()}</div>
                            </div>
                            <div class="review-rating">${''.repeat(review.Rating)}${''.repeat(5 - review.Rating)}</div>
                            ${review.Title ? `<div class="review-title">${review.Title}</div>` : ''}
                            <div class="review-text">${review.Comment}</div>
                        `;
                        container.appendChild(reviewCard);
                    });
                } else {
                    container.innerHTML = '<p>No reviews submitted yet.</p>';
                }
            }

            async function loadUserProfileDetails() {
                const nameInput = document.getElementById('profile-name');
                const emailInput = document.getElementById('profile-email');
                const phoneInput = document.getElementById('profile-phone');
                const profileForm = document.getElementById('profile-form');
                const passwordForm = document.getElementById('password-form');

                nameInput.value = 'Loading...';
                emailInput.value = 'Loading...';
                phoneInput.value = 'Loading...';

                try {
                    const response = await fetch(`${API_BASE_URL}/users/${currentUser.id}/profile-details`, {
                        headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
                    });
                    if (!response.ok) throw new Error('Failed to fetch user profile details');
                    const profile = await response.json();

                    nameInput.value = profile.Name || '';
                    emailInput.value = profile.Email || '';
                    phoneInput.value = profile.Phone || '';
                } catch (error) {
                    console.error('Error loading user profile details:', error);
                    nameInput.value = 'Error';
                    emailInput.value = 'Error';
                    phoneInput.value = 'Error';
                    alert('Failed to load profile details: ' + error.message);
                }

                profileForm.onsubmit = async (e) => {
                    e.preventDefault();
                    try {
                        const response = await fetch(`${API_BASE_URL}/users/${currentUser.id}/profile-update`, {
                            method: 'PUT',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${localStorage.getItem('token')}`
                            },
                            body: JSON.stringify({
                                name: nameInput.value,
                                phone: phoneInput.value,
                                bio: currentUser.bio,
                                avatar: currentUser.avatar
                            })
                        });
                        if (!response.ok) throw new Error('Failed to update profile');
                        alert('Profile updated successfully!');
                        await checkAuthStatus();
                    } catch (error) {
                        console.error('Error updating profile:', error);
                        alert('Failed to update profile: ' + error.message);
                    }
                };

                passwordForm.onsubmit = async (e) => {
                    e.preventDefault();
                    const currentPassword = document.getElementById('current-password').value;
                    const newPassword = document.getElementById('new-password').value;
                    const confirmPassword = document.getElementById('confirm-password').value;

                    if (newPassword !== confirmPassword) {
                        alert('New password and confirm password do not match.');
                        return;
                    }
                    if (newPassword.length < 8) {
                        alert('New password must be at least 8 characters long.');
                        return;
                    }

                    try {
                        const response = await fetch(`${API_BASE_URL}/users/${currentUser.id}/password-update`, {
                            method: 'PUT',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${localStorage.getItem('token')}`
                            },
                            body: JSON.stringify({ newPassword })
                        });
                        if (!response.ok) throw new Error('Failed to update password');
                        alert('Password updated successfully!');
                        document.getElementById('current-password').value = '';
                        document.getElementById('new-password').value = '';
                        document.getElementById('confirm-password').value = '';
                    } catch (error) {
                        console.error('Error updating password:', error);
                        alert('Failed to update password: ' + error.message);
                    }
                };
            }

            // Vendor Dashboard Data Loading
            async function loadVendorDashboardData(section) {
                if (!currentUser || !currentUser.id) return;

                // First, get the VendorProfileID for the current user
                let vendorProfileId = null;
                try {
                    const statusResponse = await fetch(`${API_BASE_URL}/vendors/status?userId=${currentUser.id}`, {
                        headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
                    });
                    if (!statusResponse.ok) throw new Error('Failed to fetch vendor status');
                    const statusData = await statusResponse.json();
                    if (statusData.isVendor && statusData.vendorProfileId) {
                        vendorProfileId = statusData.vendorProfileId;
                    } else {
                        document.getElementById('vendor-dashboard-section').innerHTML = '<p>You are not registered as a vendor or your profile is incomplete. Please register or complete your profile to access the vendor dashboard.</p>';
                        return;
                    }
                } catch (error) {
                    console.error('Error getting vendor profile ID:', error);
                    document.getElementById('vendor-dashboard-section').innerHTML = `<p style="color:var(--accent);">Error: ${error.message}. Could not load vendor dashboard.</p>`;
                    return;
                }

                try {
                    const response = await fetch(`${API_BASE_URL}/vendor/${currentUser.id}/dashboard`, {
                        headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
                    });
                    if (!response.ok) throw new Error('Failed to fetch vendor dashboard data');
                    const dashboardData = await response.json();

                    // Update notifications badge
                    document.getElementById('vendor-notifications-badge').textContent = dashboardData.unreadNotifications || 0;

                    if (section === 'vendor-dashboard') {
                        renderVendorStats(dashboardData.stats);
                        renderVendorRecentBookings(dashboardData.recentBookings);
                        // Load recent messages for the vendor dashboard overview
                        loadConversations('vendor-dashboard-section', 'vendor-chat-input', 'vendor-send-btn');
                    } else if (section === 'vendor-bookings') {
                        await loadAllVendorBookings(vendorProfileId);
                    } else if (section === 'vendor-services') {
                        await loadVendorServices(vendorProfileId);
                    } else if (section === 'vendor-messages') {
                        await loadConversations('vendor-messages-section', 'vendor-all-chat-input', 'vendor-all-send-btn');
                    } else if (section === 'vendor-reviews') {
                        await loadAllVendorReviews(vendorProfileId);
                    } else if (section === 'vendor-analytics') {
                        await loadVendorAnalytics(vendorProfileId);
                    } else if (section === 'vendor-settings') {
                        await loadVendorProfileDetails(vendorProfileId);
                    }
                } catch (error) {
                    console.error('Error loading vendor dashboard:', error);
                    alert('Failed to load vendor dashboard data: ' + error.message);
                }
            }

            function renderVendorStats(stats) {
                const container = document.getElementById('vendor-stats');
                container.innerHTML = `
                    <div class="stat-card">
                        <div class="stat-value">${stats.TotalBookings || 0}</div>
                        <div class="stat-label">Total Bookings</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${stats.TotalReviews || 0}</div>
                        <div class="stat-label">Total Reviews</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${(stats.AvgRating || 0).toFixed(1)}</div>
                        <div class="stat-label">Average Rating</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${stats.TotalFavorites || 0}</div>
                        <div class="stat-label">Total Favorites</div>
                    </div>
                `;
            }

            function renderVendorRecentBookings(bookings) {
                const container = document.getElementById('vendor-recent-bookings');
                container.innerHTML = '';
                if (bookings && bookings.length > 0) {
                    bookings.forEach(booking => {
                        const bookingItem = document.createElement('div');
                        bookingItem.className = 'booking-item';
                        bookingItem.innerHTML = `
                            <div class="booking-info">
                                <div class="booking-vendor">${booking.ClientName}</div>
                                <div class="booking-date">${new Date(booking.EventDate).toLocaleDateString()} - ${booking.ServiceName}</div>
                            </div>
                            <span class="booking-status status-${booking.Status}">${booking.Status}</span>
                        `;
                        container.appendChild(bookingItem);
                    });
                } else {
                    container.innerHTML = '<p>No recent bookings.</p>';
                }
            }

            function renderBookingsList(bookings, container) {
                container.innerHTML = '';
                if (bookings && bookings.length > 0) {
                    bookings.forEach(booking => {
                        const bookingItem = document.createElement('div');
                        bookingItem.className = 'booking-item';
                        const vendorOrClientName = isVendorMode ? booking.ClientName : booking.VendorName;
                        bookingItem.innerHTML = `
                            <div class="booking-info">
                                <div class="booking-vendor">${vendorOrClientName}</div>
                                <div class="booking-date">${new Date(booking.EventDate).toLocaleDateString()} - ${booking.ServiceName}</div>
                                <div>Total: $${booking.TotalAmount ? booking.TotalAmount.toFixed(2) : '0.00'}</div>
                            </div>
                            <span class="booking-status status-${booking.Status}">${booking.Status}</span>
                        `;
                        container.appendChild(bookingItem);
                    });
                } else {
                    container.innerHTML = '<p>No bookings found.</p>';
                }
            }

            async function loadAllVendorBookings(vendorProfileId) {
                const container = document.getElementById('vendor-all-bookings');
                container.innerHTML = '<p>Loading all bookings...</p>';
                try {
                    const response = await fetch(`${API_BASE_URL}/vendor/${vendorProfileId}/bookings/all`, {
                        headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
                    });
                    if (!response.ok) throw new Error('Failed to fetch all vendor bookings');
                    const bookings = await response.json();
                    renderBookingsList(bookings, container);
                } catch (error) {
                    console.error('Error loading all vendor bookings:', error);
                    container.innerHTML = `<p style="color:var(--accent);">Failed to load all bookings: ${error.message}</p>`;
                }
            }

            async function loadVendorServices(vendorProfileId) {
                const container = document.getElementById('vendor-services');
                container.innerHTML = '<p>Loading services...</p>';
                try {
                    const response = await fetch(`${API_BASE_URL}/vendor/${vendorProfileId}/services`, {
                        headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
                    });
                    if (!response.ok) throw new Error('Failed to fetch vendor services');
                    const services = await response.json();
                    renderManageServices(services, container);
                } catch (error) {
                    console.error('Error loading vendor services:', error);
                    container.innerHTML = `<p style="color:var(--accent);">Failed to load services: ${error.message}</p>`;
                }
            }

            function renderManageServices(services, container) {
                container.innerHTML = '';
                if (services && services.length > 0) {
                    // Group services by category for rendering
                    const servicesByCategory = services.reduce((acc, service) => {
                        const categoryName = service.CategoryName || 'Uncategorized';
                        if (!acc[categoryName]) {
                            acc[categoryName] = [];
                        }
                        acc[categoryName].push(service);
                        return acc;
                    }, {});

                    for (const categoryName in servicesByCategory) {
                        const categoryDiv = document.createElement('div');
                        categoryDiv.className = 'service-category';
                        categoryDiv.innerHTML = `
                            <h4 class="category-title">${categoryName}</h4>
                            <div class="service-grid">
                                ${(servicesByCategory[categoryName].map(service => `
                                    <div class="service-card">
                                        <div class="service-name">${service.ServiceName}</div>
                                        <div class="service-description">${service.ServiceDescription || 'No description.'}</div>
                                        <div class="service-price">$${service.Price.toFixed(2)}</div>
                                        <div class="service-actions">
                                            <button class="btn btn-outline btn-sm edit-service-btn" data-service-id="${service.ServiceID}">Edit</button>
                                            <button class="btn btn-primary btn-sm delete-service-btn" data-service-id="${service.ServiceID}">Delete</button>
                                        </div>
                                    </div>
                                `)).join('')}
                            </div>
                        `;
                        container.appendChild(categoryDiv);
                    }
                } else {
                    container.innerHTML = '<p>No services added yet. Add your first service!</p>';
                }
                // Add a button to add new services
                const addServiceBtn = document.createElement('button');
                addServiceBtn.className = 'btn btn-primary';
                addServiceBtn.textContent = 'Add New Service';
                addServiceBtn.addEventListener('click', () => {
                    // Implement logic to open a form for adding/editing a service
                    // For now, a simple alert
                    alert('Add New Service form would open here!');
                });
                container.appendChild(addServiceBtn);
            }

            async function loadAllVendorReviews(vendorProfileId) {
                const container = document.getElementById('vendor-reviews');
                container.innerHTML = '<p>Loading customer reviews...</p>';
                try {
                    const response = await fetch(`${API_BASE_URL}/vendor/${vendorProfileId}/reviews/all`, {
                        headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
                    });
                    if (!response.ok) throw new Error('Failed to fetch all vendor reviews');
                    const reviews = await response.json();
                    renderReviewsList(reviews, container);
                } catch (error) {
                    console.error('Error loading all vendor reviews:', error);
                    container.innerHTML = `<p style="color:var(--accent);">Failed to load reviews: ${error.message}</p>`;
                }
            }

            // Chart instances to prevent re-initialization
            let bookingStatsChart = null;
            let revenueByServiceChart = null;
            let revenueByMonthChart = null;
            let reviewStatsChart = null;

            async function loadVendorAnalytics(vendorProfileId) {
                const container = document.getElementById('analytics-charts');
                container.innerHTML = '<p>Loading analytics data...</p>';
                try {
                    const response = await fetch(`${API_BASE_URL}/vendor/${vendorProfileId}/analytics`, {
                        headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
                    });
                    if (!response.ok) throw new Error('Failed to fetch vendor analytics');
                    const analyticsData = await response.json();

                    container.innerHTML = '';

                    // Render Booking Stats Chart (Pie Chart)
                    const bookingStatsCanvas = document.createElement('canvas');
                    bookingStatsCanvas.id = 'bookingStatsChart';
                    const bookingStatsChartContainer = document.createElement('div');
                    bookingStatsChartContainer.className = 'chart-container';
                    bookingStatsChartContainer.innerHTML = '<h3>Booking Status Overview</h3>';
                    bookingStatsChartContainer.appendChild(bookingStatsCanvas);
                    container.appendChild(bookingStatsChartContainer);

                    if (bookingStatsChart) bookingStatsChart.destroy();
                    bookingStatsChart = new Chart(bookingStatsCanvas, {
                        type: 'pie',
                        data: {
                            labels: ['Completed', 'Confirmed', 'Pending', 'Cancelled'],
                            datasets: [{
                                data: [
                                    analyticsData.bookingStats.CompletedBookings,
                                    analyticsData.bookingStats.ConfirmedBookings,
                                    analyticsData.bookingStats.PendingBookings,
                                    analyticsData.bookingStats.CancelledBookings
                                ],
                                backgroundColor: ['#4CAF50', '#2196F3', '#FFC107', '#F4436']
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'Booking Status Distribution'
                                }
                            }
                        }
                    });

                    // Render Revenue by Service Chart (Bar Chart)
                    const revenueByServiceCanvas = document.createElement('canvas');
                    revenueByServiceCanvas.id = 'revenueByServiceChart';
                    const revenueByServiceChartContainer = document.createElement('div');
                    revenueByServiceChartContainer.className = 'chart-container';
                    revenueByServiceChartContainer.innerHTML = '<h3>Revenue by Service</h3>';
                    revenueByServiceChartContainer.appendChild(revenueByServiceCanvas);
                    container.appendChild(revenueByServiceChartContainer);

                    if (revenueByServiceChart) revenueByServiceChart.destroy();
                    revenueByServiceChart = new Chart(revenueByServiceCanvas, {
                        type: 'bar',
                        data: {
                            labels: analyticsData.revenueByService.map(s => s.ServiceName),
                            datasets: [{
                                label: 'Total Revenue ($)',
                                data: analyticsData.revenueByService.map(s => s.TotalRevenue),
                                backgroundColor: 'rgba(94, 114, 228, 0.6)'
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'Revenue Generated by Each Service'
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true
                                }
                            }
                        }
                    });

                    // Render Revenue by Month Chart (Line Chart)
                    const revenueByMonthCanvas = document.createElement('canvas');
                    revenueByMonthCanvas.id = 'revenueByMonthChart';
                    const revenueByMonthChartContainer = document.createElement('div');
                    revenueByMonthChartContainer.className = 'chart-container';
                    revenueByMonthChartContainer.innerHTML = '<h3>Monthly Revenue Trends</h3>';
                    revenueByMonthChartContainer.appendChild(revenueByMonthCanvas);
                    container.appendChild(revenueByMonthChartContainer);

                    const monthlyLabels = analyticsData.revenueByMonth.map(m => `${m.Year}-${String(m.Month).padStart(2, '0')}`);
                    const monthlyRevenue = analyticsData.revenueByMonth.map(m => m.TotalRevenue);

                    if (revenueByMonthChart) revenueByMonthChart.destroy();
                    revenueByMonthChart = new Chart(revenueByMonthCanvas, {
                        type: 'line',
                        data: {
                            labels: monthlyLabels,
                            datasets: [{
                                label: 'Total Revenue ($)',
                                data: monthlyRevenue,
                                borderColor: 'var(--primary)',
                                tension: 0.1,
                                fill: false
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'Revenue Over Time'
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true
                                }
                            }
                        }
                    });

                    // Render Review Stats Chart (Doughnut Chart)
                    const reviewStatsCanvas = document.createElement('canvas');
                    reviewStatsCanvas.id = 'reviewStatsChart';
                    const reviewStatsChartContainer = document.createElement('div');
                    reviewStatsChartContainer.className = 'chart-container';
                    reviewStatsChartContainer.innerHTML = '<h3>Review Rating Distribution</h3>';
                    reviewStatsChartContainer.appendChild(reviewStatsCanvas);
                    container.appendChild(reviewStatsChartContainer);

                    if (reviewStatsChart) reviewStatsChart.destroy();
                    reviewStatsChart = new Chart(reviewStatsCanvas, {
                        type: 'doughnut',
                        data: {
                            labels: ['5 Stars', '4 Stars', '3 Stars', '2 Stars', '1 Star'],
                            datasets: [{
                                data: [
                                    analyticsData.reviewStats.FiveStarReviews,
                                    analyticsData.reviewStats.FourStarReviews,
                                    analyticsData.reviewStats.ThreeStarReviews,
                                    analyticsData.reviewStats.TwoStarReviews,
                                    analyticsData.reviewStats.OneStarReviews
                                ],
                                backgroundColor: ['#4CAF50', '#8BC34A', '#FFEB3B', '#FF9800', '#F4436']
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'Customer Review Ratings'
                                }
                            }
                        }
                    });

                } catch (error) {
                    console.error('Error loading vendor analytics:', error);
                    container.innerHTML = `<p style="color:var(--accent);">Failed to load analytics: ${error.message}</p>`;
                }
            }

            async function loadVendorProfileDetails(vendorProfileId) {
                const form = document.getElementById('vendor-profile-form');
                const inputs = {
                    businessName: document.getElementById('vendor-name'),
                    category: document.getElementById('vendor-category'),
                    description: document.getElementById('vendor-description'),
                    address: document.getElementById('vendor-address'),
                    city: document.getElementById('vendor-city'),
                    state: document.getElementById('vendor-state'),
                    country: document.getElementById('vendor-country'),
                    postalCode: document.getElementById('vendor-postalCode'),
                    phone: document.getElementById('vendor-phone'),
                    email: document.getElementById('vendor-email'),
                    website: document.getElementById('vendor-website'),
                    yearsInBusiness: document.getElementById('vendor-years-in-business'),
                    isPremium: document.getElementById('vendor-is-premium'),
                    isEcoFriendly: document.getElementById('vendor-is-eco-friendly'),
                    isAwardWinning: document.getElementById('vendor-is-award-winning')
                };

                // Populate category dropdown
                inputs.category.innerHTML = '<option value="">Select category</option>' +
                    state.categories.filter(c => c.id !== 'all').map(c => `<option value="${c.id}">${c.name}</option>`).join('');

                for (const key in inputs) {
                    if (inputs[key] instanceof HTMLInputElement || inputs[key] instanceof HTMLTextAreaElement || inputs[key] instanceof HTMLSelectElement) {
                        inputs[key].value = 'Loading...';
                        if (inputs[key].type === 'checkbox') inputs[key].checked = false;
                    }
                }

                try {
                    const response = await fetch(`${API_BASE_URL}/vendor/${vendorProfileId}/profile-details`, {
                        headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
                    });
                    if (!response.ok) throw new Error('Failed to fetch vendor profile details');
                    const profile = await response.json();

                    inputs.businessName.value = profile.BusinessName || '';
                    inputs.description.value = profile.BusinessDescription || '';
                    inputs.address.value = profile.Address || '';
                    inputs.city.value = profile.City || '';
                    inputs.state.value = profile.State || '';
                    inputs.country.value = profile.Country || '';
                    inputs.postalCode.value = profile.PostalCode || '';
                    inputs.phone.value = profile.BusinessPhone || '';
                    inputs.email.value = profile.BusinessEmail || '';
                    inputs.website.value = profile.Website || '';
                    inputs.yearsInBusiness.value = profile.YearsInBusiness || 0;
                    inputs.isPremium.checked = profile.IsPremium;
                    inputs.isEcoFriendly.checked = profile.IsEcoFriendly;
                    inputs.isAwardWinning.checked = profile.IsAwardWinning;

                    // Set selected category
                    if (profile.Categories) {
                        const primaryCategory = profile.Categories.split(',')[0].trim().toLowerCase();
                        const option = Array.from(inputs.category.options).find(opt => opt.value === primaryCategory);
                        if (option) {
                            option.selected = true;
                        }
                    }

                    await loadVendorImages(vendorProfileId);
                    await loadVendorAvailability(vendorProfileId);

                } catch (error) {
                    console.error('Error loading vendor profile details:', error);
                    for (const key in inputs) {
                        if (inputs[key] instanceof HTMLInputElement || inputs[key] instanceof HTMLTextAreaElement || inputs[key] instanceof HTMLSelectElement) {
                            inputs[key].value = 'Error';
                        }
                    }
                    alert('Failed to load vendor profile details: ' + error.message);
                }

                form.onsubmit = async (e) => {
                    e.preventDefault();
                    try {
                        const updateData = {
                            businessName: inputs.businessName.value,
                            description: inputs.description.value,
                            phone: inputs.phone.value,
                            email: inputs.email.value,
                            website: inputs.website.value,
                            yearsInBusiness: parseInt(inputs.yearsInBusiness.value),
                            address: inputs.address.value,
                            city: inputs.city.value,
                            state: inputs.state.value,
                            country: inputs.country.value,
                            postalCode: inputs.postalCode.value,
                            isPremium: inputs.isPremium.checked,
                            isEcoFriendly: inputs.isEcoFriendly.checked,
                            isAwardWinning: inputs.isAwardWinning.checked,
                        };

                        const response = await fetch(`${API_BASE_URL}/vendors/${vendorProfileId}`, {
                            method: 'PUT',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${localStorage.getItem('token')}`
                            },
                            body: JSON.stringify(updateData)
                        });
                        if (!response.ok) {
                            const errorData = await response.json();
                            throw new Error(errorData.message || 'Failed to update vendor profile');
                        }
                        alert('Vendor profile updated successfully!');
                    } catch (error) {
                        console.error('Error updating vendor profile:', error);
                        alert('Failed to update vendor profile: ' + error.message);
                    }
                };
            }

            async function loadVendorImages(vendorProfileId) {
                const container = document.getElementById('vendor-photos');
                container.innerHTML = '<p>Loading photos...</p>';
                try {
                    const response = await fetch(`${API_BASE_URL}/vendor/${vendorProfileId}/images`, {
                        headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
                    });
                    if (!response.ok) throw new Error('Failed to fetch vendor images');
                    const images = await response.json();
                    renderVendorImages(images, container);
                } catch (error) {
                    console.error('Error loading vendor images:', error);
                    container.innerHTML = `<p style="color:var(--accent);">Failed to load photos: ${error.message}</p>`;
                }
            }

            function renderVendorImages(images, container) {
                container.innerHTML = '';
                if (images && images.length > 0) {
                    images.forEach(img => {
                        const imgDiv = document.createElement('div');
                        imgDiv.style.width = '100%';
                        imgDiv.style.height = '100px';
                        imgDiv.style.borderRadius = 'var(--radius)';
                        imgDiv.style.overflow = 'hidden';
                        imgDiv.style.position = 'relative';
                        imgDiv.innerHTML = `
                            <img src="${img.ImageURL}" alt="${img.Caption || 'Vendor Image'}" style="width:100%;height:100%;object-fit:cover;">
                            ${img.IsPrimary ? '<span style="position:absolute;top:5px;left:5px;background-color:var(--primary);color:white;padding:3px 8px;border-radius:10px;font-size:0.7rem;">Primary</span>' : ''}
                            <button class="btn btn-sm" style="position:absolute;bottom:5px;right:5px;background-color:rgba(255,255,255,0.8);border:none;color:var(--accent);" data-image-id="${img.ImageID}">Delete</button>
                        `;
                        container.appendChild(imgDiv);
                        imgDiv.querySelector('button').addEventListener('click', async () => {
                            if (confirm('Are you sure you want to delete this image?')) {
                                try {
                                    const response = await fetch(`${API_BASE_URL}/vendor/${currentUser.vendorProfileId}/images/${img.ImageID}`, {
                                        method: 'DELETE',
                                        headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
                                    });
                                    if (!response.ok) throw new Error('Failed to delete image');
                                    alert('Image deleted successfully!');
                                    loadVendorImages(currentUser.vendorProfileId);
                                } catch (error) {
                                    console.error('Error deleting image:', error);
                                    alert('Failed to delete image: ' + error.message);
                                }
                            }
                        });
                    });
                } else {
                    container.innerHTML = '<p>No photos uploaded.</p>';
                }

                // Handle upload photos button
                document.getElementById('upload-photos-btn').onclick = () => {
                    const input = document.createElement('input');
                    input.type = 'file';
                    input.accept = 'image/*';
                    input.multiple = true;
                    input.onchange = async (e) => {
                        const files = e.target.files;
                        if (files.length === 0) return;

                        alert('Simulating upload of ' + files.length + ' images. In a real app, these would be uploaded and saved.');
                        for (let i = 0; i < files.length; i++) {
                            const file = files[i];
                            const reader = new FileReader();
                            reader.onload = (e) => {
                                const newImgDiv = document.createElement('div');
                                newImgDiv.style.width = '100%';
                                newImgDiv.style.height = '100px';
                                newImgDiv.style.borderRadius = 'var(--radius)';
                                newImgDiv.style.overflow = 'hidden';
                                newImgDiv.style.position = 'relative';
                                newImgDiv.innerHTML = `
                                    <img src="${e.target.result}" alt="New Image" style="width:100%;height:100%;object-fit:cover;">
                                    <button class="btn btn-sm" style="position:absolute;bottom:5px;right:5px;background-color:rgba(255,255,255,0.8);border:none;color:var(--accent);">Remove</button>
                                `;
                                container.appendChild(newImgDiv);
                                newImgDiv.querySelector('button').addEventListener('click', () => newImgDiv.remove());
                            };
                            reader.readAsDataURL(file);
                        }
                    };
                    input.click();
                };
            }

            async function loadVendorAvailability(vendorProfileId) {
                const calendarEl = document.getElementById('vendor-availability-calendar');
                if (!calendarEl) return;

                // Destroy existing calendar instance if it exists
                if (calendarEl._fullCalendar) {
                    calendarEl._fullCalendar.destroy();
                    calendarEl._fullCalendar = null;
                }

                try {
                    const response = await fetch(`${API_BASE_URL}/vendor/${vendorProfileId}/availability`, {
                        headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
                    });
                    if (!response.ok) throw new Error('Failed to fetch vendor availability');
                    const data = await response.json();
                    const businessHours = data.businessHours || [];
                    const exceptions = data.availabilityExceptions || [];

                    const events = [];

                    // Add business hours as recurring events
                    businessHours.forEach(bh => {
                        if (bh.IsAvailable) {
                            events.push({
                                daysOfWeek: [bh.DayOfWeek],
                                startTime: bh.OpenTime,
                                endTime: bh.CloseTime,
                                display: 'background',
                                color: '#d1fae5'
                            });
                        } else {
                            events.push({
                                daysOfWeek: [bh.DayOfWeek],
                                display: 'background',
                                color: '#fee2e2'
                            });
                        }
                    });

                    // Add exceptions
                    exceptions.forEach(ex => {
                        events.push({
                            start: ex.StartDate + (ex.StartTime ? 'T' + ex.StartTime : ''),
                            end: ex.EndDate + (ex.EndTime ? 'T' + ex.EndTime : ''),
                            title: ex.Reason || (ex.IsAvailable ? 'Available' : 'Unavailable'),
                            color: ex.IsAvailable ? '#2196F3' : '#F4436',
                            allDay: !ex.StartTime && !ex.EndTime,
                            extendedProps: {
                                exceptionId: ex.ExceptionID,
                                isAvailable: ex.IsAvailable,
                                reason: ex.Reason
                            }
                        });
                    });

                    const calendar = new FullCalendar.Calendar(calendarEl, {
                        initialView: 'dayGridMonth',
                        events: events,
                        selectable: true,
                        editable: true,
                        eventClick: function(info) {
                            const ex = info.event.extendedProps;
                            alert(`Exception: ${ex.reason || 'N/A'}\nAvailable: ${ex.isAvailable ? 'Yes' : 'No'}\nID: ${ex.exceptionId}`);
                        },
                        select: function(info) {
                            const reason = prompt('Reason for availability exception (e.g., "Holiday", "Closed for Maintenance")');
                            if (reason) {
                                const isAvailable = confirm('Is the vendor available during this exception? (OK for Yes, Cancel for No)');
                                upsertVendorAvailabilityException(
                                    null,
                                    info.startStr.split('T')[0],
                                    info.endStr.split('T')[0],
                                    null,
                                    null,
                                    isAvailable,
                                    reason
                                );
                            }
                        }
                    });
                    calendar.render();
                    calendarEl._fullCalendar = calendar;

                } catch (error) {
                    console.error('Error loading vendor availability:', error);
                    calendarEl.innerHTML = `<p style="color:var(--accent);">Failed to load availability: ${error.message}</p>`;
                }

                // Set Business Hours button handler
                document.getElementById('set-business-hours-btn').onclick = () => {
                    alert('Business Hours settings would open here. You can configure daily open/close times.');
                };
            }

            async function upsertVendorAvailabilityException(exceptionId, startDate, endDate, startTime, endTime, isAvailable, reason) {
                try {
                    const payload = {
                        exceptionId: exceptionId,
                        startDate: startDate,
                        endDate: endDate,
                        startTime: startTime,
                        endTime: endTime,
                        isAvailable: isAvailable,
                        reason: reason
                    };
                    const response = await fetch(`${API_BASE_URL}/vendor/${currentUser.vendorProfileId}/availability-exceptions/upsert`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${localStorage.getItem('token')}`
                        },
                        body: JSON.stringify(payload)
                    });
                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.message || 'Failed to upsert availability exception');
                    }
                    alert('Availability exception saved successfully!');
                    loadVendorAvailability(currentUser.vendorProfileId);
                } catch (error) {
                    console.error('Error upserting availability exception:', error);
                    alert('Failed to save availability exception: ' + error.message);
                }
            }

            // Simulate user login (for demo purposes)
            function simulateLogin(user) {
                currentUser = {
                    ...user,
                    isVendor: user.isVendor || false
                };

                showLoggedInView();
                profileModal.style.display = 'none';
                alert(`Welcome, ${user.name}! You are now logged in.`);

                // Update profile button to show user is logged in
                profileBtn.textContent = user.avatar;
                profileBtn.style.backgroundColor = 'var(--primary)';
                profileBtn.style.color = 'white';
                profileBtn.style.borderRadius = '50%';
                profileBtn.style.width = '36px';
                profileBtn.style.height = '36px';
                profileBtn.style.display = 'flex';
                profileBtn.style.alignItems = 'center';
                profileBtn.style.justifyContent = 'center';

                // Update favorites badge
                document.querySelector('.badge').textContent = state.favorites.length;
            }

            // Toggle vendor favorite status
            async function toggleFavorite(vendorId) {
                if (!currentUser) {
                    profileModal.style.display = 'flex';
                    showLoginView();
                    return;
                }

                try {
                    const response = await fetch(`${API_BASE_URL}/favorites/toggle`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${localStorage.getItem('token')}`
                        },
                        body: JSON.stringify({
                            userId: currentUser.id,
                            vendorProfileId: vendorId
                        })
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.message || 'Failed to toggle favorite');
                    }

                    const result = await response.json();

                    const index = state.favorites.indexOf(vendorId);
                    if (result.isFavorite && index === -1) {
                        state.favorites.push(vendorId);
                    } else if (!result.isFavorite && index !== -1) {
                        state.favorites.splice(index, 1);
                    }

                    // Update UI
                    document.querySelectorAll(`.vendor-favorite[data-id="${vendorId}"]`).forEach(icon => {
                        icon.classList.toggle('active', result.isFavorite);
                    });

                    // Update badge
                    document.querySelector('.badge').textContent = state.favorites.length;

                } catch (error) {
                    console.error('Error toggling favorite:', error);
                    alert('Failed to toggle favorite: ' + error.message);
                }
            }

            // Center map on user location
            function centerMapOnUser() {
                if (state.map && state.userLocation) {
                    state.map.setCenter(new google.maps.LatLng(state.userLocation.lat, state.userLocation.lng));
                    state.map.setZoom(12);
                }
            }

            // Update map markers
            function updateMapMarkers() {
                // Clear existing markers
                state.markers.forEach(marker => marker.setMap(null));
                state.markers = [];

                // Add new markers
                state.filteredVendors.forEach(vendor => {
                    const marker = new google.maps.Marker({
                        position: { lat: vendor.coordinates.lat, lng: vendor.coordinates.lng },
                        map: state.map,
                        title: vendor.name
                    });

                    state.markers.push(marker);

                    // Add click event to show vendor info
                    marker.addListener('click', () => {
                        window.location.hash = `/listings/${vendor.id}`;
                    });
                });
            }

            // --- IMAGE GALLERY AND LIGHTBOX FUNCTIONS ---

    function populateImageGallery(images) {
        const galleryContainer = document.getElementById('modal-image-gallery');
        if (!galleryContainer) return;

        galleryContainer.innerHTML = '';

        // Handle both old format (img.ImageURL) and new Cloudinary format (img.url)
        const imageList = images ? images.map(img => {
            // New Cloudinary format
            if (img.url) {
                return img.url;
            }
            // Old format fallback
            if (img.ImageURL) {
                return img.ImageURL;
            }
            // String format (direct URL)
            if (typeof img === 'string') {
                return img;
            }
            return null;
        }).filter(url => url !== null) : [];
        
        const totalImages = imageList.length;
        lightboxImages = imageList;
        const placeholderImage = "https://placehold.co/400x400/e2e8f0/718096?text=No+Image";

        // Always render 5 blocks: 1 large image + 4 thumbnails
        // Prepare array for 5 images or placeholders
        const galleryImages = [];

        // First image (large)
        galleryImages.push(totalImages > 0 ? imageList[0] : placeholderImage);

        // Next 4 thumbnails
        for (let i = 1; i <= 4; i++) {
            galleryImages.push(i < totalImages ? imageList[i] : placeholderImage);
        }

        // Create gallery structure
        // Large image block
        const largeImageDiv = document.createElement('div');
        largeImageDiv.className = 'gallery-item large-image';
        largeImageDiv.innerHTML = `<img src="${galleryImages[0]}" alt="Main Venue Image">`;
        if (totalImages > 0) {
            largeImageDiv.addEventListener('click', () => openLightbox(0));
        }
        galleryContainer.appendChild(largeImageDiv);

        // Thumbnails container
        const thumbnailsContainer = document.createElement('div');
        thumbnailsContainer.className = 'thumbnails-container';

        // Add 4 thumbnails
        for (let i = 1; i <= 4; i++) {
            const thumbDiv = document.createElement('div');
            thumbDiv.className = 'gallery-item';
            thumbDiv.innerHTML = `<img src="${galleryImages[i]}" alt="Thumbnail ${i}">`;

            // Add click event if not placeholder
            if (galleryImages[i] !== placeholderImage) {
                thumbDiv.addEventListener('click', () => openLightbox(i));
            }

            // Add "+X See All" overlay on bottom-right thumbnail if more images exist
            if (i === 4) {
                const hiddenCount = totalImages - 5;
                const overlay = document.createElement('div');
                overlay.className = 'see-all-overlay';
                overlay.textContent = `+${hiddenCount > 0 ? hiddenCount : 0} See All`;
                thumbDiv.appendChild(overlay);

                // Make overlay clickable to open lightbox from first image
                thumbDiv.style.cursor = 'pointer';
                thumbDiv.onclick = () => openLightbox(0);
            }

            thumbnailsContainer.appendChild(thumbDiv);
        }

        galleryContainer.appendChild(thumbnailsContainer);
    }

            function setupLightboxEventListeners() {
                const lightbox = document.getElementById('lightbox-modal');
                const closeBtn = lightbox.querySelector('.lightbox-close');
                const prevBtn = lightbox.querySelector('.lightbox-prev');
                const nextBtn = lightbox.querySelector('.lightbox-nav.lightbox-next');
                
                // Ensure only one listener is active
                if (closeBtn) closeBtn.removeEventListener('click', closeLightbox);
                if (prevBtn) prevBtn.removeEventListener('click', showPrevImage);
                if (nextBtn) nextBtn.removeEventListener('click', showNextImage);
                
                if (closeBtn) closeBtn.addEventListener('click', closeLightbox);
                if (prevBtn) prevBtn.addEventListener('click', showPrevImage);
                if (nextBtn) nextBtn.addEventListener('click', showNextImage);

                if (lightbox) {
                    if (lightbox.__overlayClickListener) {
                        lightbox.removeEventListener('click', lightbox.__overlayClickListener);
                    }
                    
                    const newListener = (e) => {
                        if (e.target === lightbox) {
                            closeLightbox();
                        }
                    };
                    lightbox.addEventListener('click', newListener);
                    lightbox.__overlayClickListener = newListener;
                }

                document.addEventListener('keydown', (e) => {
                    if (lightbox.style.display === 'flex') {
                        if (e.key === 'Escape') closeLightbox();
                        if (e.key === 'ArrowLeft') showPrevImage();
                        if (e.key === 'ArrowRight') showNextImage();
                    }
                });
            }

            function openLightbox(index) {
                currentLightboxIndex = index;
                updateLightboxImage();
                document.getElementById('lightbox-modal').style.display = 'flex';
                document.body.style.overflow = 'hidden';
            }

            function closeLightbox() {
                document.getElementById('lightbox-modal').style.display = 'none';
                document.body.style.overflow = 'auto';
            }

            function updateLightboxImage() {
                const lightboxImage = document.getElementById('lightbox-image');
                if (lightboxImages.length > 0) {
                    lightboxImage.src = lightboxImages[currentLightboxIndex];
                } else {
                     lightboxImage.src = 'https://placehold.co/800x600/e2e8f0/718096?text=No+Image';
                }
            }

            function showPrevImage() {
                if (lightboxImages.length > 0) {
                    currentLightboxIndex = (currentLightboxIndex - 1 + lightboxImages.length) % lightboxImages.length;
                    updateLightboxImage();
                }
            }

            function showNextImage() {
                if (lightboxImages.length > 0) {
                    currentLightboxIndex = (currentLightboxIndex + 1) % lightboxImages.length;
                    updateLightboxImage();
                }
            }

            // Render vendors with Cloudinary images
            function renderVendors() {
                if (!vendorGrid) return;
                
                const vendorsToShow = state.filteredVendors.slice(
                    (state.currentPage - 1) * state.itemsPerPage,
                    state.currentPage * state.itemsPerPage
                );

                if (vendorsToShow.length === 0) {
                    vendorGrid.innerHTML = '<div style="grid-column:1/-1;text-align:center;padding:2rem;color:var(--text-light);">No vendors found matching your criteria.</div>';
                    return;
                }

                vendorGrid.innerHTML = vendorsToShow.map(vendor => {
                    // Use Cloudinary featured image or fallback to placeholder
                    const imageUrl = vendor.featuredImage?.url || 
                                   vendor.featuredImage?.thumbnailUrl || 
                                   (vendor.images && vendor.images.length > 0 ? vendor.images[0].url : null) ||
                                   'https://placehold.co/800x600/e2e8f0/718096?text=No+Image';
                    
                    const isFavorite = state.favorites.includes(vendor.VendorProfileID || vendor.id);
                    const badges = [];
                    
                    if (vendor.isPremium) badges.push('<span class="vendor-badge premium">Premium</span>');
                    if (vendor.isEcoFriendly) badges.push('<span class="vendor-badge eco">Eco-Friendly</span>');
                    if (vendor.isAwardWinning) badges.push('<span class="vendor-badge award">Award Winner</span>');

                    const priceLevel = vendor.priceLevel || 2;
                    const priceDots = Array.from({length: 3}, (_, i) => 
                        `<span class="price-dot ${i < priceLevel ? 'filled' : ''}"></span>`
                    ).join('');

                    return `
                        <div class="vendor-card">
                            <div class="vendor-image">
                                <img src="${imageUrl}" alt="${vendor.BusinessName || vendor.name}" 
                                     style="width:100%;height:100%;object-fit:cover;"
                                     onerror="this.src='https://placehold.co/800x600/e2e8f0/718096?text=No+Image'">
                                <div class="vendor-favorite ${isFavorite ? 'active' : ''}" data-id="${vendor.VendorProfileID || vendor.id}"></div>
                                <div class="vendor-badges" style="position: absolute; bottom: 8px; left: 8px; display: flex; gap: 6px;">
                                    ${badges.join('')}
                                </div>
                                ${vendor.imageCount > 1 ? `<div class="image-count">+${vendor.imageCount - 1}</div>` : ''}
                            </div>
                            <div class="vendor-details">
                                <h3 class="vendor-name">${vendor.BusinessName || vendor.name}</h3>
                                <div class="vendor-location">
                                     ${vendor.City || vendor.city || ''}, ${vendor.State || vendor.state || ''}
                                </div>
                                <div class="vendor-features">
                                    <div class="feature">
                                        <span class="feature-icon">${getCategoryIcon(vendor.category || vendor.type)}</span>
                                        <span>${vendor.type || vendor.category || 'Service'}</span>
                                    </div>
                                    <div class="feature">
                                        <span class="feature-icon"></span>
                                        <span>${vendor.rating || '4.5'} (${vendor.reviewCount || 0})</span>
                                    </div>
                                    <div class="feature">
                                        <div class="price-indicator">
                                            ${priceDots}
                                        </div>
                                    </div>
                                </div>
                                <div class="vendor-footer">
                                    <button class="btn btn-outline save-btn" data-id="${vendor.VendorProfileID || vendor.id}">Save</button>
                                    <button class="btn btn-primary view-btn" data-id="${vendor.VendorProfileID || vendor.id}">View</button>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');

                // Add event listeners for the new vendor cards
                setupVendorCardEventListeners();
                updatePagination();
            }

            // Setup event listeners for vendor cards
            function setupVendorCardEventListeners() {
                // Favorite buttons
                document.querySelectorAll('.vendor-favorite').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const vendorId = btn.dataset.id;
                        toggleFavorite(vendorId);
                    });
                });

                // View buttons
                document.querySelectorAll('.view-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const vendorId = btn.dataset.id;
                        window.location.hash = `/listings/${vendorId}`;
                    });
                });

                // Save buttons
                document.querySelectorAll('.save-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const vendorId = btn.dataset.id;
                        toggleFavorite(vendorId);
                    });
                });
            }

            // Update metadata display
            function updateMetadata(data) {
                if (resultsTitle) {
                    resultsTitle.textContent = `Vendors in ${state.filters.location || 'Los Angeles'}`;
                }
                if (resultsCount) {
                    resultsCount.textContent = `${data.total || state.filteredVendors.length} vendors available`;
                }
            }

            // Update pagination
            function updatePagination() {
                const totalPages = Math.ceil(state.filteredVendors.length / state.itemsPerPage);
                
                if (prevPageBtn) {
                    prevPageBtn.disabled = state.currentPage <= 1;
                }
                if (nextPageBtn) {
                    nextPageBtn.disabled = state.currentPage >= totalPages;
                }
                
                // Update page info if exists
                const pageInfo = document.querySelector('.page-info');
                if (pageInfo) {
                    pageInfo.textContent = `Page ${state.currentPage} of ${totalPages}`;
                }
            }

            // Filter vendors based on current filters
            function filterVendors() {
                state.filteredVendors = state.vendors.filter(vendor => {
                    // Category filter
                    if (state.currentCategory !== 'all' && vendor.category !== state.currentCategory) {
                        return false;
                    }
                    
                    // Location filter
                    if (state.filters.location) {
                        const location = state.filters.location.toLowerCase();
                        const vendorLocation = `${vendor.City || ''} ${vendor.State || ''}`.toLowerCase();
                        if (!vendorLocation.includes(location)) {
                            return false;
                        }
                    }
                    
                    return true;
                });
                
                state.currentPage = 1; // Reset to first page
                renderVendors();
                updateMetadata({ total: state.filteredVendors.length });
            }

            // Get category icon
            function getCategoryIcon(category) {
                const icons = {
                    "venue": "",
                    "photo": "",
                    "music": "",
                    "catering": "",
                    "entertainment": "",
                    "experiences": "",
                    "decor": "",
                    "beauty": "",
                    "cake": "",
                    "transport": "",
                    "planner": "",
                    "fashion": "",
                    "stationery": ""
                };
                return icons[category?.toLowerCase()] || "";
            }

        });
    </script>
</html>
